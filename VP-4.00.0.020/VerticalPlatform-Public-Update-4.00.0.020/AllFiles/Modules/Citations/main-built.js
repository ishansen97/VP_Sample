/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/*
* Copyright (c) 2009-2013 Frank G. Bennett, Jr. All Rights
* Reserved.
*
* The contents of this file are subject to the Common Public
* Attribution License Version 1.0 (the “License”); you may not use
* this file except in compliance with the License. You may obtain a
* copy of the License at:
*
* http://bitbucket.org/fbennett/citeproc-js/src/tip/LICENSE.
*
* The License is based on the Mozilla Public License Version 1.1 but
* Sections 1.13, 14 and 15 have been added to cover use of software over a
* computer network and provide for limited attribution for the
* Original Developer. In addition, Exhibit A has been modified to be
* consistent with Exhibit B.
*
* Software distributed under the License is distributed on an “AS IS”
* basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See
* the License for the specific language governing rights and limitations
* under the License.
*
* The Original Code is the citation formatting software known as
* "citeproc-js" (an implementation of the Citation Style Language
* [CSL]), including the original test fixtures and software located
* under the ./tests subdirectory of the distribution archive.
*
* The Original Developer is not the Initial Developer and is
* __________. If left blank, the Original Developer is the Initial
* Developer.
*
* The Initial Developer of the Original Code is Frank G. Bennett,
* Jr. All portions of the code written by Frank G. Bennett, Jr. are
* Copyright (c) 2009-2013 Frank G. Bennett, Jr. All Rights Reserved.
*
* Alternatively, the contents of this file may be used under the
* terms of the GNU Affero General Public License (the [AGPLv3]
* License), in which case the provisions of [AGPLv3] License are
* applicable instead of those above. If you wish to allow use of your
* version of this file only under the terms of the [AGPLv3] License
* and not to allow others to use your version of this file under the
* CPAL, indicate your decision by deleting the provisions above and
* replace them with the notice and other provisions required by the
* [AGPLv3] License. If you do not delete the provisions above, a
* recipient may use your version of this file under either the CPAL
* or the [AGPLv3] License.”
*/

!function(){var t,e,s;!function(i){function r(t,e){return v.call(t,e)}function n(t,e){var i,s,r,n,a,o,l,u,h,p,c=e&&e.split("/"),f=_.map,m=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(e){for(c=c.slice(0,c.length-1),t=c.concat(t.split("/")),u=0;t.length>u;u+=1)if(p=t[u],"."===p)t.splice(u,1),u-=1;else if(".."===p){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((c||m)&&f){for(i=t.split("/"),u=i.length;u>0;u-=1){if(s=i.slice(0,u).join("/"),c)for(h=c.length;h>0;h-=1)if(r=f[c.slice(0,h).join("/")],r&&(r=r[s])){n=r,a=u;break}if(n)break;!o&&m&&m[s]&&(o=m[s],l=u)}!n&&o&&(n=o,a=l),n&&(i.splice(0,a,n),t=i.join("/"))}return t}function a(t,e){return function(){return f.apply(i,x.call(arguments,0).concat([t,e]))}}function o(t){return function(e){return n(e,t)}}function l(t){return function(e){d[t]=e}}function u(t){if(r(b,t)){var e=b[t];delete b[t],y[t]=!0,c.apply(i,e)}if(!r(d,t)&&!r(y,t))throw Error("No "+t);return d[t]}function h(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function p(t){return function(){return _&&_.config&&_.config[t]||{}}}var c,f,m,g,d={},b={},_={},y={},v=Object.prototype.hasOwnProperty,x=[].slice;m=function(t,e){var i,s=h(t),r=s[0];return t=s[1],r&&(r=n(r,e),i=u(r)),r?t=i&&i.normalize?i.normalize(t,o(e)):n(t,e):(t=n(t,e),s=h(t),r=s[0],t=s[1],r&&(i=u(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:i}},g={require:function(t){return a(t)},exports:function(t){var e=d[t];return void 0!==e?e:d[t]={}},module:function(t){return{id:t,uri:"",exports:d[t],config:p(t)}}},c=function(t,e,s,n){var o,h,p,c,f,_,v=[];if(n=n||t,"function"==typeof s){for(e=!e.length&&s.length?["require","exports","module"]:e,f=0;e.length>f;f+=1)if(c=m(e[f],n),h=c.f,"require"===h)v[f]=g.require(t);else if("exports"===h)v[f]=g.exports(t),_=!0;else if("module"===h)o=v[f]=g.module(t);else if(r(d,h)||r(b,h)||r(y,h))v[f]=u(h);else{if(!c.p)throw Error(t+" missing "+h);c.p.load(c.n,a(n,!0),l(h),{}),v[f]=d[h]}p=s.apply(d[t],v),t&&(o&&o.exports!==i&&o.exports!==d[t]?d[t]=o.exports:p===i&&_||(d[t]=p))}else t&&(d[t]=s)},t=e=f=function(t,e,s,r,n){return"string"==typeof t?g[t]?g[t](e):u(m(t,e).f):(t.splice||(_=t,e.splice?(t=e,e=s,s=null):t=i),e=e||function(){},"function"==typeof s&&(s=r,r=n),r?c(i,t,e,s):setTimeout(function(){c(i,t,e,s)},4),f)},f.config=function(t){return _=t,_.deps&&f(_.deps,_.callback),f},s=function(t,e,i){e.splice||(i=e,e=[]),r(d,t)||r(b,t)||(b[t]=[t,e,i])},s.amd={jQuery:!0}}(),s("almond",function(){}),s("domready",[],function(){function t(t){var e;for(e=0;e<t.length;e+=1)t[e](u)}function e(){var e=h;l&&e.length&&(h=[],t(e))}function i(){l||(l=!0,a&&clearInterval(a),e())}function s(t){return l?t(u):h.push(t),s}var r,n,a,o="undefined"!=typeof window&&window.document,l=!o,u=o?document:null,h=[];if(o){if(document.addEventListener)document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1);else if(window.attachEvent){window.attachEvent("onload",i),n=document.createElement("div");try{r=null===window.frameElement}catch(p){}n.doScroll&&r&&window.external&&(a=setInterval(function(){try{n.doScroll(),i()}catch(t){}},30))}"complete"===document.readyState&&i()}return s.version="2.0.1",s.load=function(t,e,i,r){r.isBuild?i(null):s(i)},s}),s("citeproc",[],function(){Array.indexOf||(Array.prototype.indexOf=function(t){var e,i;for(e=0,i=this.length;i>e;e+=1)if(this[e]===t)return e;return-1});var t={PROCESSOR_VERSION:"1.0.517",CONDITION_LEVEL_TOP:1,CONDITION_LEVEL_BOTTOM:2,PLAIN_HYPHEN_REGEX:/(?:[^\\]-|\u2013)/,LOCATOR_LABELS_REGEXP:new RegExp("^((art|ch|Ch|subch|col|fig|l|n|no|op|p|pp|para|subpara|pt|r|sec|subsec|Sec|sv|sch|tit|vrs|vol)\\.)\\s+(.*)"),STATUTE_SUBDIV_GROUPED_REGEX:/((?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/g,STATUTE_SUBDIV_PLAIN_REGEX:/(?:(?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/,STATUTE_SUBDIV_STRINGS:{"art.":"article","bk.":"book","ch.":"chapter","Ch.":"Chapter","subch.":"subchapter","p.":"page","pp.":"page","para.":"paragraph","subpara.":"subparagraph","pt.":"part","r.":"rule","sec.":"section","subsec.":"subsection","Sec.":"Section","sch.":"schedule","tit.":"title","col.":"column","fig.":"figure","fol.":"folio","l.":"line","n.":"note","no.":"issue","op.":"opus","sv.":"sub-verbo","vrs.":"verse","vol.":"volume"},STATUTE_SUBDIV_STRINGS_REVERSE:{article:"art.",book:"bk.",chapter:"ch.",Chapter:"Ch.",subchapter:"subch.",page:"p.",paragraph:"para.",subparagraph:"subpara.",part:"pt.",rule:"r.",section:"sec.",subsection:"subsec.",Section:"Sec.",schedule:"sch.",title:"tit.",column:"col.",figure:"fig.",folio:"fol.",line:"l.",note:"n.",issue:"no.",opus:"op.","sub-verbo":"sv.","sub verbo":"sv.",verse:"vrs.",volume:"vol."},LOCATOR_LABELS_MAP:{art:"article",bk:"book",ch:"chapter",Ch:"Chapter",subch:"subchapter",col:"column",fig:"figure",fol:"folio",l:"line",n:"note",no:"issue",op:"opus",p:"page",pp:"page",para:"paragraph",subpara:"subparagraph",pt:"part",r:"rule",sec:"section",subsec:"subsection",Sec:"Section",sv:"sub-verbo",sch:"schedule",tit:"title",vrs:"verse",vol:"volume"},NestedBraces:[["(","["],[")","]"]],checkNestedBraceOpen:new RegExp(".*\\("),checkNestedBraceClose:new RegExp(".*\\)"),LangPrefsMap:{title:"titles","title-short":"titles","container-title":"journals","collection-title":"journals",publisher:"publishers",authority:"publishers","publisher-place":"places","event-place":"places",number:"number",edition:"number",issue:"number",volume:"number"},AbbreviationSegments:function(){this["container-title"]={},this["collection-title"]={},this["institution-entire"]={},this["institution-part"]={},this.nickname={},this.number={},this.title={},this.place={},this.hereinafter={},this.classic={},this["container-phrase"]={},this["title-phrase"]={}},GENDERS:["masculine","feminine"],ERROR_NO_RENDERED_FORM:1,PREVIEW:"Just for laughs.",ASSUME_ALL_ITEMS_REGISTERED:2,START:0,END:1,SINGLETON:2,SEEN:6,SUCCESSOR:3,SUCCESSOR_OF_SUCCESSOR:4,SUPPRESS:5,SINGULAR:0,PLURAL:1,LITERAL:!0,BEFORE:1,AFTER:2,DESCENDING:1,ASCENDING:2,ONLY_FIRST:1,ALWAYS:2,ONLY_LAST:3,FINISH:1,POSITION_FIRST:0,POSITION_SUBSEQUENT:1,POSITION_IBID:2,POSITION_IBID_WITH_LOCATOR:3,MARK_TRAILING_NAMES:!0,POSITION_TEST_VARS:["position","first-reference-note-number","near-note"],AREAS:["citation","citation_sort","bibliography","bibliography_sort"],MULTI_FIELDS:["event","publisher","publisher-place","event-place","title","container-title","collection-title","authority","edition","genre","title-short","medium","jurisdiction","archive","archive-place"],CITE_FIELDS:["first-reference-note-number","locator","locator-revision"],MINIMAL_NAME_FIELDS:["literal","family"],SWAPPING_PUNCTUATION:[".","!","?",":",","],TERMINAL_PUNCTUATION:[":",".",";","!","?"," "],NONE:0,NUMERIC:1,POSITION:2,COLLAPSE_VALUES:["citation-number","year","year-suffix"],DATE_PARTS:["year","month","day"],DATE_PARTS_ALL:["year","month","day","season"],DATE_PARTS_INTERNAL:["year","month","day","year_end","month_end","day_end"],NAME_PARTS:["family","given","dropping-particle","non-dropping-particle","suffix","literal"],DECORABLE_NAME_PARTS:["given","family","suffix"],DISAMBIGUATE_OPTIONS:["disambiguate-add-names","disambiguate-add-givenname","disambiguate-add-year-suffix"],GIVENNAME_DISAMBIGUATION_RULES:["all-names","all-names-with-initials","primary-name","primary-name-with-initials","by-cite"],NAME_ATTRIBUTES:["and","delimiter-precedes-last","delimiter-precedes-et-al","initialize-with","initialize","name-as-sort-order","sort-separator","et-al-min","et-al-use-first","et-al-subsequent-min","et-al-subsequent-use-first","form","prefix","suffix","delimiter"],PARALLEL_MATCH_VARS:["container-title"],PARALLEL_TYPES:["bill","gazette","regulation","legislation","legal_case","treaty","article-magazine","article-journal"],PARALLEL_COLLAPSING_MID_VARSET:["volume","issue","container-title","section","collection-number"],LOOSE:0,STRICT:1,TOLERANT:2,PREFIX_PUNCTUATION:/[.;:]\s*$/,SUFFIX_PUNCTUATION:/^\s*[.;:,\(\)]/,NUMBER_REGEXP:/(?:^\d+|\d+$)/,NAME_INITIAL_REGEXP:/^([A-Z\u0590-\u05ff\u0080-\u017f\u0400-\u042f\u0600-\u06ff\u0370\u0372\u0376\u0386\u0388-\u03ab\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03fd-\u03ff])([a-zA-Z\u0080-\u017f\u0400-\u052f\u0600-\u06ff\u0370-\u03ff\u1f00-\u1fff]*|)/,ROMANESQUE_REGEXP:/[-0-9a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ROMANESQUE_NOT_REGEXP:/[^a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/g,STARTSWITH_ROMANESQUE_REGEXP:/^[&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ENDSWITH_ROMANESQUE_REGEXP:/[.;:&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]$/,ALL_ROMANESQUE_REGEXP:/^[a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]+$/,VIETNAMESE_SPECIALS:/[\u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]/,VIETNAMESE_NAMES:/^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]{2,6})(\s+|$))+$/,NOTE_FIELDS_REGEXP:/\{:(?:[\-_a-z]+|[A-Z]+):[^\}]+\}/g,NOTE_FIELD_REGEXP:/\{:([\-_a-z]+|[A-Z]+):\s*([^\}]+)\}/,DISPLAY_CLASSES:["block","left-margin","right-inline","indent"],NAME_VARIABLES:["author","editor","translator","contributor","collection-editor","composer","container-author","director","editorial-director","interviewer","original-author","recipient"],NUMERIC_VARIABLES:["call-number","chapter-number","collection-number","edition","page","issue","locator","number","number-of-pages","number-of-volumes","volume","citation-number"],DATE_VARIABLES:["locator-date","issued","event-date","accessed","container","original-date","publication-date","original-date","available-date","submitted"],TAG_ESCAPE:function(t){var e,i,s,r,n;for(e=t.match(/((?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),i=t.split(/(?:(?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),n=[i[0]],r=1,s=i.length;s>r;r+=1)n.push(e[r-1]),n.push(i[r]);return i=n.slice()},TAG_USEALL:function(t){var e,i,s,r;for(e=[""],i=t.indexOf("<"),s=t.indexOf(">");i>-1&&s>-1;)r=i>s?i+1:s+1,s>i&&-1===t.slice(i+1,s).indexOf("<")?(e[e.length-1]+=t.slice(0,i),e.push(t.slice(i,s+1)),e.push(""),t=t.slice(r)):(e[e.length-1]+=t.slice(0,s+1),t=t.slice(r)),i=t.indexOf("<"),s=t.indexOf(">");return e[e.length-1]+=t,e},SKIP_WORDS:["about","above","across","afore","after","against","along","alongside","amid","amidst","among","amongst","anenst","apropos","apud","around","as","aside","astride","at","athwart","atop","barring","before","behind","below","beneath","beside","besides","between","beyond","but","by","circa","despite","down","during","except","for","forenenst","from","given","in","inside","into","lest","like","modulo","near","next","notwithstanding","of","off","on","onto","out","over","per","plus","pro","qua","sans","since","than","through"," thru","throughout","thruout","till","to","toward","towards","under","underneath","until","unto","up","upon","versus","vs.","v.","vs","v","via","vis-à-vis","with","within","without","according to","ahead of","apart from","as for","as of","as per","as regards","aside from","back to","because of","close to","due to","except for","far from","inside of","instead of","near to","next to","on to","out from","out of","outside of","prior to","pursuant to","rather than","regardless of","such as","that of","up to","where as","or","yet","so","for","and","nor","a","an","the","de","d'","von","van","c","et","ca"],FORMAT_KEY_SEQUENCE:["@strip-periods","@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align","@quotes"],INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"],SUFFIX_CHARS:"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",ROMAN_NUMERALS:[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xc"],["","c","cc","ccc","cd","d","dc","dcc","dccc","cm"],["","m","mm","mmm","mmmm","mmmmm"]],CREATORS:["author","editor","contributor","translator","recipient","interviewer","composer","original-author","container-author","collection-editor"],LANGS:{"af-ZA":"Afrikaans","ar-AR":"Arabic","bg-BG":"Bulgarian","ca-AD":"Catalan","cs-CZ":"Czech","da-DK":"Danish","de-AT":"Austrian","de-CH":"German (CH)","de-DE":"German (DE)","el-GR":"Greek","en-GB":"English (GB)","en-US":"English (US)","es-ES":"Spanish","et-EE":"Estonian",eu:"European","fa-IR":"Persian","fi-FI":"Finnish","fr-CA":"French (CA)","fr-FR":"French (FR)","he-IL":"Hebrew","hr-HR":"Croatian","hu-HU":"Hungarian","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","km-KH":"Khmer","ko-KR":"Korean","lt-LT":"Lithuanian","lv-LV":"Latvian","mn-MN":"Mongolian","nb-NO":"Norwegian (Bokmål)","nl-NL":"Dutch","nn-NO":"Norwegian (Nynorsk)","pl-PL":"Polish","pt-BR":"Portuguese (BR)","pt-PT":"Portuguese (PT)","ro-RO":"Romanian","ru-RU":"Russian","sk-SK":"Slovak","sl-SI":"Slovenian","sr-RS":"Serbian","sv-SE":"Swedish","th-TH":"Thai","tr-TR":"Turkish","uk-UA":"Ukranian","vi-VN":"Vietnamese","zh-CN":"Chinese (CN)","zh-TW":"Chinese (TW)"},LANG_BASES:{af:"af_ZA",ar:"ar_AR",bg:"bg_BG",ca:"ca_AD",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_US",es:"es_ES",et:"et_EE",eu:"eu",fa:"fa_IR",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hu:"hu_HU",is:"is_IS",it:"it_IT",ja:"ja_JP",km:"km_KH",ko:"ko_KR",lt:"lt_LT",mn:"mn_MN",nb:"nb_NO",nl:"nl_NL",nn:"nn-NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",uk:"uk_UA",vi:"vi_VN",zh:"zh_CN"},SUPERSCRIPTS:{"ª":"a","²":"2","³":"3","¹":"1","º":"o","ʰ":"h","ʱ":"ɦ","ʲ":"j","ʳ":"r","ʴ":"ɹ","ʵ":"ɻ","ʶ":"ʁ","ʷ":"w","ʸ":"y","ˠ":"ɣ","ˡ":"l","ˢ":"s","ˣ":"x","ˤ":"ʕ","ᴬ":"A","ᴭ":"Æ","ᴮ":"B","ᴰ":"D","ᴱ":"E","ᴲ":"Ǝ","ᴳ":"G","ᴴ":"H","ᴵ":"I","ᴶ":"J","ᴷ":"K","ᴸ":"L","ᴹ":"M","ᴺ":"N","ᴼ":"O","ᴽ":"Ȣ","ᴾ":"P","ᴿ":"R","ᵀ":"T","ᵁ":"U","ᵂ":"W","ᵃ":"a","ᵄ":"ɐ","ᵅ":"ɑ","ᵆ":"ᴂ","ᵇ":"b","ᵈ":"d","ᵉ":"e","ᵊ":"ə","ᵋ":"ɛ","ᵌ":"ɜ","ᵍ":"g","ᵏ":"k","ᵐ":"m","ᵑ":"ŋ","ᵒ":"o","ᵓ":"ɔ","ᵔ":"ᴖ","ᵕ":"ᴗ","ᵖ":"p","ᵗ":"t","ᵘ":"u","ᵙ":"ᴝ","ᵚ":"ɯ","ᵛ":"v","ᵜ":"ᴥ","ᵝ":"β","ᵞ":"γ","ᵟ":"δ","ᵠ":"φ","ᵡ":"χ","⁰":"0","ⁱ":"i","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9","⁺":"+","⁻":"−","⁼":"=","⁽":"(","⁾":")","ⁿ":"n","℠":"SM","™":"TM","㆒":"一","㆓":"二","㆔":"三","㆕":"四","㆖":"上","㆗":"中","㆘":"下","㆙":"甲","㆚":"乙","㆛":"丙","㆜":"丁","㆝":"天","㆞":"地","㆟":"人","ˀ":"ʔ","ˁ":"ʕ","ۥ":"و","ۦ":"ي"},SUPERSCRIPTS_REGEXP:new RegExp("[ª²³¹ºʰʱʲʳʴʵʶʷʸˠˡˢˣˤᴬᴭᴮᴰᴱᴲᴳᴴᴵᴶᴷᴸᴹᴺᴼᴽᴾᴿᵀᵁᵂᵃᵄᵅᵆᵇᵈᵉᵊᵋᵌᵍᵏᵐᵑᵒᵓᵔᵕᵖᵗᵘᵙᵚᵛᵜᵝᵞᵟᵠᵡ⁰ⁱ⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿ℠™㆒㆓㆔㆕㆖㆗㆘㆙㆚㆛㆜㆝㆞㆟ˀˁۥۦ]","g"),locale:{},locale_opts:{},locale_dates:{}};if(t.TERMINAL_PUNCTUATION_REGEXP=new RegExp("^(["+t.TERMINAL_PUNCTUATION.slice(0,-1).join("")+"])(.*)"),t.CLOSURES=new RegExp(".*[\\]\\)]"), false&&false?(t.debug=function(t){},t.error=function(t){}):(t.debug=function(){},t.error=function(t){throw"CSL error: "+t}),"undefined"==typeof e)var e;var s=function(){"undefined"==typeof DOMParser||e?(e=!0,DOMParser=function(){},DOMParser.prototype.parseFromString=function(t,e){if("undefined"!=typeof ActiveXObject){var i=new ActiveXObject("MSXML.DomDocument");return i.async=!1,i.loadXML(t),i}if("undefined"!=typeof XMLHttpRequest){var i=new XMLHttpRequest;return e||(e="text/xml"),i.open("GET","data:"+e+";charset=utf-8,"+encodeURIComponent(t),!1),i.overrideMimeType&&i.overrideMimeType(e),i.send(null),i.responseXML}},this.hasAttributes=function(t){var e;return e=t.attributes&&t.attributes.length?!0:!1}):this.hasAttributes=function(t){var e;return e=t.attributes&&t.attributes.length?!0:!1},this.importNode=function(t,e){if("undefined"==typeof t.importNode)var i=this._importNode(t,e,!0);else var i=t.importNode(e,!0);return i},this._importNode=function(t,e,i){switch(e.nodeType){case 1:var s=t.createElement(e.nodeName);if(e.attributes&&e.attributes.length>0)for(var r=0,n=e.attributes.length;n>r;)s.setAttribute(e.attributes[r].nodeName,e.getAttribute(e.attributes[r++].nodeName));if(i&&e.childNodes&&e.childNodes.length>0)for(var r=0,n=e.childNodes.length;n>r;)s.appendChild(this._importNode(t,e.childNodes[r++],i));return s;case 3:case 4:case 8:}},this.parser=new DOMParser;var t='<docco><institution institution-parts="long" delimiter=", " substitute-use-first="1" use-last="1"><institution-part name="long"/></institution></docco>',i=this.parser.parseFromString(t,"text/xml"),s=i.getElementsByTagName("institution");this.institution=s.item(0);var r=i.getElementsByTagName("institution-part");this.institutionpart=r.item(0),this.ns="http://purl.org/net/xbiblio/csl"};s.prototype.clean=function(t){return t=t.replace(/<\?[^?]+\?>/g,""),t=t.replace(/<![^>]+>/g,""),t=t.replace(/^\s+/,""),t=t.replace(/\s+$/,""),t=t.replace(/^\n*/,"")},s.prototype.getStyleId=function(t){var e="",i=t.getElementsByTagName("id");return i&&i.length&&(i=i.item(0)),i&&(e=i.textContent),e||(e=i.innerText),e||(e=i.innerHTML),e},s.prototype.children=function(t){var e,i,s,r;if(t){for(r=[],e=t.childNodes,i=0,s=e.length;s>i;i+=1)"#text"!=e[i].nodeName&&r.push(e[i]);return r}return[]},s.prototype.nodename=function(t){var e=t.nodeName;return e},s.prototype.attributes=function(t){var e,i,s,r,n;if(e=new Object,t&&this.hasAttributes(t))for(i=t.attributes,r=0,n=i.length;n>r;r+=1)s=i[r],e["@"+s.name]=s.value;return e},s.prototype.content=function(t){var e;return e="undefined"!=typeof t.textContent?t.textContent:"undefined"!=typeof t.innerText?t.innerText:t.txt},s.prototype.namespace={xml:"http://www.w3.org/XML/1998/namespace"},s.prototype.numberofnodes=function(t){return t?t.length:0},s.prototype.getAttributeName=function(t){var e=t.name;return e},s.prototype.getAttributeValue=function(t,e,i){var s="";return i&&(e=i+":"+e),t&&this.hasAttributes(t)&&t.getAttribute(e)&&(s=t.getAttribute(e)),s},s.prototype.getNodeValue=function(t,e){var i="";if(e){var s=t.getElementsByTagName(e);s.length>0&&(i="undefined"!=typeof s[0].textContent?s[0].textContent:"undefined"!=typeof s[0].innerText?s[0].innerText:s[0].text)}else i=t;return i&&i.childNodes&&(0==i.childNodes.length||1==i.childNodes.length&&"#text"==i.firstChild.nodeName)&&(i="undefined"!=typeof i.textContent?i.textContent:"undefined"!=typeof i.innerText?i.innerText:i.text),i},s.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(t,e,i,s,r){var n,a,o,l;for("@"===s.slice(0,1)&&(s=s.slice(1)),o=t.getElementsByTagName(e),n=0,a=o.length;a>n;n+=1)l=o[n],l.getAttribute("name")==i&&l.setAttribute(s,r)},s.prototype.deleteNodeByNameAttribute=function(t,e){var i,s,r,n;for(n=t.childNodes,i=0,s=n.length;s>i;i+=1)r=n[i],r&&r.nodeType!=r.TEXT_NODE&&this.hasAttributes(r)&&r.getAttribute("name")==e&&t.removeChild(n[i])},s.prototype.deleteAttribute=function(t,e){t.removeAttribute(e)},s.prototype.setAttribute=function(t,e,i){return t.ownerDocument||(t=t.firstChild),["function","unknown"].indexOf(typeof t.setAttribute)>-1&&t.setAttribute(e,i),!1},s.prototype.nodeCopy=function(t){var e=t.cloneNode(!0);return e},s.prototype.getNodesByName=function(t,e,i){var s,r,n,a,o;for(s=[],r=t.getElementsByTagName(e),a=0,o=r.length;o>a;a+=1)n=r.item(a),(!i||this.hasAttributes(n)&&n.getAttribute("name")==i)&&s.push(n);return s},s.prototype.nodeNameIs=function(t,e){return e==t.nodeName?!0:!1},s.prototype.makeXml=function(t){t||(t="<docco><bogus/></docco>"),t=t.replace(/\s*<\?[^>]*\?>\s*\n*/g,"");var e=this.parser.parseFromString(t,"application/xml");return e.firstChild},s.prototype.insertChildNodeAfter=function(t,e,i,s){var r;return r=this.importNode(e.ownerDocument,s),t.replaceChild(r,e),t},s.prototype.insertPublisherAndPlace=function(t){for(var e=t.getElementsByTagName("group"),i=0,s=e.length;s>i;i+=1){for(var r=e.item(i),n=[],a=0,o=r.childNodes.length;o>a;a+=1)1!==r.childNodes.item(a).nodeType&&n.push(a);if(2===r.childNodes.length-n.length){for(var l=[],a=0,o=2;o>a;a+=1)if(!(n.indexOf(a)>-1)){for(var u=r.childNodes.item(a),h=[],p=0,c=u.childNodes.length;c>p;p+=1)1!==u.childNodes.item(p).nodeType&&h.push(p);if(0===u.childNodes.length-h.length&&(l.push(u.getAttribute("variable")),u.getAttribute("suffix")||u.getAttribute("prefix"))){l=[];break}}l.indexOf("publisher")>-1&&l.indexOf("publisher-place")>-1&&r.setAttribute("has-publisher-and-publisher-place",!0)}}},s.prototype.addMissingNameNodes=function(t){for(var e=t.getElementsByTagName("names"),i=0,s=e.length;s>i;i+=1){var r=e.item(i),n=r.getElementsByTagName("name");if((!n||0===n.length)&&"substitute"!==r.parentNode.tagName.toLowerCase()){var a=r.ownerDocument,o=a.createElement("name");r.appendChild(o)}}},s.prototype.addInstitutionNodes=function(e){var i,s,r,n,a,o,l,u;for(i=e.getElementsByTagName("names"),l=0,u=i.length;u>l;l+=1)if(s=i.item(l),a=s.getElementsByTagName("name"),0!=a.length&&(r=s.getElementsByTagName("institution"),0==r.length)){n=this.importNode(e.ownerDocument,this.institution),theinstitutionpart=n.getElementsByTagName("institution-part").item(0),o=a.item(0),s.insertBefore(n,o.nextSibling);for(var h=0,p=t.INSTITUTION_KEYS.length;p>h;h+=1){var c=t.INSTITUTION_KEYS[h],f=o.getAttribute(c);f&&theinstitutionpart.setAttribute(c,f)}for(var m=o.getElementsByTagName("name-part"),h=0,p=m.length;p>h;h+=1)if("family"===m[h].getAttribute("name"))for(var g=0,d=t.INSTITUTION_KEYS.length;d>g;g+=1){var c=t.INSTITUTION_KEYS[g],f=m[h].getAttribute(c);f&&theinstitutionpart.setAttribute(c,f)}}},s.prototype.flagDateMacros=function(t){var e,i,s,r;for(nodes=t.getElementsByTagName("macro"),e=0,i=nodes.length;i>e;e+=1)s=nodes.item(e),r=s.getElementsByTagName("date"),r.length&&s.setAttribute("macro-has-date","true")};var r;return r="undefined"!=typeof CSL_IS_NODEJS?CSL_NODEJS:"undefined"!=typeof CSL_E4X?CSL_E4X:"undefined"!=typeof CSL_JSON?CSL_JSON:s,t.System={},t.System.Xml={Parsing:r},t.getSortCompare=function(e){if(t.stringCompare)return t.stringCompare;var i;e||(e="en-US");try{var s=Components.classes["@mozilla.org/intl/nslocaleservice;1"].getService(Components.interfaces.nsILocaleService),r=Components.classes["@mozilla.org/intl/collation-factory;1"].getService(Components.interfaces.nsICollationFactory),n=r.CreateCollation(s.newLocale(e));i=function(t,e){return n.compareString(1,t,e)},t.debug("Using collation sort: "+e)}catch(a){t.debug("Using localeCompare sort"),i=function(t,e){return t.toLocaleLowerCase().localeCompare(e.toLocaleLowerCase())}}var o=/^[\[\]\'\"]*[\u3040-\u309f\u30a0-\u30ff]/,l=function(t){return t.replace(/^[\[\]\'\"]*/g,"")},u=function(){return i("い","う")?!1:function(t,e){t=l(t),e=l(e);var i=o.exec(t),s=o.exec(e);return i||s?i?s?e>t?-1:t>e?1:0:1:-1:!1}},h=function(){return i("[x","x")?function(t,e){return i(l(t),l(e))}:!1},p=u(),c=h(),f=function(t,e){if(p){var s=p(t,e);if(!1!==s)return s}return c?c(t,e):i(t,e)};return f},t.ambigConfigDiff=function(t,e){var i,s,r,n;if(t.names.length!==e.names.length)return 1;for(i=0,s=t.names.length;s>i;i+=1){if(t.names[i]!==e.names[i])return 1;for(r=0,n=t.givens[i];n>r;r+=1)if(t.givens[i][r]!==e.givens[i][r])return 1}return t.disambiguate!=e.disambiguate?1:t.year_suffix!==e.year_suffix?1:0},t.cloneAmbigConfig=function(t,e){var i,s,r,n,a,o={};for(o.names=[],o.givens=[],o.year_suffix=!1,o.disambiguate=!1,i=0,s=t.names.length;s>i;i+=1)a=t.names[i],o.names[i]=a;for(i=0,s=t.givens.length;s>i;i+=1){for(a=[],r=0,n=t.givens[i].length;n>r;r+=1)a.push(t.givens[i][r]);o.givens.push(a)}return e?(o.year_suffix=e.year_suffix,o.disambiguate=e.disambiguate):(o.year_suffix=t.year_suffix,o.disambiguate=t.disambiguate),o},t.getAmbigConfig=function(){var e,i;return e=this.tmp.disambig_request,e||(e=this.tmp.disambig_settings),i=t.cloneAmbigConfig(e)},t.getMaxVals=function(){return this.tmp.names_max.mystack.slice()},t.getMinVal=function(){return this.tmp["et-al-min"]},t.tokenExec=function(t,e,i){var s,r,n,a,o,l;l=!1,s=t.next,r=!1;var u=function(e){return e?(this.tmp.jump.replace("succeed"),t.succeed):(this.tmp.jump.replace("fail"),t.fail)};for(t.test&&(s=u.call(this,t.test(e,i))),o=t.execs.length,a=0;o>a;a+=1)n=t.execs[a],r=n.call(t,this,e,i),r&&(s=r);return s},t.expandMacro=function(e){var i,s,r,n;if(i=e.postponed_macro,this.build.macro_stack.indexOf(i)>-1)throw'CSL processor error: call to macro "'+i+'" would cause an infinite loop';this.build.macro_stack.push(i);var a=!1,o=!1;if(s=this.sys.xml.getNodesByName(this.cslXml,"macro",i),s.length&&(o=this.sys.xml.getAttributeValue(s[0],"cslid"),a=this.sys.xml.getAttributeValue(s[0],"macro-has-date")),a&&(n=function(t){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!0)},e.execs.push(n)),e.tokentype=t.START,e.cslid=o,t.Node.group.build.call(e,this,this[this.build.area].tokens,!0),!this.sys.xml.getNodeValue(s))throw'CSL style error: undefined macro "'+i+'"';var l=t.makeBuilder(this);l(s[0]),r=new t.Token("group",t.END),e.decorations&&(r.decorations=e.decorations.slice()),a&&(n=function(t){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!1)},r.execs.push(n)),t.Node.group.build.call(r,this,this[this.build.area].tokens,!0),this.build.macro_stack.pop()},t.XmlToToken=function(e,i){var s,r,n,a,o,l,u,h;if(s=e.sys.xml.nodename(this),!e.build.skip||e.build.skip===s){if(!s)return r=e.sys.xml.content(this),r&&(e.build.text=r),void 0;if(!t.Node[e.sys.xml.nodename(this)])throw'Undefined node name "'+s+'".';if(n=[],a=e.sys.xml.attributes(this),o=t.setDecorations.call(this,e,a),l=new t.Token(s,i),i!==t.END||"if"===s||"else-if"===s||"layout"===s){for(u in a)if(a.hasOwnProperty(u)){if(i===t.END&&"@language"!==u&&"@locale"!==u)continue;if(a.hasOwnProperty(u))if(t.Attributes[u])try{t.Attributes[u].call(l,e,""+a[u])}catch(p){throw t.error(p),"CSL processor error, "+u+" attribute: "+p}else t.debug('warning: undefined attribute "'+u+'" in style')}l.decorations=o}h=e[e.build.area].tokens,t.Node[s].build.call(l,e,h)}},t.DateParser=function(){var e,i,s,r,n,a,o,l,u,h,p,c,f,m,g,d,b,_,y,v,x,I,S,O,T;for(e=[["明治",1867],["大正",1911],["昭和",1925],["平成",1988]],i={},S=e.length,o=0;S>o;o+=1)l=e[o][0],u=e[o][1],i[l]=u;for(O=[],o=0;S>o;o+=1)u=e[o][0],O.push(u);for(O=O.join("|"),s="(?:"+O+")(?:[0-9]+)",s=new RegExp(s),T="(?:"+O+")(?:[0-9]+)",T=new RegExp(T,"g"),n=/(\u6708|\u5E74)/g,r=/\u65E5/,a=/\u301c/g,h="(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])",p="[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])",c="[?0-9]{1,3}",f="[%%DATED%%]",m="[?~]",g="[a-zA-Z]+",d="("+p+"|"+h+"|"+c+"|"+f+"|"+m+"|"+g+")",b=new RegExp(d.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"-")),_=new RegExp(d.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"/")),y=new RegExp(d.replace(/%%NUMD%%/g,"/").replace(/%%DATED%%/g,"-")),v=[],x=[],S=v.length,o=0;S>o;o+=1)I=new RegExp(v[o]+".*"),x.push(I);this.mstrings="january february march april may june july august september october november december spring summer fall winter spring summer",this.mstrings=this.mstrings.split(" "),this.setOrderDayMonth=function(){this.monthguess=1,this.dayguess=0},this.setOrderMonthDay=function(){this.monthguess=0,this.dayguess=1},this.setOrderMonthDay(),this.resetMonths=function(){var t,e,i,s;for(this.msets=[],t=0,e=this.mstrings.length;e>t;t+=1)this.msets.push([this.mstrings[t]]);for(this.mabbrevs=[],t=0,e=this.msets.length;e>t;t+=1)for(this.mabbrevs.push([]),i=0,s=this.msets[t].length;s>i;i+=1)this.mabbrevs[t].push(this.msets[t][0].slice(0,3));for(this.mrexes=[],t=0,e=this.mabbrevs.length;e>t;t+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[t].join("|")+")"))},this.resetMonths(),this.addMonths=function(e){var i,s,r,n,a,o,l,u;if("string"==typeof e&&(e=e.split(/\s+/)),12!==e.length&&16!==e.length)return t.debug("month [+season] list of "+e.length+", expected 12 or 16. Ignoring."),void 0;for(i=0,s=e.length;s>i;i+=1){var h=!1,p=!1,c=3,f={};for(r=0,n=this.mabbrevs.length;n>r;r+=1){if(f[r]={},r===i){for(a=0,o=this.mabbrevs[i].length;o>a;a+=1)if(this.mabbrevs[i][a]===e[i].slice(0,this.mabbrevs[i][a].length)){p=!0;break}}else for(a=0,o=this.mabbrevs[r].length;o>a;a+=1)if(h=this.mabbrevs[r][a].length,this.mabbrevs[r][a]===e[i].slice(0,h)){for(;this.msets[r][a].slice(0,h)===e[i].slice(0,h);){if(h>e[i].length||h>this.msets[r][a].length){t.debug("unable to disambiguate month string in date parser: "+e[i]);break}h+=1}c=h,f[r][a]=h}for(l in f)if(f.hasOwnProperty(l))for(u in f[l])f[l].hasOwnProperty(u)&&(h=f[l][u],l=parseInt(l,10),u=parseInt(u,10),this.mabbrevs[l][u]=this.msets[l][u].slice(0,h))}p||(this.msets[i].push(e[i]),this.mabbrevs[i].push(e[i].slice(0,c)))}for(this.mrexes=[],i=0,s=this.mabbrevs.length;s>i;i+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[i].join("|")+")"))},this.parse=function(e){var l,u,h,p,c,f,m,g,d,v,I,O,A,E,N,k,R,w,C,L,P,U,D,B,j,z,M,q,F,G;if(e&&(e=""+e,e=e.replace(/\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,""),c=e.match(n))){if(e=e.replace(/\s+/,"","g"),e=e.replace(r,"","g"),e=e.replace(n,"-","g"),e=e.replace(a,"/","g"),e=e.replace("-/","/","g"),e=e.replace(/-$/,"","g"),D=e.split(s),h=[],U=e.match(T)){var V=[];for(o=0,S=U.length;S>o;o+=1)V=V.concat(U[o].match(/([^0-9]+)([0-9]+)/).slice(1));for(o=0,S=D.length;S>o;o+=1)h.push(D[o]),o!==S-1&&(B=2*o,h.push(V[B]),h.push(V[B+1]))}else h=D;for(p=h.length,o=1;p>o;o+=3)h[o+1]=i[h[o]]+parseInt(h[o+1],10),h[o]="";e=h.join(""),e=e.replace(/\s*-\s*$/,"").replace(/\s*-\s*\//,"/"),e=e.replace(/\.\s*$/,""),e=e.replace(/\.(?! )/,""),l=e.indexOf("/"),u=e.indexOf("-")}if(e=e.replace(/([A-Za-z])\./g,"$1"),f="",m="",g={},'"'===e.slice(0,1)&&'"'===e.slice(-1))return g.literal=e.slice(1,-1),g;for(l>-1&&u>-1?(d=e.split("/"),d.length>3?(v="-",I="/",h=e.split(y)):(v="/",I="-",h=e.split(_))):(e=e.replace("/","-"),v="-",I="-",h=e.split(b)),O=[],S=h.length,o=0;S>o;o+=1)C=h[o],c=C.match(/^\s*([\-\/]|[a-zA-Z]+|[\-~?0-9]+)\s*$/),c&&O.push(c[1]);for(A=O.indexOf(v),E=[],N=!1,A>-1?(E.push([0,A]),E.push([A+1,O.length]),N=!0):E.push([0,O.length]),k="",j=0,z=E.length;z>j;j+=1){for(L=E[j],R=O.slice(L[0],L[1]),M=0,q=R.length;q>M;M+=1)if(P=R[M],P.indexOf(I)>-1)this.parseNumericDate(g,I,k,P);else if(P.match(/[0-9]{4}/))g["year"+k]=P.replace(/^0*/,"");else{for(w=!1,F=0,G=this.mrexes.length;G>F;F+=1){if(P.toLocaleLowerCase().match(this.mrexes[F])){g["month"+k]=""+(parseInt(F,10)+1),w=!0;break}w||(P.match(/^[0-9]+$/)&&(f=parseInt(P,10)),P.toLocaleLowerCase().match(/^bc/)&&f?(g["year"+k]=""+-1*f,f=""):P.toLocaleLowerCase().match(/^ad/)&&f&&(g["year"+k]=""+f,f=""))}for(w=!1,F=0,G=x.length;G>F;F+=1)if(P.toLocaleLowerCase().match(x[F])){g["season"+k]=""+(parseInt(F,10)+1),w=!0;break}w||("~"===P||"?"===P||"c"===P||P.match(/^cir/)?g.circa="1":!P.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/)||g["season"+k]||(m=P))}f&&(g["day"+k]=f,f=""),m&&!g["season"+k]&&(g["season"+k]=m,m=""),k="_end"}if(N)for(M=0,q=t.DATE_PARTS_ALL.length;q>M;M+=1)C=t.DATE_PARTS_ALL[M],g[C]&&!g[C+"_end"]?g[C+"_end"]=g[C]:!g[C]&&g[C+"_end"]&&(g[C]=g[C+"_end"]);return g.year||(g={literal:e}),this.use_array&&this.toArray(g),g},this.returnAsArray=function(){this.use_array=!0},this.returnAsKeys=function(){this.use_array=!1},this.toArray=function(t){var e,i,s;t["date-parts"]=[],t["date-parts"].push([]);var r=0;for(e=0,i=3;i>e&&(s=["year","month","day"][e],t[s]);e+=1)r+=1,t["date-parts"][0].push(t[s]),delete t[s];for(t["date-parts"].push([]),e=0,i=r;i>e&&(s=["year_end","month_end","day_end"][e],t[s]);e+=1)t["date-parts"][1].push(t[s]),delete t[s];t["date-parts"][0].length!==t["date-parts"][1].length&&t["date-parts"].pop()
},this.parseNumericDate=function(t,e,i,s){var r,n,a;for(r=s.split(e),n=0,a=r.length;a>n;n+=1)if(4===r[n].length){t["year"+i]=r[n].replace(/^0*/,""),r=n?r.slice(0,n):r.slice(1);break}for(n=0,a=r.length;a>n;n+=1)r[n]=parseInt(r[n],10);1===r.length||2===r.length&&!r[1]?t["month"+i]=""+r[0]:2===r.length&&(r[this.monthguess]>12?(t["month"+i]=""+r[this.dayguess],t["day"+i]=""+r[this.monthguess]):(t["month"+i]=""+r[this.monthguess],t["day"+i]=""+r[this.dayguess]))}},t.Engine=function(e,i,s,r){function n(t){var t=t.slice(),e=new RegExp("((?:[?!:]*\\s+|-|^)(?:"+t.join("|")+")(?=[!?:]*\\s+|-|$))");return e}var a,o;this.processor_version=t.PROCESSOR_VERSION,this.csl_version="1.0",this.sys=e,this.sys.xml=new t.System.Xml.Parsing,"undefined"==typeof CSL_JSON&&"string"!=typeof i&&(i=""),t.getAbbreviation&&(this.sys.getAbbreviation=t.getAbbreviation),this.sys.stringCompare&&(t.stringCompare=this.sys.stringCompare),this.sys.AbbreviationSegments=t.AbbreviationSegments,this.parallel=new t.Parallel(this),this.transform=new t.Transform(this),this.setParseNames=function(t){this.opt["parse-names"]=t},this.opt=new t.Engine.Opt,this.tmp=new t.Engine.Tmp,this.build=new t.Engine.Build,this.fun=new t.Engine.Fun(this),this.configure=new t.Engine.Configure,this.citation_sort=new t.Engine.CitationSort,this.bibliography_sort=new t.Engine.BibliographySort,this.citation=new t.Engine.Citation(this),this.bibliography=new t.Engine.Bibliography,this.output=new t.Output.Queue(this),this.dateput=new t.Output.Queue(this),this.cslXml=this.sys.xml.makeXml(i),this.opt.development_extensions.csl_reverse_lookup_support&&(this.build.cslNodeId=0,this.setCslNodeIds=function(t,e){var i=this.sys.xml.children(t);this.sys.xml.setAttribute(t,"cslid",this.build.cslNodeId),this.opt.nodenames.push(e),this.build.cslNodeId+=1;for(var s=0,r=this.sys.xml.numberofnodes(i);r>s;s+=1)e=this.sys.xml.nodename(i[s]),e&&this.setCslNodeIds(i[s],e)},this.setCslNodeIds(this.cslXml,"style")),this.sys.xml.addMissingNameNodes(this.cslXml),this.sys.xml.addInstitutionNodes(this.cslXml),this.sys.xml.insertPublisherAndPlace(this.cslXml),this.sys.xml.flagDateMacros(this.cslXml),a=this.sys.xml.attributes(this.cslXml),"undefined"==typeof a["@sort-separator"]&&this.sys.xml.setAttribute(this.cslXml,"sort-separator",", "),this.opt["initialize-with-hyphen"]=!0,this.setStyleAttributes(),this.opt.xclass=e.xml.getAttributeValue(this.cslXml,"class"),this.opt.styleID=this.sys.xml.getStyleId(this.cslXml),"1.1m"===this.opt.version.slice(0,4)&&(this.opt.development_extensions.static_statute_locator=!0,this.opt.development_extensions.handle_parallel_articles=!0,this.opt.development_extensions.main_title_from_short_title=!0,this.opt.development_extensions.strict_page_numbers=!0,this.opt.development_extensions.rtl_support=!0,this.opt.development_extensions.expect_and_symbol_form=!0,this.opt.development_extensions.require_explicit_legal_case_title_short=!0),s&&(s=s.replace("_","-")),this.opt["default-locale"][0]&&(this.opt["default-locale"][0]=this.opt["default-locale"][0].replace("_","-")),s&&r&&(this.opt["default-locale"]=[s]),s&&!r&&this.opt["default-locale"][0]&&(s=this.opt["default-locale"][0]),0===this.opt["default-locale"].length&&(s||(s="en-US"),this.opt["default-locale"].push("en-US")),s||(s=this.opt["default-locale"][0]),o=t.localeResolve(s),this.opt.lang=o.best,this.opt["default-locale"][0]=o.best,this.locale={},this.opt["default-locale-sort"]||(this.opt["default-locale-sort"]=this.opt["default-locale"][0]),this.localeConfigure(o),this.locale[this.opt.lang].opts["skip-words-regexp"]=n(this.locale[this.opt.lang].opts["skip-words"]),this.registry=new t.Registry(this),this.buildTokenLists("citation"),this.buildTokenLists("bibliography"),this.configureTokenLists(),this.disambiguate=new t.Disambiguation(this),this.splice_delimiter=!1,this.fun.dateparser=new t.DateParser,this.fun.flipflopper=new t.Util.FlipFlopper(this),this.setCloseQuotesArray(),this.fun.ordinalizer.init(this),this.fun.long_ordinalizer.init(this),this.fun.page_mangler=t.Util.PageRangeMangler.getFunction(this,"page"),this.fun.year_mangler=t.Util.PageRangeMangler.getFunction(this,"year"),this.setOutputFormat("html")},t.Engine.prototype.setCloseQuotesArray=function(){var t;t=[],t.push(this.getTerm("close-quote")),t.push(this.getTerm("close-inner-quote")),t.push('"'),t.push("'"),this.opt.close_quotes_array=t},t.makeBuilder=function(e){function i(i){t.XmlToToken.call(i,e,t.START)}function s(i){t.XmlToToken.call(i,e,t.END)}function r(i){t.XmlToToken.call(i,e,t.SINGLETON)}function n(a){var o;if(e.sys.xml.numberofnodes(e.sys.xml.children(a))){o=a,i(o);for(var l=0;l<e.sys.xml.numberofnodes(e.sys.xml.children(o));l+=1)a=e.sys.xml.children(o)[l],null!==e.sys.xml.nodename(a)&&("date"===e.sys.xml.nodename(a)&&(t.Util.fixDateNode.call(e,o,l,a),a=e.sys.xml.children(o)[l]),n(a,i,s,r));s(o)}else r(a)}return n},t.Engine.prototype.buildTokenLists=function(e){var i,s=t.makeBuilder(this);if(i=this.sys.xml.getNodesByName(this.cslXml,e),this.sys.xml.getNodeValue(i)){this.build.area=e;var r=i[0];s(r)}},t.Engine.prototype.setStyleAttributes=function(){var e,i,s;e={},e.name=this.sys.xml.nodename(this.cslXml),i=this.sys.xml.attributes(this.cslXml);for(s in i)i.hasOwnProperty(s)&&t.Attributes[s].call(e,this,i[s])},t.Engine.prototype.getTerm=function(e,i,s,r,n,a){e&&e.match(/[A-Z]/)&&e===e.toUpperCase()&&(t.debug("Warning: term key is in uppercase form: "+e),e=e.toLowerCase());var o;o=a?this.opt["default-locale"][0]:this.opt.lang;var l=t.Engine.getField(t.LOOSE,this.locale[o].terms,e,i,s,r);if(l||"range-delimiter"!==e||(l="–"),"undefined"==typeof l){if(n===t.STRICT)throw'Error in getTerm: term "'+e+'" does not exist.';n===t.TOLERANT&&(l="")}return l&&(this.tmp.cite_renders_content=!0),l},t.Engine.prototype.getDate=function(t,e){var i;return i=e?this.opt["default-locale"]:this.opt.lang,this.locale[i].dates[t]?this.locale[i].dates[t]:!1},t.Engine.prototype.getOpt=function(t){return"undefined"!=typeof this.locale[this.opt.lang].opts[t]?this.locale[this.opt.lang].opts[t]:!1},t.Engine.prototype.getVariable=function(e,i,s,r){return t.Engine.getField(t.LOOSE,e,i,s,r)},t.Engine.prototype.getDateNum=function(t,e){return"undefined"==typeof t?0:t[e]},t.Engine.getField=function(e,i,s,r,n,a){var o,l,u,h,p,c;if(o="","undefined"==typeof i[s]){if(e===t.STRICT)throw'Error in getField: term "'+s+'" does not exist.';return void 0}for(c=a&&i[s][a]?i[s][a]:i[s],l=[],"symbol"===r?l=["symbol","short"]:"verb-short"===r?l=["verb-short","verb"]:"long"!==r&&(l=[r]),l=l.concat(["long"]),p=l.length,h=0;p>h;h+=1)if(u=l[h],"string"==typeof c||"number"==typeof c)o=c;else if("undefined"!=typeof c[u]){o="string"==typeof c[u]||"number"==typeof c[u]?c[u]:"number"==typeof n?c[u][n]:c[u][0];break}return o},t.Engine.prototype.configureTokenLists=function(){var e,i,s,r,n,a,o,l,u,h,p;for(e=["year","month","day"],u=t.AREAS.length,s=0;u>s;s+=1)for(i=t.AREAS[s],h=this[i].tokens.length-1,o=h;o>-1;o+=-1){if(r=this[i].tokens[o],"date"===r.name&&t.END===r.tokentype&&(n=[]),"date-part"===r.name&&r.strings.name)for(p=e.length,l=0;p>l;l+=1)a=e[l],a===r.strings.name&&n.push(r.strings.name);"date"===r.name&&t.START===r.tokentype&&(n.reverse(),r.dateparts=n),r.next=o+1,r.name&&t.Node[r.name].configure&&t.Node[r.name].configure.call(r,this,o)}return this.version=t.version,this.state},t.Engine.prototype.retrieveItems=function(t){var e;e=[];for(var i=0,s=t.length;s>i;i+=1)e.push(this.retrieveItem(""+t[i]));return e},t.ITERATION=0,t.Engine.prototype.retrieveItem=function(e){var i,s,r,n,a;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&"boolean"==typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase){for(var o=0,l=this.opt["default-locale"].length;l>o;o+=1)this.opt["default-locale"][o]=this.opt["default-locale"][o].toLowerCase();for(var o=0,l=this.opt["locale-translit"].length;l>o;o+=1)this.opt["locale-translit"][o]=this.opt["locale-translit"][o].toLowerCase();for(var o=0,l=this.opt["locale-translat"].length;l>o;o+=1)this.opt["locale-translat"][o]=this.opt["locale-translat"][o].toLowerCase();this.opt.development_extensions.normalize_lang_keys_to_lowercase=100}if(t.ITERATION+=1,i=this.sys.retrieveItem(""+e),this.opt.development_extensions.normalize_lang_keys_to_lowercase){if(i.multi){if(i.multi._keys)for(var u in i.multi._keys)for(var h in i.multi._keys[u])h!==h.toLowerCase()&&(i.multi._keys[u][h.toLowerCase()]=i.multi._keys[u][h],delete i.multi._keys[u][h]);if(i.multi.main)for(var u in i.multi.main)i.multi.main[u]=i.multi.main[u].toLowerCase()}for(var o=0,l=t.CREATORS.length;o>l;o+=1){var p=t.CREATORS[o];if(i[p]&&i[p].multi)for(var c=0,f=i[p].length;f>c;c+=1){var m=i[p][c];if(m.multi){if(m.multi._key)for(var h in m.multi._key)h!==h.toLowerCase()&&(m.multi._key[h.toLowerCase()]=m.multi._key[h],delete m.multi._key[h]);m.multi.main&&(m.multi.main=m.multi.main.toLowerCase())}}}}if(i.page){i["page-first"]=i.page;var g=""+i.page;s=g.split(/\s*(?:&|,|-|\u2013)\s*/),"\\"!==s[0].slice(-1)&&(i["page-first"]=s[0])}if(this.opt.development_extensions.field_hack&&i.note&&(s=i.note.match(t.NOTE_FIELDS_REGEXP)))for(r=0,n=s.length;n>r;r+=1){if(a=s[r].match(t.NOTE_FIELD_REGEXP),!i[a[1]]&&t.DATE_VARIABLES.indexOf(a[1])>-1)i[a[1]]={raw:a[2]};else if(!i[a[1]]&&t.NAME_VARIABLES.indexOf(a[1])>-1){i[a[1]]||(i[a[1]]=[]);var d=a[2].split(/\s*\|\|\s*/);1===d.length?i[a[1]].push({family:d[0],isInstitution:!0}):2===d.length&&i[a[1]].push({family:d[0],given:d[1]})}else i[a[1]]&&"type"!==a[1]||(i[a[1]]=a[2].replace(/^\s+/,"").replace(/\s+$/,""));i.note.replace(t.NOTE_FIELD_REGEXP,"")}for(var o=1,l=t.DATE_VARIABLES.length;l>o;o+=1){var b=i[t.DATE_VARIABLES[o]];b&&(this.opt.development_extensions.raw_date_parsing&&b.raw&&(b=this.fun.dateparser.parse(b.raw)),i[t.DATE_VARIABLES[o]]=this.dateParseArray(b))}if(this.opt.development_extensions.static_statute_locator&&i.type&&["bill","gazette","legislation","treaty"].indexOf(i.type)>-1){var _,y=["type","title","jurisdiction","genre","volume","container-title"],v=[];for(o=0,l=y.length;l>o;o+=1)_=y[o],i[_]&&v.push(i[_]);for(y=["original-date","issued"],o=0,y.length;l>o;o+=1)if(_=y[o],i[_]&&i[_].year){var x=i[_].year;v.push(x);break}i.legislation_id=v.join("::")}this.opt.development_extensions.main_title_from_short_title&&(i["title-main"]=i.title,i["title-sub"]=!1,i.title&&i.shortTitle&&(offset=i.shortTitle.length,i.title.slice(0,offset)===i.shortTitle&&i.title.slice(offset).match(/^\s*:/)&&(i["title-main"]=i.title.slice(0,offset).replace(/\s+$/,""),i["title-sub"]=i.title.slice(offset).replace(/^\s*:\s*/,"")))),i["title-short"]||(i["title-short"]=i.shortTitle);var I=["legal_case","legislation","gazette","regulation"].indexOf(i.type)>-1;if(!I&&i.title&&this.sys.getAbbreviation){var S=!1;i.jurisdiction||(S=!0);var O=this.transform.loadAbbreviation(i.jurisdiction,"title",i.title,i.type,!0);this.transform.abbrevs[O].title&&this.transform.abbrevs[O].title[i.title]&&(i["title-short"]=this.transform.abbrevs[O].title[i.title])}if(i["container-title-short"]=i.journalAbbreviation,i["container-title"]&&this.sys.getAbbreviation){var O=this.transform.loadAbbreviation(i.jurisdiction,"title",i["container-title"]);this.transform.abbrevs[O].title&&this.transform.abbrevs[O].title[i["container-title"]]&&(i["container-title-short"]=this.transform.abbrevs[O].title[i["container-title"]])}return i},t.Engine.prototype.setOpt=function(t,e,i){"style"===t.name||"cslstyle"===t.name?this.opt[e]=i:["citation","bibliography"].indexOf(t.name)>-1?this[t.name].opt[e]=i:-1===["name-form","name-delimiter","names-delimiter"].indexOf(e)&&(t.strings[e]=i)},t.Engine.prototype.fixOpt=function(t,e,i){["citation","bibliography"].indexOf(t.name)>-1&&(this[t.name].opt[e]||"undefined"==typeof this.opt[e]||(this[t.name].opt[e]=this.opt[e])),("name"===t.name||"names"===t.name)&&"undefined"==typeof t.strings[i]&&"undefined"!=typeof this[this.build.root].opt[e]&&(t.strings[i]=this[this.build.root].opt[e])},t.Engine.prototype.remapSectionVariable=function(e){for(var i=0,s=e.length;s>i;i+=1){var r=e[i][0],n=e[i][1],a=!1;if(["bill","gazette","legislation","treaty"].indexOf(r.type)>-1){n.force_pluralism=0,n.label||(n.label="page");var o=["section","","",""];if(this.opt.development_extensions.static_statute_locator&&r.section?(l=r.section.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/),t.STATUTE_SUBDIV_STRINGS[l[0]]?(o[0]=" "+l[0]+" ",o[1]=l.slice(1).join(" ")):(o[0]=" sec. ",o[1]=l.slice(0).join(" "))):this.opt.development_extensions.clobber_locator_if_no_statute_section&&(n.locator=void 0,n.label=void 0),n.locator){var l=n.locator.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/);t.STATUTE_SUBDIV_STRINGS[l[0]]?(o[2]=" "+l[0]+" ",o[3]=l.slice(1).join(" ")):n.label?(o[2]=" "+t.STATUTE_SUBDIV_STRINGS_REVERSE[n.label]+" ",o[3]=l.slice(0).join(" ")):o[3]=l.join(" "),o[3]&&"&"===o[3].slice(0,1)&&(o[3]=" "+o[3])}if(o[2]||(o[2]=o[0]),o[3]){if(o[3].match(/^[^0-9a-zA-Z]/)){var u=o[3].split(/\s+/);o[0]===o[2]&&u[1]&&!t.STATUTE_SUBDIV_STRINGS[u[1].replace(/\s+/,"").replace(/\s+/,"")]&&(n.force_pluralism=1),o[2]=""}}else o[2]="";o[1]||(o[0]="");var a=o.join("");if(a=a.replace(/^\s+/,"").replace(/\s+$/,""))if(l=a.split(/\s+/),t.STATUTE_SUBDIV_STRINGS[l[0]]){for(var h=l.length-2;h>0;h+=-2)l[h]===l[0]&&(n.force_pluralism=1,l=l.slice(0,h).concat(l.slice(h+1)));n.label=t.STATUTE_SUBDIV_STRINGS[l[0]],n.locator=l.slice(1).join(" "),0===n.force_pluralism&&delete n.force_pluralism}else n.locator=l.slice(0).join(" ")}}},t.Engine.prototype.setNumberLabels=function(e){if(e.number&&["bill","gazette","legislation","treaty"].indexOf(e.type)>-1&&this.opt.development_extensions.static_statute_locator&&!this.tmp.shadow_numbers.number){this.tmp.shadow_numbers.number={},this.tmp.shadow_numbers.number.values=[],this.tmp.shadow_numbers.number.plural=0,this.tmp.shadow_numbers.number.numeric=!1,this.tmp.shadow_numbers.number.label=!1;var i=""+e.number;i=i.replace("\\","","g");var s=i.split(/\s/)[0],r=t.STATUTE_SUBDIV_STRINGS[s];if(r){var n=i.match(t.STATUTE_SUBDIV_GROUPED_REGEX),a=i.split(t.STATUTE_SUBDIV_PLAIN_REGEX);if(a.length>1){for(var o=[],l=1,u=a.length;u>l;l+=1){var h=n[l-1].replace(/^\s*/,"");o.push(h.replace("sec.","Sec.").replace("ch.","Ch.")),o.push(a[l].replace(/\s*$/,"").replace(/^\s*/,""))}i=o.join(" ")}else i=a[0];this.tmp.shadow_numbers.number.values.push(["Blob",i,!1]),this.tmp.shadow_numbers.number.numeric=!1}else this.tmp.shadow_numbers.number.values.push(["Blob",i,!1]),this.tmp.shadow_numbers.number.numeric=!0}},t.substituteOne=function(t){return function(e,i){return i?t.replace("%%STRING%%",i):""}},t.substituteTwo=function(t){return function(e){var i=t.replace("%%PARAM%%",e);return function(t,e){return e?i.replace("%%STRING%%",e):""}}},t.Mode=function(e){var i,s,r,n,a,o;i={},s=t.Output.Formats[e];for(r in s)if("@"===r.slice(0,1)){if(n=!1,a=s[r],o=r.split("/"),"string"==typeof a&&a.indexOf("%%STRING%%")>-1)n=a.indexOf("%%PARAM%%")>-1?t.substituteTwo(a):t.substituteOne(a);else if("boolean"!=typeof a||a){if("function"!=typeof a)throw"CSL.Compiler: Bad "+e+" config entry for "+r+": "+a;n=a}else n=t.Output.Formatters.passthrough;1===o.length?i[o[0]]=n:2===o.length&&(i[o[0]]||(i[o[0]]={}),i[o[0]][o[1]]=n)}else i[r]=s[r];return i},t.setDecorations=function(e,i){var s,r,n;s=[];for(n in t.FORMAT_KEY_SEQUENCE)r=t.FORMAT_KEY_SEQUENCE[n],i[r]&&(s.push([r,i[r]]),delete i[r]);return s},t.Engine.prototype.normalDecorIsOrphan=function(t,e){if("normal"===e[1]){var i,s=!1;i="citation"===this.tmp.area?[this.citation.opt.layout_decorations].concat(t.alldecor):t.alldecor;for(var r=i.length-1;r>-1;r+=-1)for(var n=i[r].length-1;n>-1;n+=-1)i[r][n][0]===e[0]&&"normal"!==i[r][n][1]&&(s=!0);if(!s)return!0}return!1},t.Engine.prototype.getCitationLabel=function(e){var i="",s=this.getTrigraphParams(),r=s[0],n=this.getTerm("reference","short",0);"undefined"==typeof n&&(n="reference"),n=n.replace(".",""),n=n.slice(0,1).toUpperCase()+n.slice(1);for(var a=0,o=t.CREATORS.length;o>a;a+=1){var l=t.CREATORS[a];if(e[l]){var u=e[l];r=u.length>s.length?s[s.length-1]:s[u.length-1];for(var h=0,p=u.length;p>h&&h!==r.authors.length;h+=1){var c=this.nameOutput.getName(u[h],"locale-translit",!0),f=c.name;f&&f.family?(n=f.family,n=n.replace(/^([ \'\u2019a-z]+\s+)/,"")):f&&f.literal&&(n=f.literal);var m=n.toLowerCase().match(/^(a\s+|the\s+|an\s+)/);if(m&&(n=n.slice(m[1].length)),n=n.replace(t.ROMANESQUE_NOT_REGEXP,"","g"),!n)break;n=n.slice(0,r.authors[h]),n.length>1?n=n.slice(0,1).toUpperCase()+n.slice(1).toLowerCase():1===n.length&&(n=n.toUpperCase()),i+=n}break}}var g="0000";return e.issued&&e.issued.year&&(g=""+e.issued.year),g=g.slice(-1*r.year),i+=g},t.Engine.prototype.getTrigraphParams=function(){var t=[],e=this.opt.trigraph.split(":");if(!this.opt.trigraph||"A"!==this.opt.trigraph.slice(0,1))throw"Bad trigraph definition: "+this.opt.trigraph;for(var i=0,s=e.length;s>i;i+=1){for(var r=e[i],n={authors:[],year:0},a=0,o=r.length;o>a;a+=1)switch(r.slice(a,a+1)){case"A":n.authors.push(1);break;case"a":n.authors[n.authors.length-1]+=1;break;case"0":n.year+=1;break;default:throw"Invalid character in trigraph definition: "+this.opt.trigraph}t.push(n)}return t},t.Engine.prototype.setOutputFormat=function(e){this.opt.mode=e,this.fun.decorate=t.Mode(e),this.output[e]||(this.output[e]={},this.output[e].tmp={})},t.Engine.prototype.getSortFunc=function(){return function(t,e){return t=t.split("-"),e=e.split("-"),t.length<e.length?1:t.length>e.length?-1:(t=t.slice(-1)[0],e=e.slice(-1)[0],t.length<e.length?1:t.length>e.length?-1:0)}},t.Engine.prototype.setLangTagsForCslSort=function(t){var e,i;if(t)for(this.opt["locale-sort"]=[],e=0,i=t.length;i>e;e+=1)this.opt["locale-sort"].push(t[e]);this.opt["locale-sort"].sort(this.getSortFunc())},t.Engine.prototype.setLangTagsForCslTransliteration=function(t){var e,i;if(this.opt["locale-translit"]=[],t)for(e=0,i=t.length;i>e;e+=1)this.opt["locale-translit"].push(t[e]);this.opt["locale-translit"].sort(this.getSortFunc())},t.Engine.prototype.setLangTagsForCslTranslation=function(t){var e,i;if(this.opt["locale-translat"]=[],t)for(e=0,i=t.length;i>e;e+=1)this.opt["locale-translat"].push(t[e]);this.opt["locale-translat"].sort(this.getSortFunc())},t.Engine.prototype.setLangPrefsForCites=function(t,e){var i=this.opt["cite-lang-prefs"];e||(e=function(t){return t.toLowerCase()});for(var s=["Persons","Institutions","Titles","Journals","Publishers","Places"],r=0,n=s.length;n>r;r+=1){var a=e(s[r]),o=s[r].toLowerCase();if(t[a]){for(var l=[];t[a].length>1;)l.push(t[a].pop());var u={orig:1,translit:2,translat:3};for(2===l.length&&u[l[0]]<u[l[1]]&&l.reverse();l.length;)t[a].push(l.pop());for(var h=i[o];h.length;)h.pop();for(var p=0,c=t[a].length;c>p;p+=1)h.push(t[a][p])}}},t.Engine.prototype.setLangPrefsForCiteAffixes=function(t){if(t&&48===t.length){for(var e,i=this.opt.citeAffixes,s=0,r=["persons","institutions","titles","journals","publishers","places"],n=["translit","orig","translit","translat"],a=0,o=r.length;o>a;a+=1)for(var l=0,u=n.length;u>l;l+=1)e="",4===s%8?i[r[a]]["locale-"+n[l]].prefix||i[r[a]]["locale-"+n[l]].suffix||(e=t[s]?t[s]:"",i[r[a]]["locale-"+n[l]].prefix=e,e=t[s]?t[s+1]:"",i[r[a]]["locale-"+n[l]].suffix=e):(e=t[s]?t[s]:"",i[r[a]]["locale-"+n[l]].prefix=e,e=t[s]?t[s+1]:"",i[r[a]]["locale-"+n[l]].suffix=e),s+=2;this.opt.citeAffixes=i}},t.Engine.prototype.setAutoVietnameseNamesOption=function(t){this.opt["auto-vietnamese-names"]=t?!0:!1},t.Engine.prototype.setAbbreviations=function(t){this.sys.setAbbreviations&&this.sys.setAbbreviations(t)},t.Output={},t.Output.Queue=function(e){this.levelname=["top"],this.state=e,this.queue=[],this.empty=new t.Token("empty");var i={};i.empty=this.empty,this.formats=new t.Stack(i),this.current=new t.Stack(this.queue)},t.Output.Queue.prototype.pop=function(){var t=this.current.value();return t.length?t.pop():t.blobs.pop()},t.Output.Queue.prototype.getToken=function(t){var e=this.formats.value()[t];return e},t.Output.Queue.prototype.mergeTokenStrings=function(e,i){var s,r,n,a;if(s=this.formats.value()[e],r=this.formats.value()[i],n=s,r){s||(s=new t.Token(e,t.SINGLETON),s.decorations=[]),n=new t.Token(e,t.SINGLETON),a="";for(a in s.strings)s.strings.hasOwnProperty(a)&&(n.strings[a]=s.strings[a]);for(a in r.strings)r.strings.hasOwnProperty(a)&&(n.strings[a]=r.strings[a]);n.decorations=s.decorations.concat(r.decorations)}return n},t.Output.Queue.prototype.addToken=function(e,i,s){var r,n;if(r=new t.Token("output"),"string"==typeof s&&(s=this.formats.value()[s]),s&&s.strings){for(n in s.strings)s.strings.hasOwnProperty(n)&&(r.strings[n]=s.strings[n]);r.decorations=s.decorations}"string"==typeof i&&(r.strings.delimiter=i),this.formats.value()[e]=r},t.Output.Queue.prototype.pushFormats=function(t){t||(t={}),t.empty=this.empty,this.formats.push(t)},t.Output.Queue.prototype.popFormats=function(){this.formats.pop()},t.Output.Queue.prototype.startTag=function(t,e){var i={};this.state.tmp["doing-macro-with-date"]&&this.state.tmp.extension&&(e=this.empty,t="empty"),i[t]=e,this.pushFormats(i),this.openLevel(t)},t.Output.Queue.prototype.endTag=function(){this.closeLevel(),this.popFormats()},t.Output.Queue.prototype.openLevel=function(e){var i,s;if("object"==typeof e)i=new t.Blob(void 0,e);else if("undefined"==typeof e)i=new t.Blob(void 0,this.formats.value().empty,"empty");else{if(!this.formats.value()||!this.formats.value()[e])throw'CSL processor error: call to nonexistent format token "'+e+'"';i=new t.Blob(void 0,this.formats.value()[e],e)}this.nestedBraces&&(i.strings.prefix=i.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),i.strings.prefix=i.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),i.strings.suffix=i.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),i.strings.suffix=i.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),s=this.current.value(),s.push(i),this.current.push(i)},t.Output.Queue.prototype.closeLevel=function(e){e&&e!==this.current.value().levelname&&t.error("Level mismatch error:  wanted "+e+" but found "+this.current.value().levelname),this.current.pop()},t.Output.Queue.prototype.append=function(e,i,s,r,n){var a,o,l,u=!0;if(s&&(r=!0),this.state.tmp["doing-macro-with-date"]&&!s){if("macro-with-date"!==i)return!1;"macro-with-date"===i&&(i="empty")}if("undefined"==typeof e)return!1;if("number"==typeof e&&(e=""+e),!s&&this.state.tmp.element_trace&&"suppress-me"===this.state.tmp.element_trace.value())return!1;if(o=!1,i?"literal"===i?(a=!0,u=!1):a="string"==typeof i?this.formats.value()[i]:i:a=this.formats.value().empty,!a)throw"CSL processor error: unknown format token name: "+i;if(a.strings&&"undefined"==typeof a.strings.delimiter&&(a.strings.delimiter=""),"string"==typeof e&&e.length&&(e=e.replace(/ ([:;?!\u00bb])/g," $1").replace(/\u00ab /g,"« "),this.last_char_rendered=e.slice(-1),e=e.replace(/\s+'/g,"  '").replace(/^'/g," '"),r?s&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),o=new t.Blob(e,a),this.nestedBraces&&(o.strings.prefix=o.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),o.strings.prefix=o.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),o.strings.suffix=o.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),o.strings.suffix=o.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),l=this.current.value(),"undefined"==typeof l&&0===this.current.mystack.length&&(this.current.mystack.push([]),l=this.current.value()),"string"==typeof o.blobs&&(r?s&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),s||this.state.parallel.AppendBlobPointer(l),"string"==typeof e){l.push(o),o.strings["text-case"]&&(o.blobs=t.Output.Formatters[o.strings["text-case"]](this.state,e)),this.state.tmp.strip_periods&&!n&&(o.blobs=o.blobs.replace(/\.([^a-z]|$)/g,"$1"));for(var h=o.decorations.length-1;h>-1;h+=-1)"@quotes"===o.decorations[h][0]&&"true"===o.decorations[h][1]&&(o.punctuation_in_quote=this.state.getOpt("punctuation-in-quote")),o.blobs.match(t.ROMANESQUE_REGEXP)||"@font-style"===o.decorations[h][0]&&(o.decorations=o.decorations.slice(0,h).concat(o.decorations.slice(h+1)));this.state.fun.flipflopper.init(e,o),this.state.fun.flipflopper.processTags()}else u?l.push(o):l.push(e);return!0},t.Output.Queue.prototype.string=function(e,i,s){var r,n,a,o,l,u=t.getSafeEscape(this.state),h=i.slice(),p=[];if(0===h.length)return p;var c="";s?c=s.strings.delimiter:(e.tmp.count_offset_characters=!1,e.tmp.offset_characters=0),s&&s.new_locale&&(s.old_locale=e.opt.lang,e.opt.lang=s.new_locale);var f,m,g,d;for(r=0,n=h.length;n>r;r+=1){if(f=h[r],f.strings.first_blob&&(e.tmp.count_offset_characters=f.strings.first_blob),"string"==typeof f.blobs){if("number"==typeof f.num)p.push(f);else if(f.blobs){l=u(f.blobs);var b=l.length;if(!e.tmp.suppress_decorations)for(a=0,o=f.decorations.length;o>a;a+=1)d=f.decorations[a],"@showid"!==d[0]&&(e.normalDecorIsOrphan(f,d)||(l=e.fun.decorate[d[0]][d[1]](e,l,d[2])));if(l&&l.length){if(l=u(f.strings.prefix,e.tmp.nestedBraces)+l+u(f.strings.suffix,e.tmp.nestedBraces),e.opt.development_extensions.csl_reverse_lookup_support&&!e.tmp.suppress_decorations)for(a=0,o=f.decorations.length;o>a;a+=1)d=f.decorations[a],"@showid"===d[0]&&(l=e.fun.decorate[d[0]][d[1]](e,l,d[2]));p.push(l),e.tmp.count_offset_characters&&(e.tmp.offset_characters+=b+f.strings.suffix.length+f.strings.prefix.length)}}}else if(f.blobs.length){var _=e.output.string(e,f.blobs,f);p=p.concat(_)}f.strings.first_blob&&(e.registry.registry[f.strings.first_blob].offset=e.tmp.offset_characters,e.tmp.count_offset_characters=!1)}for(r=0,n=p.length-1;n>r;r+=1)"number"!=typeof p[r].num||"number"!=typeof p[r+1].num||p[r+1].UGLY_DELIMITER_SUPPRESS_HACK||(p[r].strings.suffix=p[r].strings.suffix+(c?c:""),p[r+1].successor_prefix="",p[r+1].UGLY_DELIMITER_SUPPRESS_HACK=!0);var y=0;for(r=0,n=p.length;n>r;r+=1)"string"==typeof p[r]&&(y=parseInt(r,10)+1,r<p.length-1&&"object"==typeof p[r+1]&&(c&&!p[r+1].UGLY_DELIMITER_SUPPRESS_HACK&&(p[r]+=u(c)),p[r+1].UGLY_DELIMITER_SUPPRESS_HACK=!0));s&&(s.decorations.length||s.strings.suffix||s.strings.prefix)&&(y=p.length);var v=e.output.renderBlobs(p.slice(0,y),c,!0,s);if(v&&s&&(s.decorations.length||s.strings.suffix||s.strings.prefix)){if(!e.tmp.suppress_decorations)for(r=0,n=s.decorations.length;n>r;r+=1)d=s.decorations[r],["@cite","@bibliography","@display","@showid"].indexOf(d[0])>-1||e.normalDecorIsOrphan(f,d)||"string"==typeof v&&(v=e.fun.decorate[d[0]][d[1]](e,v,d[2]));if(l=v,m=s.strings.suffix,l&&l.length&&(g=s.strings.prefix,l=u(g,e.tmp.nestedBraces)+l+u(m,e.tmp.nestedBraces),e.tmp.count_offset_characters&&(e.tmp.offset_characters+=g.length+m.length)),v=l,!e.tmp.suppress_decorations)for(r=0,n=s.decorations.length;n>r;r+=1)d=s.decorations[r],-1!==["@cite","@bibliography","@display","@showid"].indexOf(d[0])&&(v=e.fun.decorate[d[0]][d[1]].call(s,e,v,d[2]))}var x=p.slice(y,p.length);return!x.length&&v?p=[v]:x.length&&!v?p=x:v&&x.length&&(p=[v].concat(x)),"undefined"==typeof s?(this.queue=[],this.current.mystack=[],this.current.mystack.push(this.queue),e.tmp.suppress_decorations&&(p=e.output.renderBlobs(p,void 0,!0))):"boolean"==typeof s&&(p=e.output.renderBlobs(p,void 0,!0)),s&&s.new_locale&&(e.opt.lang=s.old_locale),p},t.Output.Queue.prototype.clearlevel=function(){var t,e,i;for(t=this.current.value(),i=t.blobs.length,e=0;i>e;e+=1)t.blobs.pop()},t.Output.Queue.prototype.renderBlobs=function(e,i,s,r){var n,a,o,l,u,h,p,c,f,m,g,d;if(d=t.getSafeEscape(this.state),i||(i=""),n=this.state,a="",o=[],l="",p=e.length,"citation"===this.state.tmp.area&&!this.state.tmp.just_looking&&1===p&&"object"==typeof e[0]&&r)return e[0].strings.prefix=r.strings.prefix+e[0].strings.prefix,e[0].strings.suffix=e[0].strings.suffix+r.strings.suffix,e[0].decorations=e[0].decorations.concat(r.decorations),e[0];var b=!0;for(h=0;p>h;h+=1)e[h].checkNext?(e[h].checkNext(e[h+1],b),b=!1):b=!0;var _=!0;for(h=e.length-1;h>0;h+=-1)e[h].checkLast?_&&e[h].checkLast(e[h-1])&&(_=!1):_=!0;for(p=e.length,h=0;p>h;h+=1)if(u=e[h],a&&(l=i),"string"==typeof u)a+=d(l),a+=u,n.tmp.count_offset_characters&&(n.tmp.offset_characters+=l.length);else if(u.status!==t.SUPPRESS){m=u.formatter.format(u.num,u.gender);var y=m.replace(/<[^>]*>/g,"").length;this.append(m,"empty",!0);var v=this.pop(),x=n.tmp.count_offset_characters;if(m=this.string(n,[v],!1),n.tmp.count_offset_characters=x,u.strings["text-case"]&&(m=t.Output.Formatters[u.strings["text-case"]](this.state,m)),m&&this.state.tmp.strip_periods&&(m=m.replace(/\.([^a-z]|$)/g,"$1")),!n.tmp.suppress_decorations)for(f=u.decorations.length,c=0;f>c;c+=1)g=u.decorations[c],n.normalDecorIsOrphan(u,g)||(m=n.fun.decorate[g[0]][g[1]](n,m,g[2]));m=d(u.strings.prefix)+m+d(u.strings.suffix);var I="";u.status===t.END?I=d(u.range_prefix):u.status===t.SUCCESSOR?I=d(u.successor_prefix):u.status===t.START?I="":u.status===t.SEEN&&(I=d(u.splice_prefix)),a+=I,a+=m,n.tmp.count_offset_characters&&(n.tmp.offset_characters+=I.length+u.strings.prefix.length+y+u.strings.suffix.length)}return a},t.Output.Queue.purgeEmptyBlobs=function(e,i){var s,r,n,a;if("string"!=typeof e&&e.length){for(s=e.length-1;s>-1;s+=-1)"undefined"==typeof e[s].blobs&&(e[s].blobs=[]),t.Output.Queue.purgeEmptyBlobs(e[s].blobs,i);for(s=e.length-1;s>-1;s+=-1){if(!e[s].blobs.length){for(a=e.slice(s+1),r=s,n=e.length;n>r;r+=1)e.pop();for(r=0,n=a.length;n>r;r+=1)e.push(a[r])}if(i)break}}},t.Output.Queue.purgeNearsidePrefixChars=function(e,i){i&&"object"==typeof e&&(t.TERMINAL_PUNCTUATION.indexOf(i)>-1&&t.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(e.strings.prefix.slice(0,1))>-1&&(";"!==e.strings.prefix.slice(0,1)||"."!==i)?e.strings.prefix=e.strings.prefix.slice(1):"object"==typeof e.blobs&&t.Output.Queue.purgeNearsidePrefixChars(e.blobs[0],i))},t.Output.Queue.purgeNearsidePrefixSpaces=function(e,i){"object"==typeof e&&(" "===i&&" "===e.strings.prefix.slice(0,1)?e.strings.prefix=e.strings.prefix.slice(1):"object"==typeof e.blobs&&t.Output.Queue.purgeNearsidePrefixSpaces(e.blobs[0],i))},t.Output.Queue.purgeNearsideSuffixSpaces=function(e,i){return"object"==typeof e&&(" "===i&&" "===e.strings.suffix.slice(-1)?e.strings.suffix=e.strings.suffix.slice(0,-1):"object"==typeof e.blobs?(i||(i=e.strings.suffix.slice(-1)),i=t.Output.Queue.purgeNearsideSuffixSpaces(e.blobs[e.blobs.length-1],i)):i=e.strings.suffix.slice(-1)),i},t.Output.Queue.adjustPunctuation=function(e,i,s){var r,n,a,o,l,u,h,p,c,f,m,g,d,b,_,y,v,x,I,S,O,T,A=t.TERMINAL_PUNCTUATION.slice(0,-1);t.TERMINAL_PUNCTUATION;var E=t.SWAPPING_PUNCTUATION;if(s||(s=[{suffix:"",delimiter:"",lastNode:!0}]),b=s.length-1,l=s[b].delimiter,a=s[b].dpref,d=s[b].dsuff,_=s[b].dsufff,f=s[b].prefix,n=s[b].suffix,o=s[b].blob,"string"==typeof i)n&&o&&A.indexOf(i.slice(-1))>-1&&A.slice(1).indexOf(n)>-1&&" "!==o.strings.suffix&&(o.strings.suffix=o.strings.suffix.slice(1)),v=i.slice(-1),x=i.slice(0,1);else{if(a)for(I=0,S=i.length-1;S>I;I+=1){var N=i[I].strings.suffix.slice(-1);(-1===A.indexOf(N)||-1===A.indexOf(a))&&(" "!==a||a!==i[I].strings.suffix.slice(-1))&&(i[I].strings.suffix+=a)}" "===n&&t.Output.Queue.purgeNearsideSuffixSpaces(i[i.length-1]," ");var k,R=[];for(O=0,T=i.length-1;T>O;O+=1){k=i[O],i[O+1].strings.prefix,r=!1;var w=t.Output.Queue.purgeNearsideSuffixSpaces(k,r);d?R.push(!1):R.push(w)}for(r=!1,O=1,T=i.length;T>O;O+=1){k=i[O],r="";var C=i[O-1].strings.suffix;" "===d?r=d:C?r=C.slice(-1):R[O-1]&&(r=R[O-1]),t.Output.Queue.purgeNearsidePrefixSpaces(k,r)}for(_?t.Output.Queue.purgeNearsidePrefixSpaces(i[0]," "):" "===f&&t.Output.Queue.purgeNearsidePrefixSpaces(i[0]," "),O=0,T=i.length;T>O;O+=1){if(k=i[O],t.Output.Queue.purgeNearsidePrefixChars(k,v),0===O&&f&&" "===k.strings.prefix.slice(0,1),_&&k.strings.prefix&&0===O&&" "===k.strings.prefix.slice(0,1),d&&O>0&&" "===k.strings.prefix.slice(0,1),O<i.length-1){var L=i[O+1].strings.prefix;if(!l&&L){var P=L.slice(0,1);E.indexOf(P)>-1?(i[O+1].strings.prefix=L.slice(1),(-1===A.indexOf(P)||A.indexOf(P)>-1&&-1===A.indexOf(k.strings.suffix.slice(-1)))&&(k.strings.suffix+=P)):" "===P&&" "===k.strings.suffix.slice(-1)&&(k.strings.suffix=k.strings.suffix.slice(0,-1))
}}if(O===i.length-1&&n&&k.strings.suffix&&A.slice(1).indexOf(n)>-1&&A.indexOf(k.strings.suffix.slice(-1))>-1&&(o.strings.suffix=o.strings.suffix.slice(1)),e.getOpt("punctuation-in-quote")){var U=k.decorations;for(I=0,S=U.length;S>I;I+=1)"@quotes"!==U[I][0]||"true"!==U[I][1]&&"inner"!==U[I][1]||(k.punctuation_in_quote=!0,s[b].lastNode=!0)}if(k.punctuation_in_quote&&s[b].lastNode){var D=k.strings.suffix.slice(0,1),B=!1;E.indexOf(D)>-1?B=k:E.indexOf(n)>-1&&O===i.length-1?(D=n,B=o):D=!1,D&&("string"==typeof k.blobs?(-1===E.indexOf(k.blobs.slice(-1))||A.indexOf(k.blobs.slice(-1))>-1&&E.indexOf(D)>-1&&-1===A.indexOf(D))&&(k.blobs+=D):(-1===E.indexOf(k.blobs.slice(-1)[0].strings.suffix.slice(-1))||A.indexOf(k.blobs.slice(-1)[0].strings.suffix.slice(-1))>-1&&E.indexOf(D)>-1&&-1===A.indexOf(D))&&(k.blobs.slice(-1)[0].strings.suffix+=D),B.strings.suffix=B.strings.suffix.slice(1))}O===i.length-1?k.strings.suffix?(u=k.strings.suffix.slice(0,1),p=k):(u=s[s.length-1].suffix,p=s[s.length-1].blob):k.strings.suffix?(u=k.strings.suffix.slice(0,1),p=k):(u="",p=!1),-1===E.concat([" "]).indexOf(u)&&(u="",p=!1),k.strings.delimiter&&k.blobs.length>1?(h=k.strings.delimiter.slice(0,1),E.concat([" "]).indexOf(h)>-1?k.strings.delimiter=k.strings.delimiter.slice(1):h=""):h="",m=k.strings.prefix?" "===k.strings.prefix.slice(-1)?" ":"":0===O?f:"",y=d?d:0===O?_:"",g=k.strings.delimiter?" "===k.strings.delimiter.slice(-1)&&"object"==typeof k.blobs&&k.blobs.length>1?k.strings.delimiter.slice(-1):"":"",c=k.strings.delimiter;var j;j=O===i.length-1&&s[b].lastNode?!0:!1,s.push({suffix:u,dsuff:g,blob:p,delimiter:c,prefix:m,dpref:h,dsufff:y,lastNode:j}),v=t.Output.Queue.adjustPunctuation(e,k.blobs,s)}if(i&&i.length){var z=i[i.length-1].strings.suffix;z&&(v=z.slice(-1))}}return s.length>1&&s.pop(),e.tmp.last_chr=v,v},t.Engine.Opt=function(){this.has_disambiguate=!1,this.mode="html",this.dates={},this["locale-sort"]=[],this["locale-translit"]=[],this["locale-translat"]=[],this.citeAffixes={persons:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},institutions:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},titles:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},journals:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},publishers:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},places:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}}},this["default-locale"]=[],this.update_mode=t.NONE,this.bib_mode=t.NONE,this.sort_citations=!1,this["et-al-min"]=0,this["et-al-use-first"]=1,this["et-al-use-last"]=!1,this["et-al-subsequent-min"]=!1,this["et-al-subsequent-use-first"]=!1,this["demote-non-dropping-particle"]="display-and-sort",this["parse-names"]=!0,this.citation_number_slug=!1,this.trigraph="Aaaa00:AaAa00:AaAA00:AAAA00",this.development_extensions={},this.development_extensions.field_hack=!0,this.development_extensions.locator_date_and_revision=!0,this.development_extensions.locator_parsing_for_plurals=!0,this.development_extensions.locator_label_parse=!0,this.development_extensions.raw_date_parsing=!0,this.development_extensions.clean_up_csl_flaws=!0,this.development_extensions.flip_parentheses_to_braces=!0,this.development_extensions.jurisdiction_subfield=!0,this.development_extensions.static_statute_locator=!1,this.development_extensions.csl_reverse_lookup_support=!1,this.development_extensions.clobber_locator_if_no_statute_section=!1,this.development_extensions.wrap_url_and_doi=!1,this.development_extensions.allow_force_lowercase=!1,this.development_extensions.handle_parallel_articles=!1,this.development_extensions.thin_non_breaking_space_html_hack=!1,this.development_extensions.apply_citation_wrapper=!1,this.development_extensions.main_title_from_short_title=!1,this.development_extensions.normalize_lang_keys_to_lowercase=!1,this.development_extensions.strict_text_case_locales=!1,this.development_extensions.rtl_support=!1,this.development_extensions.strict_page_numbers=!1,this.development_extensions.expect_and_symbol_form=!1,this.development_extensions.require_explicit_legal_case_title_short=!1,this.nodenames=[],this.gender={},this["cite-lang-prefs"]={persons:["orig"],institutions:["orig"],titles:["orig","translat"],journals:["translit"],publishers:["orig"],places:["orig"],number:["translat"]},this.has_layout_locale=!1},t.Engine.Tmp=function(){this.names_max=new t.Stack,this.names_base=new t.Stack,this.givens_base=new t.Stack,this.value=[],this.namepart_decorations={},this.namepart_type=!1,this.area="citation",this.root="citation",this.extension="",this.can_substitute=new t.Stack(0,t.LITERAL),this.element_rendered_ok=!1,this.element_trace=new t.Stack("style"),this.nameset_counter=0,this.group_context=new t.Stack([!1,!1,!1],t.LITERAL),this.term_predecessor=!1,this.jump=new t.Stack(0,t.LITERAL),this.decorations=new t.Stack,this.tokenstore_stack=new t.Stack,this.last_suffix_used="",this.last_names_used=[],this.last_years_used=[],this.years_used=[],this.names_used=[],this.taintedItemIDs={},this.taintedCitationIDs={},this.initialize_with=new t.Stack,this.disambig_request=!1,this["name-as-sort-order"]=!1,this.suppress_decorations=!1,this.disambig_settings=new t.AmbigConfig,this.bib_sort_keys=[],this.prefix=new t.Stack("",t.LITERAL),this.suffix=new t.Stack("",t.LITERAL),this.delimiter=new t.Stack("",t.LITERAL),this.cite_locales=[],this.cite_affixes={citation:!1,bibliography:!1,citation_sort:!1,bibliography_sort:!1},this.strip_periods=0,this.shadow_numbers={}},t.Engine.Fun=function(e){this.match=new t.Util.Match,this.suffixator=new t.Util.Suffixator(t.SUFFIX_CHARS),this.romanizer=new t.Util.Romanizer,this.ordinalizer=new t.Util.Ordinalizer(e),this.long_ordinalizer=new t.Util.LongOrdinalizer},t.Engine.Build=function(){this["alternate-term"]=!1,this.in_bibliography=!1,this.in_style=!1,this.skip=!1,this.postponed_macro=!1,this.layout_flag=!1,this.name=!1,this.form=!1,this.term=!1,this.macro={},this.macro_stack=[],this.text=!1,this.lang=!1,this.area="citation",this.root="citation",this.extension="",this.substitute_level=new t.Stack(0,t.LITERAL),this.names_level=0,this.render_nesting_level=0,this.render_seen=!1},t.Engine.Configure=function(){this.fail=[],this.succeed=[]},t.Engine.Citation=function(e){this.opt={},this.tokens=[],this.srt=new t.Registry.Comparifier(e,"citation_sort"),this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="citation"},t.Engine.Bibliography=function(){this.opt={},this.tokens=[],this.opt.collapse=[],this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt["line-spacing"]=1,this.opt["entry-spacing"]=1,this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="bibliography"},t.Engine.BibliographySort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="bibliography"},t.Engine.CitationSort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="citation"},t.Engine.prototype.previewCitationCluster=function(e,i,s,r){var n=this.opt.mode;this.setOutputFormat(r);var a=this.processCitationCluster(e,i,s,t.PREVIEW);return this.setOutputFormat(n),a[1]},t.Engine.prototype.appendCitationCluster=function(t){for(var e=[],i=this.registry.citationreg.citationByIndex.length,s=0;i>s;s+=1){var r=this.registry.citationreg.citationByIndex[s];e.push([""+r.citationID,r.properties.noteIndex])}return this.processCitationCluster(t,e,[])[1]},t.Engine.prototype.processCitationCluster=function(e,i,s,r){var n,a,o,l,u,h,p,c,f,m,g,d,b,_,y,v;this.debug=!1,this.tmp.citation_errors=[];var x={bibchange:!1};this.setCitationId(e);var I,S,O;if(r===t.PREVIEW){I=this.registry.citationreg.citationByIndex.slice(),S=this.registry.reflist.slice();var T=i.concat([[""+e.citationID,e.properties.noteIndex]]).concat(s),A={},E=[];for(a=0,o=T.length;o>a;a+=1)for(n=this.registry.citationreg.citationById[T[a][0]],l=0,u=n.citationItems.length;u>l;l+=1)A[n.citationItems[l].id]=!0,E.push(""+n.citationItems[l].id);for(O={},a=0,o=S.length;o>a;a+=1)if(!A[S[a].id]){var N=this.registry.registry[S[a].id].ambig,k=this.registry.ambigcites[N];if(k)for(l=0,u=k.length;u>l;l+=1)O[k[l]]=t.cloneAmbigConfig(this.registry.registry[k[l]].disambig)}}this.tmp.taintedCitationIDs={};var R=[];for(a=0,o=e.citationItems.length;o>a;a+=1){d={};for(m in e.citationItems[a])d[m]=e.citationItems[a][m];if(g=this.retrieveItem(""+d.id),g.id&&this.transform.loadAbbreviation("default","hereinafter",g.id),this.remapSectionVariable([[g,d]]),this.opt.development_extensions.locator_date_and_revision&&d.locator){d.locator=""+d.locator;var w=d.locator.indexOf("|");if(w>-1){var C=d.locator;d.locator=C.slice(0,w),C=C.slice(w+1),y=C.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/),y&&(d["locator-date"]=this.fun.dateparser.parse(y[1]),C=C.slice(y[1].length)),d["locator-revision"]=C.replace(/^\s+/,"").replace(/\s+$/,"")}}this.opt.development_extensions.locator_label_parse&&(!d.locator||-1!==["bill","gazette","legislation","treaty"].indexOf(g.type)||d.label&&"page"!==d.label||(y=t.LOCATOR_LABELS_REGEXP.exec(d.locator),y&&(d.label=t.LOCATOR_LABELS_MAP[y[2]],d.locator=y[3])));var L=[g,d];R.push(L),e.citationItems[a].item=g}e.sortedItems=R;var P=[];for(a=0,o=i.length;o>a;a+=1)n=i[a],this.registry.citationreg.citationById[n[0]].properties.noteIndex=n[1],P.push(this.registry.citationreg.citationById[n[0]]);for(P.push(e),a=0,o=s.length;o>a;a+=1)n=s[a],this.registry.citationreg.citationById[n[0]].properties.noteIndex=n[1],P.push(this.registry.citationreg.citationById[n[0]]);this.registry.citationreg.citationByIndex=P,this.registry.citationreg.citationsByItemId={},this.opt.update_mode===t.POSITION&&(_=[],b=[],v={});var U=[];for(a=0,o=P.length;o>a;a+=1){for(P[a].properties.index=a,l=0,u=P[a].sortedItems.length;u>l;l+=1)d=P[a].sortedItems[l],this.registry.citationreg.citationsByItemId[d[1].id]||(this.registry.citationreg.citationsByItemId[d[1].id]=[],U.push(""+d[1].id)),-1===this.registry.citationreg.citationsByItemId[d[1].id].indexOf(P[a])&&this.registry.citationreg.citationsByItemId[d[1].id].push(P[a]);this.opt.update_mode===t.POSITION&&(P[a].properties.noteIndex?b.push(P[a]):(P[a].properties.noteIndex=0,_.push(P[a])))}if(r!==t.ASSUME_ALL_ITEMS_REGISTERED&&this.updateItems(U),!this.opt.citation_number_sort&&R&&R.length>1&&this.citation_sort.tokens.length>0){for(a=0,o=R.length;o>a;a+=1)R[a][1].sortkeys=t.getSortKeys.call(this,R[a][0],"citation_sort");if(this.opt.grouped_sort&&!e.properties.unsorted){for(a=0,o=R.length;o>a;a+=1){var D=R[a][1].sortkeys;this.tmp.authorstring_request=!0;var B=this.registry.registry[R[a][0].id].disambig;this.tmp.authorstring_request=!0,t.getAmbiguousCite.call(this,R[a][0],B);var j=this.registry.authorstrings[R[a][0].id];this.tmp.authorstring_request=!1,R[a][1].sortkeys=[j].concat(D)}R.sort(this.citation.srt.compareCompositeKeys);var z=!1,M=!1,q=!1;for(a=0,o=R.length;o>a;a+=1)R[a][1].sortkeys[0]!==z&&(q=R[a][1].sortkeys[0],M=R[a][1].sortkeys[1]),R[a][1].sortkeys[0]=""+M+a,z=q}e.properties.unsorted||R.sort(this.citation.srt.compareCompositeKeys)}var F;if(this.opt.update_mode===t.POSITION)for(a=0;2>a;a+=1){F=[_,b][a];var G={},V={};for(l=0,u=F.length;u>l;l+=1){var X=F[l];for(F[l].properties.noteIndex||(F[l].properties.noteIndex=0),F[l].properties.noteIndex=parseInt(F[l].properties.noteIndex,10),l>0&&F[l-1].properties.noteIndex>F[l].properties.noteIndex&&(v={},G={},V={}),h=0,p=X.sortedItems.length;p>h;h+=1)this.registry.registry[X.sortedItems[h][1].id].parallel||(v[X.properties.noteIndex]?v[X.properties.noteIndex]+=1:v[X.properties.noteIndex]=1);for(h=0,p=F[l].sortedItems.length;p>h;h+=1){d=F[l].sortedItems[h];var H=d[0].id,Q=d[1].locator,$=d[1].label;d[0].legislation_id&&(H=d[0].legislation_id);var W;if(h>0&&(W=X.sortedItems[h-1][0].legislation_id?X.sortedItems[h-1][0].legislation_id:X.sortedItems[h-1][1].id),r!==t.PREVIEW||X.citationID==e.citationID){var K={};K.position=d[1].position,K["first-reference-note-number"]=d[1]["first-reference-note-number"],K["near-note"]=d[1]["near-note"],d[1]["first-reference-note-number"]=0,d[1]["near-note"]=!1;var Z;if("undefined"==typeof G[H])G[H]=X.properties.noteIndex,V[H]=X.properties.noteIndex,d[1].position=t.POSITION_FIRST;else{var Y=!1,J=!1;if(l>0&&(Z=F[l-1].sortedItems.slice(-1)[0][1].id,F[l-1].sortedItems[0].slice(-1)[0].legislation_id&&(Z=F[l-1].sortedItems[0].slice(-1)[0].legislation_id)),l>0&&0===parseInt(h,10)&&F[l-1].properties.noteIndex!==F[l].properties.noteIndex){var te=F[l-1].sortedItems,ee=!1,ie=F[l-1].sortedItems[0][0].id;for(F[l-1].sortedItems[0][0].legislation_id&&(ie=F[l-1].sortedItems[0][0].legislation_id),(ie==H&&F[l-1].properties.noteIndex>=F[l].properties.noteIndex-1||F[l-1].sortedItems[0][1].id==this.registry.registry[d[1].id].parallel)&&(1===v[F[l-1].properties.noteIndex]||0===F[l-1].properties.noteIndex)&&(ee=!0),c=0,f=te.slice(1).length;f>c;c+=1){var se=te.slice(1)[c];this.registry.registry[se[1].id].parallel&&this.registry.registry[se[1].id].parallel!=this.registry.registry[se[1].id]||(ee=!1)}ee?Y=!0:J=!0}else h>0&&W==H?Y=!0:0===h&&F[l-1].properties.noteIndex==F[l].properties.noteIndex&&F[l-1].sortedItems.length&&Z==H?Y=!0:J=!0;var re,ne,ae,oe,le;Y&&(re=h>0?X.sortedItems[h-1][1]:F[l-1].sortedItems[0][1],re.locator?(ae=re.label?re.label:"",ne=""+re.locator+ae):ne=re.locator,Q?(le=$?$:"",oe=""+Q+le):oe=Q),Y&&ne&&!oe&&(Y=!1,J=!0),Y&&(!ne&&oe?d[1].position=t.POSITION_IBID_WITH_LOCATOR:ne||oe?ne&&oe===ne?d[1].position=t.POSITION_IBID:ne&&oe&&oe!==ne?d[1].position=t.POSITION_IBID_WITH_LOCATOR:(Y=!1,J=!0):d[1].position=t.POSITION_IBID),J&&(d[1].position=t.POSITION_SUBSEQUENT),(J||Y)&&G[H]!=X.properties.noteIndex&&(d[1]["first-reference-note-number"]=G[H])}if(X.properties.noteIndex){var ue=parseInt(X.properties.noteIndex,10)-parseInt(V[H],10);d[1].position!==t.POSITION_FIRST&&ue<=this.citation.opt["near-note-distance"]&&(d[1]["near-note"]=!0),V[H]=X.properties.noteIndex}if(X.citationID!=e.citationID)for(c=0,f=t.POSITION_TEST_VARS.length;f>c;c+=1){var he=t.POSITION_TEST_VARS[c];d[1][he]!==K[he]&&(this.tmp.taintedCitationIDs[X.citationID]=!0)}}else"undefined"==typeof G[d[1].id]?(G[H]=X.properties.noteIndex,V[H]=X.properties.noteIndex):V[H]=X.properties.noteIndex}}}if(this.opt.citation_number_sort&&R&&R.length>1&&this.citation_sort.tokens.length>0){for(a=0,o=R.length;o>a;a+=1)R[a][1].sortkeys=t.getSortKeys.call(this,R[a][0],"citation_sort");e.properties.unsorted||R.sort(this.citation.srt.compareCompositeKeys)}for(m in this.tmp.taintedItemIDs)if(this.tmp.taintedItemIDs.hasOwnProperty(m)&&(F=this.registry.citationreg.citationsByItemId[m]))for(a=0,o=F.length;o>a;a+=1)this.tmp.taintedCitationIDs[F[a].citationID]=!0;var pe=[];if(r===t.PREVIEW){try{pe=this.process_CitationCluster.call(this,e.sortedItems,e.citationID)}catch(ce){t.error("Error running CSL processor for preview: "+ce)}for(this.registry.citationreg.citationByIndex=I,this.registry.citationreg.citationById={},a=0,o=I.length;o>a;a+=1)this.registry.citationreg.citationById[I[a].citationID]=I[a];var fe=[];for(a=0,o=S.length;o>a;a+=1)fe.push(""+S[a].id);this.updateItems(fe);for(m in O)O.hasOwnProperty(m)&&(this.registry.registry[m].disambig=O[m])}else{var me;for(m in this.tmp.taintedCitationIDs)if(m!=e.citationID){var ge=this.registry.citationreg.citationById[m];this.tmp.citation_pos=ge.properties.index,this.tmp.citation_note_index=ge.properties.noteIndex,this.tmp.citation_id=""+ge.citationID,me=[],me.push(ge.properties.index),me.push(this.process_CitationCluster.call(this,ge.sortedItems,ge.citationID)),pe.push(me)}this.tmp.taintedItemIDs={},this.tmp.taintedCitationIDs={},this.tmp.citation_pos=e.properties.index,this.tmp.citation_note_index=e.properties.noteIndex,this.tmp.citation_id=""+e.citationID,me=[],me.push(i.length),me.push(this.process_CitationCluster.call(this,R)),pe.push(me),pe.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0})}return x.citation_errors=this.tmp.citation_errors.slice(),[x,pe]},t.Engine.prototype.process_CitationCluster=function(e,i){var s;return this.parallel.StartCitation(e),s=t.getCitationCluster.call(this,e,i)},t.Engine.prototype.makeCitationCluster=function(e){var i,s,r,n,a,o,l;for(i=[],a=e.length,n=0;a>n;n+=1){o={};for(var u in e[n])o[u]=e[n][u];if(l=this.retrieveItem(""+o.id),this.opt.development_extensions.locator_label_parse&&o.locator&&-1===["bill","gazette","legislation","treaty"].indexOf(l.type)&&(!o.label||"page"===o.label)){var h=t.LOCATOR_LABELS_REGEXP.exec(o.locator);h&&(o.label=t.LOCATOR_LABELS_MAP[h[2]],o.locator=h[3])}s=[l,o],i.push(s)}if(this.remapSectionVariable(i),i&&i.length>1&&this.citation_sort.tokens.length>0){for(a=i.length,n=0;a>n;n+=1)i[n][1].sortkeys=t.getSortKeys.call(this,i[n][0],"citation_sort");i.sort(this.citation.srt.compareCompositeKeys)}return this.tmp.citation_errors=[],this.parallel.StartCitation(i),r=t.getCitationCluster.call(this,i)},t.getAmbiguousCite=function(e,i){var s,r,n=this.tmp.group_context.value().slice();return this.tmp.disambig_request=i?i:!1,this.tmp.area="citation",s=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,this.tmp.just_looking=!0,t.getCite.call(this,e,{position:1}),t.Output.Queue.purgeEmptyBlobs(this.output.queue),this.opt.development_extensions.clean_up_csl_flaws&&t.Output.Queue.adjustPunctuation(this,this.output.queue),r=this.output.string(this,this.output.queue),this.tmp.just_looking=!1,this.tmp.suppress_decorations=!1,this.parallel.use_parallels=s,this.tmp.group_context.replace(n,"literal"),r},t.getSpliceDelimiter=function(e,i){if(e&&!this.tmp.have_collapsed&&"string"==typeof this.citation.opt["after-collapse-delimiter"])this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"];else if(this.tmp.have_collapsed&&"in-text"===this.opt.xclass&&this.opt.update_mode!==t.NUMERIC)this.tmp.splice_delimiter=", ";else if(this.tmp.use_cite_group_delimiter)this.tmp.splice_delimiter=this.citation.opt.cite_group_delimiter;else if(this.tmp.cite_locales[i-1]){var s=this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[i-1]];s&&s.delimiter&&(this.tmp.splice_delimiter=s.delimiter)}return this.tmp.splice_delimiter||(this.tmp.splice_delimiter=""),this.tmp.splice_delimiter},t.getCitationCluster=function(e,i){var s,r,n,a,o,l,u,h,p,c,f,m,g,d,b,_,y,v,x;if(this.tmp.last_primary_names_string=!1,this.tmp.nestedBraces=!1,v=t.getSafeEscape(this),this.tmp.area="citation",s="",r=[],this.tmp.last_suffix_used="",this.tmp.last_names_used=[],this.tmp.last_years_used=[],this.tmp.backref_index=[],this.tmp.cite_locales=[],i&&(this.registry.citationreg.citationById[i].properties.backref_index=!1,this.registry.citationreg.citationById[i].properties.backref_citation=!1),"note"===this.opt.xclass){for(var I=[],S=!1,O=!1,T=!1,A=[],E=0,N=e.length;N>E;E+=1){var k=e[E][0].type,R=e[E][0].title,w=e[E][1].position,C=e[E][0].id;R&&"legal_case"===k&&C!==T&&w&&((R!==S||0===I.length)&&(A=[],I.push(A)),A.push(e[E][1])),S=R,O=w,T=C}for(E=0,N=I.length;N>E;E+=1)if(A=I[E],!(A.length<2)){var L=A.slice(-1)[0].locator;if(L)for(var P=0,U=A.length-1;U>P;P+=1)A[P].locator&&(L=!1);L&&(A[0].locator=L,delete A.slice(-1)[0].locator,A[0].label=A.slice(-1)[0].label,A.slice(-1)[0].label&&delete A.slice(-1)[0].label)}}for(n=[],a=e.length,o=0;a>o;o+=1){if(g=e[o][0],l=e[o][1],u=this.tmp.have_collapsed,h={},o>0?t.getCite.call(this,g,l,""+e[o-1][0].id):(this.tmp.term_predecessor=!1,t.getCite.call(this,g,l)),this.tmp.cite_renders_content||(x={citationID:""+this.tmp.citation_id,index:this.tmp.citation_pos,noteIndex:this.tmp.citation_note_index,itemID:""+g.id,citationItems_pos:o,error_code:t.ERROR_NO_RENDERED_FORM},this.tmp.citation_errors.push(x)),o===e.length-1&&this.parallel.ComposeSet(),h.splice_delimiter=t.getSpliceDelimiter.call(this,u,o),l&&l["author-only"]&&(this.tmp.suppress_decorations=!0),o>0){y=e[o-1][1];var D=y.suffix&&"."===y.suffix.slice(-1),B=!y.suffix&&l.prefix&&"."===l.prefix.slice(0,1);if(D||B){var j=h.splice_delimiter.indexOf(" ");h.splice_delimiter=j>-1&&!B?h.splice_delimiter.slice(j):""}}h.suppress_decorations=this.tmp.suppress_decorations,h.have_collapsed=this.tmp.have_collapsed,n.push(h)}this.tmp.has_purged_parallel=!1,this.parallel.PruneOutputQueue(this),p=0,m=this.output.queue.slice();var z={strings:{suffix:this.citation.opt.layout_suffix,delimiter:this.citation.opt.layout_delimiter}},M=this.citation.opt.layout_suffix,q=this.tmp.cite_locales[this.tmp.cite_locales.length-1];q&&this.tmp.cite_affixes[this.tmp.area][q]&&this.tmp.cite_affixes[this.tmp.area][q].suffix&&(M=this.tmp.cite_affixes[this.tmp.area][q].suffix),t.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(M.slice(0,1))>-1&&(M=M.slice(0,1));var F=this.citation.opt.layout_delimiter;F||(F=""),t.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(F.slice(0,1))>-1&&(F=F.slice(0,1));var G=[{suffix:"",delimiter:F,blob:z,lastNode:!0}],V=M;for(o=0,a=m.length;a>o;o+=1)t.Output.Queue.purgeEmptyBlobs(this.output.queue,!0);for(o=0,a=m.length;a>o;o+=1){if(this.output.queue=[m[o]],this.tmp.suppress_decorations=n[o].suppress_decorations,this.tmp.splice_delimiter=n[o].splice_delimiter,m[o].parallel_delimiter&&(this.tmp.splice_delimiter=m[o].parallel_delimiter),this.tmp.have_collapsed=n[o].have_collapsed,o===m.length-1&&(G[0].suffix=V),this.opt.development_extensions.clean_up_csl_flaws&&t.Output.Queue.adjustPunctuation(this,this.output.queue,G),c=this.output.string(this,this.output.queue),this.tmp.suppress_decorations=!1,"string"==typeof c)return this.tmp.suppress_decorations=!1,c;if("object"!=typeof c||0!==c.length||l["suppress-author"]||(this.tmp.has_purged_parallel?c.push(""):c.push("[CSL STYLE ERROR: reference with no printed form.]")),r.length&&"string"==typeof c[0]){c.reverse();var X=c.pop();X&&","===X.slice(0,1)?r.push(X):"string"==typeof r.slice(-1)[0]&&","===r.slice(-1)[0].slice(-1)?r.push(" "+X):X&&r.push(v(this.tmp.splice_delimiter)+X)}else c.reverse(),f=c.pop(),"undefined"!=typeof f&&(r.length&&"string"==typeof r[r.length-1]&&(r[r.length-1]+=f.successor_prefix),r.push(f));for(d=c.length,b=0;d>b;b+=1)_=c[b],"string"!=typeof _?(f=c.pop(),"undefined"!=typeof f&&r.push(f)):r.push(v(this.tmp.splice_delimiter)+_);0!==r.length||e[o][1]["suppress-author"]||(p+=1)}if(s+=this.output.renderBlobs(r),s&&(t.TERMINAL_PUNCTUATION.indexOf(this.tmp.last_chr)>-1&&this.tmp.last_chr===V.slice(0,1)&&(V=V.slice(1)),this.output.nestedBraces=!1,this.opt.development_extensions.apply_citation_wrapper&&this.sys.wrapCitationEntry&&!this.tmp.just_looking&&"citation"===this.tmp.area||(s=v(this.citation.opt.layout_prefix)+s+v(V)),!this.tmp.suppress_decorations))for(a=this.citation.opt.layout_decorations.length,o=0;a>o;o+=1)h=this.citation.opt.layout_decorations[o],"normal"!==h[1]&&(s=this.fun.decorate[h[0]][h[1]](this,s));return this.tmp.suppress_decorations=!1,s},t.getCite=function(e,i,s){var r,n;for(this.tmp.cite_renders_content=!1,this.parallel.StartCite(e,i,s),t.citeStart.call(this,e,i),r=0,this.nameOutput=new t.NameOutput(this,e,i);r<this[this.tmp.area].tokens.length;)r=t.tokenExec.call(this,this[this.tmp.area].tokens[r],e,i);return t.citeEnd.call(this,e,i),this.parallel.CloseCite(this),this.tmp.cite_renders_content||this.tmp.just_looking||"bibliography"===this.tmp.area&&(n={index:this.tmp.bibliography_pos,itemID:""+e.id,error_code:t.ERROR_NO_RENDERED_FORM},this.tmp.bibliography_errors.push(n)),""+e.id},t.citeStart=function(e,i){if(this.tmp.disambiguate_count=0,this.tmp.disambiguate_maxMax=0,this.tmp.same_author_as_previous_cite=!1,this.tmp.subsequent_author_substitute_ok=this.tmp.suppress_decorations?!1:!0,this.tmp.lastchr="",this.tmp.have_collapsed="citation"===this.tmp.area&&this.citation.opt.collapse&&this.citation.opt.collapse.length?!0:!1,this.tmp.render_seen=!1,this.tmp.disambig_request&&!this.tmp.disambig_override?this.tmp.disambig_settings=this.tmp.disambig_request:this.registry.registry[e.id]&&!this.tmp.disambig_override?(this.tmp.disambig_request=this.registry.registry[e.id].disambig,this.tmp.disambig_settings=this.registry.registry[e.id].disambig):this.tmp.disambig_settings=new t.AmbigConfig,"citation"!==this.tmp.area&&this.registry.registry[e.id]&&(this.tmp.disambig_restore=t.cloneAmbigConfig(this.registry.registry[e.id].disambig),"bibliography"===this.tmp.area&&this.tmp.disambig_settings&&this.tmp.disambig_override&&(this.opt["disambiguate-add-names"]&&(this.tmp.disambig_settings.names=this.registry.registry[e.id].disambig.names.slice(),this.tmp.disambig_request.names=this.registry.registry[e.id].disambig.names.slice()),this.opt["disambiguate-add-givenname"]))){this.tmp.disambig_request=this.tmp.disambig_settings,this.tmp.disambig_settings.givens=this.registry.registry[e.id].disambig.givens.slice(),this.tmp.disambig_request.givens=this.registry.registry[e.id].disambig.givens.slice();for(var s=0,r=this.tmp.disambig_settings.givens.length;r>s;s+=1)this.tmp.disambig_settings.givens[s]=this.registry.registry[e.id].disambig.givens[s].slice();for(var s=0,r=this.tmp.disambig_request.givens.length;r>s;s+=1)this.tmp.disambig_request.givens[s]=this.registry.registry[e.id].disambig.givens[s].slice()}if(this.tmp.names_used=[],this.tmp.nameset_counter=0,this.tmp.years_used=[],this.tmp.names_max.clear(),this.tmp.splice_delimiter=this[this.tmp.area].opt.layout_delimiter,this.bibliography_sort.keys=[],this.citation_sort.keys=[],this.tmp.has_done_year_suffix=!1,this.tmp.last_cite_locale=!1,!this.tmp.just_looking&&i&&!i.position&&this.registry.registry[e.id]&&(this.tmp.disambig_restore=t.cloneAmbigConfig(this.registry.registry[e.id].disambig)),this.tmp.shadow_numbers={},this.setNumberLabels(e),this.tmp.first_name_string=!1,this.opt.development_extensions.flip_parentheses_to_braces&&i&&i.prefix){var n=t.checkNestedBraceOpen.exec(i.prefix),a=t.checkNestedBraceClose.exec(i.prefix);n?this.output.nestedBraces=a?a[0].length<n[0].length?t.NestedBraces:!1:t.NestedBraces:a&&(this.output.nestedBraces=!1)}},t.citeEnd=function(e,i){if(this.tmp.disambig_restore){this.registry.registry[e.id].disambig.names=this.tmp.disambig_restore.names.slice(),this.registry.registry[e.id].disambig.givens=this.tmp.disambig_restore.givens.slice();for(var s=0,r=this.registry.registry[e.id].disambig.givens.length;r>s;s+=1)this.registry.registry[e.id].disambig.givens[s]=this.tmp.disambig_restore.givens[s].slice()}if(this.tmp.disambig_restore=!1,this.tmp.last_suffix_used=i&&i.suffix?i.suffix:"",this.tmp.last_years_used=this.tmp.years_used.slice(),this.tmp.last_names_used=this.tmp.names_used.slice(),this.tmp.cut_var=!1,this.tmp.disambig_request=!1,this.tmp.cite_locales.push(this.tmp.last_cite_locale),this.tmp.issued_date&&this.tmp.renders_collection_number){for(var n=[],s=this.tmp.issued_date.list.length-1;s>this.tmp.issued_date.pos;s+=-1)n.push(this.tmp.issued_date.list.pop());for(this.tmp.issued_date.list.pop(),s=n.length-1;s>-1;s+=-1)this.tmp.issued_date.list.push(n.pop());this.parallel.use_parallels&&(this.parallel.cite.issued=!1)}if(this.tmp.issued_date=!1,this.tmp.renders_collection_number=!1,this.opt.development_extensions.flip_parentheses_to_braces&&i&&i.suffix){var a=t.checkNestedBraceOpen.exec(i.suffix),o=t.checkNestedBraceClose.exec(i.suffix);o?this.output.nestedBraces=a?a[0].length<o[0].length?!1:t.NestedBraces:!1:a&&(this.output.nestedBraces=t.NestedBraces)}},t.Engine.prototype.makeBibliography=function(e){var i,s,r,n,a,o,l,u,h;if(i=!1,!this.bibliography.tokens.length)return!1;"string"==typeof e&&(this.opt.citation_number_slug=e,e=!1),s=t.getBibliographyEntries.call(this,e),u=s[0],h=s[1];var p=s[2];for(r={maxoffset:0,entryspacing:this.bibliography.opt["entry-spacing"],linespacing:this.bibliography.opt["line-spacing"],"second-field-align":!1,entry_ids:u,bibliography_errors:this.tmp.bibliography_errors.slice(),done:p},this.bibliography.opt["second-field-align"]&&(r["second-field-align"]=this.bibliography.opt["second-field-align"]),n=0,o=this.registry.reflist.length,l=0;o>l;l+=1)a=this.registry.reflist[l],a.offset>r.maxoffset&&(r.maxoffset=a.offset);return this.bibliography.opt.hangingindent&&(r.hangingindent=this.bibliography.opt.hangingindent),r.bibstart=this.fun.decorate.bibstart,r.bibend=this.fun.decorate.bibend,this.opt.citation_number_slug=!1,[r,h]},t.getBibliographyEntries=function(e){function i(t,e){return t===e?!0:!1}function s(t,e){for(m=e.length,g=0;m>g;g+=1)if(i(t,e[g]))return!0;return!1}function r(t,e){return"none"!==t&&t||e?"string"==typeof e?i(t,e):e?s(t,e):!1:!0}var n,a,o,l,u,h,p,c,f,m,g,d,b,_,y,v,x,I,S,O,T,A,E,N;n=[],A=[],this.tmp.area="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,a=e&&e.page_start&&e.page_length?this.registry.getSortedIds():this.retrieveItems(this.registry.getSortedIds()),this.tmp.disambig_override=!0,I={};var k;if(e&&e.page_start&&e.page_length&&(k=0,e.page_start!==!0))for(y=0,v=a.length;v>y&&(I[a[y]]=!0,e.page_start!=a[y]);y+=1);var R=[];for(y=0,v=a.length;v>y;y+=1){if(e&&e.page_start&&e.page_length){if(I[a[y]])continue;if(c=this.retrieveItem(a[y]),k===e.page_length)break}else if(c=a[y],I[c.id])continue;if(e){if(o=!0,e.include){for(o=!1,E=0,N=e.include.length;N>E;E+=1)if(f=e.include[E],r(f.value,c[f.field])){o=!0;break}}else if(e.exclude){for(l=!1,E=0,N=e.exclude.length;N>E;E+=1)if(f=e.exclude[E],r(f.value,c[f.field])){l=!0;break}l&&(o=!1)}else if(e.select){for(o=!1,u=!0,E=0,N=e.select.length;N>E;E+=1)f=e.select[E],r(f.value,c[f.field])||(u=!1);u&&(o=!0)}if(e.quash){for(u=!0,E=0,N=e.quash.length;N>E;E+=1)f=e.quash[E],r(f.value,c[f.field])||(u=!1);u&&(o=!1)}if(!o)continue}if(h=new t.Token("group",t.START),h.decorations=[["@bibliography","entry"]].concat(this.bibliography.opt.layout_decorations),this.output.startTag("bib_entry",h),c.system_id&&this.sys.embedBibliographyEntry?this.output.current.value().item_id=c.system_id:this.output.current.value().system_id=c.id,S=[[{id:""+c.id},c]],b=[],!this.registry.registry[c.id].master||e&&e.page_start&&e.page_length)this.registry.registry[c.id].siblings||(this.parallel.StartCitation(S),this.tmp.term_predecessor=!1,b.push(""+t.getCite.call(this,c)),e&&e.page_start&&e.page_length&&(k+=1));else{for(_=!0,this.parallel.StartCitation(S),this.output.queue[0].strings.delimiter=", ",this.tmp.term_predecessor=!1,b.push(""+t.getCite.call(this,c)),I[c.id]=!0,x=this.registry.registry[c.id].siblings,E=0,N=x.length;N>E;E+=1){var w=this.registry.registry[c.id].siblings[E];O=this.retrieveItem(w),b.push(""+t.getCite.call(this,O)),I[O.id]=!0}this.parallel.ComposeSet(),this.parallel.PruneOutputQueue()}if(A.push(""),this.tmp.bibliography_pos+=1,R.push(b),this.output.endTag("bib_entry"),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length){for(_||!this.output.queue[0].blobs[0].blobs[0].strings?(d=this.output.queue[0].blobs,_=!1):d=this.output.queue[0].blobs[0].blobs,E=d.length-1;E>-1;E+=-1)if(d[E].blobs&&0!==d[E].blobs.length){var C,L=this.tmp.cite_locales[this.tmp.cite_locales.length-1];C=this.tmp.cite_affixes[this.tmp.area][L]?this.tmp.cite_affixes[this.tmp.area][L].suffix:this.bibliography.opt.layout_suffix,T=C.slice(0,1),T&&d[E].strings.suffix.slice(-1)===T&&(d[E].strings.suffix=d[E].strings.suffix.slice(0,-1)),d[E].strings.suffix+=C;break}d[0].strings.prefix=this.bibliography.opt.layout_prefix+d[0].strings.prefix}t.Output.Queue.purgeEmptyBlobs(this.output.queue),t.Output.Queue.adjustPunctuation(this,this.output.queue),p=this.output.string(this,this.output.queue)[0],p||(p="\n[CSL STYLE ERROR: reference with no printed form.]\n"),n.push(p)
}var P=!1;if(e&&e.page_start&&e.page_length){var U=a.slice(-1)[0],D=R.slice(-1)[0];U&&D&&U!=D||(P=!0)}return this.tmp.disambig_override=!1,[R,n,P]},t.Engine.prototype.setCitationId=function(t,e){var i,s,r;if(i=!1,!t.citationID||e){for(s=Math.floor(1e14*Math.random());;){if(r=0,!this.registry.citationreg.citationById[s]){t.citationID=s.toString(32);break}r=!r&&5e13>s?1:-1,s+=1===r?1:-1}i=""+s}return this.registry.citationreg.citationById[t.citationID]=t,i},t.Engine.prototype.rebuildProcessorState=function(e,i,s){e||(e=[]),i||(i="html");for(var r={},n=[],a=0,o=e.length;o>a;a+=1)for(var l=0,u=e[a].citationItems.length;u>l;l+=1){var h=""+e[a].citationItems[l].id;r[h]||n.push(h),r[h]=!0}this.updateItems(n);var p=[],c=[],f=[],m=this.opt.mode;this.setOutputFormat(i);for(var a=0,o=e.length;o>a;a+=1){var g=this.processCitationCluster(e[a],p,c,t.ASSUME_ALL_ITEMS_REGISTERED);p.push([e[a].citationID,e[a].properties.noteIndex]);for(var l=0,u=g[1].length;u>l;l+=1){var d=g[1][l][0];f[d]=[p[d][0],p[d][1],g[1][l][1]]}}return this.updateUncitedItems(s),this.setOutputFormat(m),f},t.Engine.prototype.restoreProcessorState=function(e){var i,s,r,n,a,o,l,u,h,p;u=[],h=[],e||(e=[]);var c=[],f={};for(i=0,s=e.length;s>i;i+=1)f[e[i].citationID]&&this.setCitationId(e[i],!0),f[e[i].citationID]=!0,c.push(e[i].properties.index);var m=e.slice();for(m.sort(function(t,e){return t.properties.index<e.properties.index?-1:t.properties.index>e.properties.index?1:0}),i=0,s=m.length;s>i;i+=1)m[i].properties.index=i;for(i=0,s=m.length;s>i;i+=1){for(p=[],r=0,n=m[i].citationItems.length;n>r;r+=1)a=m[i].citationItems[r],"undefined"==typeof a.sortkeys&&(a.sortkeys=[]),o=this.retrieveItem(""+a.id),l=[o,a],p.push(l),m[i].citationItems[r].item=o,h.push(""+a.id);m[i].properties.unsorted||p.sort(this.citation.srt.compareCompositeKeys),m[i].sortedItems=p,this.registry.citationreg.citationById[m[i].citationID]=m[i]}for(this.updateItems(h),i=0,s=e.length;s>i;i+=1)u.push([""+e[i].citationID,e[i].properties.noteIndex]);var g=[];return e&&e.length?g=this.processCitationCluster(e[0],[],u.slice(1)):(this.registry=new t.Registry(this),this.tmp=new t.Engine.Tmp,this.disambiguate=new t.Disambiguation(this)),g},t.Engine.prototype.updateItems=function(t,e,i){var s=this.tmp.area;if(this.registry.init(t),i)for(var r in this.registry.ambigcites)this.registry.ambigsTouched[r]=!0;return this.registry.dodeletes(this.registry.myhash),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),e||this.registry.sorttokens(),this.registry.renumber(),this.tmp.area=s,this.registry.getSortedIds()},t.Engine.prototype.updateUncitedItems=function(t,e){if(t||(t=[]),"object"==typeof t)if("undefined"==typeof t.length){var i=t;t=[];for(var s in i)t.push(s)}else if("number"==typeof t.length)for(var i={},r=0,n=t.length;n>r;r+=1)i[t[r]]=!0;return this.registry.init(t,!0),this.registry.dopurge(i),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),e||this.registry.sorttokens(),this.registry.renumber(),this.registry.getSortedIds()},t.localeResolve=function(e,i){var s,r;return i||(i="en-US"),e||(e=i),s={},r=e.split(/[\-_]/),s.base=t.LANG_BASES[r[0]],"undefined"==typeof s.base?(t.debug("Warning: unknown locale "+e+", setting fallback to "+i),{base:i,best:e,bare:r[0]}):(1===r.length&&(s.generic=!0),s.best=1===r.length||"x"===r[1]?s.base.replace("_","-"):r.slice(0,2).join("-"),s.base=s.base.replace("_","-"),s.bare=r[0],s)},t.Engine.prototype.localeConfigure=function(t,e){var i;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(t.best=t.best.toLowerCase(),t.bare=t.bare.toLowerCase(),t.base=t.base.toLowerCase()),(!e||!this.locale[t.best])&&(i=this.sys.xml.makeXml(this.sys.retrieveLocale("en-US")),this.localeSet(i,"en-US",t.best),"en-US"!==t.best&&(t.base!==t.best&&(i=this.sys.xml.makeXml(this.sys.retrieveLocale(t.base)),this.localeSet(i,t.base,t.best)),i=this.sys.xml.makeXml(this.sys.retrieveLocale(t.best)),this.localeSet(i,t.best,t.best)),this.localeSet(this.cslXml,"",t.best),this.localeSet(this.cslXml,t.bare,t.best),t.base!==t.best&&this.localeSet(this.cslXml,t.base,t.best),this.localeSet(this.cslXml,t.best,t.best),"undefined"==typeof this.locale[t.best].terms["page-range-delimiter"]&&(this.locale[t.best].terms["page-range-delimiter"]=["fr","pt"].indexOf(t.best.slice(0,2).toLowerCase())>-1?"-":"–"),"undefined"==typeof this.locale[t.best].terms["year-range-delimiter"]&&(this.locale[t.best].terms["year-range-delimiter"]="–"),"undefined"==typeof this.locale[t.best].terms["citation-range-delimiter"]&&(this.locale[t.best].terms["citation-range-delimiter"]="–"),this.opt.development_extensions.normalize_lang_keys_to_lowercase)){for(var s=["default-locale","locale-sort","locale-translit","locale-translat"],r=0,n=s.length;n>r;r+=1)for(var a=0,o=this.opt[s[r]].length;o>a;a+=1)this.opt[s[r]][a]=this.opt[s[r]][a].toLowerCase();this.opt.lang=this.opt.lang.toLowerCase()}},t.Engine.prototype.localeSet=function(e,i,s){var r,n,a,o,l,u,h,p,c,f,m,g,d,b,_,y;if(i=i.replace("_","-"),s=s.replace("_","-"),this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(i=i.toLowerCase(),s=s.toLowerCase()),this.locale[s]||(this.locale[s]={},this.locale[s].terms={},this.locale[s].opts={},this.locale[s].opts["skip-words"]=t.SKIP_WORDS,this.locale[s].opts["leading-noise-words"]||(this.locale[s].opts["leading-noise-words"]=[]),this.locale[s].dates={},this.locale[s].ord={"1.0.1":!1,keys:{}},this.locale[s]["noun-genders"]={}),n=this.sys.xml.makeXml(),this.sys.xml.nodeNameIs(e,"locale"))n=e;else for(a=this.sys.xml.getNodesByName(e,"locale"),l=0,g=this.sys.xml.numberofnodes(a);g>l;l+=1)if(r=a[l],this.sys.xml.getAttributeValue(r,"lang","xml")===i){n=r;break}for(a=this.sys.xml.getNodesByName(n,"type"),_=0,y=this.sys.xml.numberofnodes(a);y>_;_+=1){var v=a[_],x=this.sys.xml.getAttributeValue(v,"name"),I=this.sys.xml.getAttributeValue(v,"gender");this.opt.gender[x]=I}var S=this.sys.xml.getNodesByName(n,"term","ordinal").length;if(S){for(var O in this.locale[s].ord.keys)delete this.locale[s].terms[O];this.locale[s].ord={"1.0.1":!1,keys:{}}}a=this.sys.xml.getNodesByName(n,"term");var T={"last-digit":{},"last-two-digits":{},"whole-number":{}},A=!1,E={};for(l=0,g=this.sys.xml.numberofnodes(a);g>l;l+=1){if(u=a[l],p=this.sys.xml.getAttributeValue(u,"name"),"sub verbo"===p&&(p="sub-verbo"),"ordinal"===p.slice(0,7)){if(this.sys.xml.getNodeValue(u),"ordinal"===p)A=!0;else{var N=this.sys.xml.getAttributeValue(u,"match"),k=p.slice(8),d=this.sys.xml.getAttributeValue(u,"gender-form");d||(d="neuter"),N||(N="last-two-digits","0"===k.slice(0,1)&&(N="last-digit")),"0"===k.slice(0,1)&&(k=k.slice(1)),T[N][k]||(T[N][k]={}),T[N][k][d]=p}this.locale[s].ord.keys[p]=!0}"undefined"==typeof this.locale[s].terms[p]&&(this.locale[s].terms[p]={}),h="long",d=!1,this.sys.xml.getAttributeValue(u,"form")&&(h=this.sys.xml.getAttributeValue(u,"form")),this.sys.xml.getAttributeValue(u,"gender-form")&&(d=this.sys.xml.getAttributeValue(u,"gender-form")),this.sys.xml.getAttributeValue(u,"gender")&&(this.locale[s]["noun-genders"][p]=this.sys.xml.getAttributeValue(u,"gender")),d?(this.locale[s].terms[p][d]={},this.locale[s].terms[p][d][h]=[],b=this.locale[s].terms[p][d],E[p]=!0):(this.locale[s].terms[p][h]=[],b=this.locale[s].terms[p]),this.sys.xml.numberofnodes(this.sys.xml.getNodesByName(u,"multiple"))?(b[h][0]=this.sys.xml.getNodeValue(u,"single"),b[h][1]=this.sys.xml.getNodeValue(u,"multiple")):b[h]=this.sys.xml.getNodeValue(u)}if(A){for(var R in E){var w={},C=0;for(var L in this.locale[s].terms[R])["masculine","feminine"].indexOf(L)>-1?w[L]=this.locale[s].terms[R][L]:C+=1;if(!C)if(w.feminine)for(var L in w.feminine)this.locale[s].terms[R][L]=w.feminine[L];else if(w.masculine)for(var L in w.masculine)this.locale[s].terms[R][L]=w.masculine[L]}this.locale[s].ord["1.0.1"]=T}for(p in this.locale[s].terms)for(_=0,y=2;y>_;_+=1)if(d=t.GENDERS[_],this.locale[s].terms[p][d])for(h in this.locale[s].terms[p])this.locale[s].terms[p][d][h]||(this.locale[s].terms[p][d][h]=this.locale[s].terms[p][h]);for(a=this.sys.xml.getNodesByName(n,"style-options"),l=0,g=this.sys.xml.numberofnodes(a);g>l;l+=1){c=a[l],o=this.sys.xml.attributes(c);for(m in o)if(o.hasOwnProperty(m))if("@punctuation-in-quote"===m||"@limit-day-ordinals-to-day-1"===m)this.locale[s].opts[m.slice(1)]="true"===o[m]?!0:!1;else if("@skip-words"===m){var P=o[m].split(/\s*,\s*/);this.locale[s].opts[m.slice(1)]=P}else if("@leading-noise-words"===m&&i===s){var U=o[m].split(/\s*,\s*/);this.locale[s].opts["leading-noise-words"]=U}else if("@name-as-sort-order"===m){this.locale[s].opts["name-as-sort-order"]={};for(var D=o[m].split(/\s+/),_=0,y=D.length;y>_;_+=1)this.locale[s].opts["name-as-sort-order"][D[_]]=!0}else if("@name-as-reverse-order"===m){this.locale[s].opts["name-as-reverse-order"]={};for(var D=o[m].split(/\s+/),_=0,y=D.length;y>_;_+=1)this.locale[s].opts["name-as-reverse-order"][D[_]]=!0}else if("@name-never-short"===m){this.locale[s].opts["name-never-short"]={};for(var D=o[m].split(/\s+/),_=0,y=D.length;y>_;_+=1)this.locale[s].opts["name-never-short"][D[_]]=!0}}for(a=this.sys.xml.getNodesByName(n,"date"),l=0,g=this.sys.xml.numberofnodes(a);g>l;l+=1)f=a[l],this.locale[s].dates[this.sys.xml.getAttributeValue(f,"form")]=f},t.Node={},t.Node.bibliography={build:function(e,i){this.tokentype===t.START&&(e.build.area="bibliography",e.build.root="bibliography",e.fixOpt(this,"names-delimiter","delimiter"),e.fixOpt(this,"name-delimiter","delimiter"),e.fixOpt(this,"name-form","form"),e.fixOpt(this,"and","and"),e.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),e.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),e.fixOpt(this,"initialize-with","initialize-with"),e.fixOpt(this,"initialize","initialize"),e.fixOpt(this,"name-as-sort-order","name-as-sort-order"),e.fixOpt(this,"sort-separator","sort-separator"),e.fixOpt(this,"and","and"),e.fixOpt(this,"et-al-min","et-al-min"),e.fixOpt(this,"et-al-use-first","et-al-use-first"),e.fixOpt(this,"et-al-use-last","et-al-use-last"),e.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),e.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first")),i.push(this)}},t.Node.choose={build:function(e,i){var s;this.tokentype===t.START&&(s=function(e){e.tmp.jump.push(void 0,t.LITERAL)}),this.tokentype===t.END&&(s=function(t){t.tmp.jump.pop()}),this.execs.push(s),i.push(this)},configure:function(e,i){this.tokentype===t.END?(e.configure.fail.push(i),e.configure.succeed.push(i)):(e.configure.fail.pop(),e.configure.succeed.pop())}},t.Node.citation={build:function(e){if(this.tokentype===t.START&&(e.fixOpt(this,"names-delimiter","delimiter"),e.fixOpt(this,"name-delimiter","delimiter"),e.fixOpt(this,"name-form","form"),e.fixOpt(this,"and","and"),e.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),e.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),e.fixOpt(this,"initialize-with","initialize-with"),e.fixOpt(this,"initialize","initialize"),e.fixOpt(this,"name-as-sort-order","name-as-sort-order"),e.fixOpt(this,"sort-separator","sort-separator"),e.fixOpt(this,"and","and"),e.fixOpt(this,"et-al-min","et-al-min"),e.fixOpt(this,"et-al-use-first","et-al-use-first"),e.fixOpt(this,"et-al-use-last","et-al-use-last"),e.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),e.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),e.build.area="citation"),this.tokentype===t.END){if(e.opt.grouped_sort="in-text"===e.opt.xclass&&e.citation.opt.collapse&&e.citation.opt.collapse.length||e.citation.opt.cite_group_delimiter&&e.citation.opt.cite_group_delimiter.length&&e.opt.update_mode!==t.POSITION&&e.opt.update_mode!==t.NUMERIC,e.opt.grouped_sort&&e.citation_sort.opt.sort_directions.length){var i=e.citation_sort.opt.sort_directions[0].slice();e.citation_sort.opt.sort_directions=[i].concat(e.citation_sort.opt.sort_directions)}e.citation.srt=new t.Registry.Comparifier(e,"citation_sort")}}},t.Node["#comment"]={build:function(){}},t.Node.date={build:function(e,i){var s,r,n,a,o,l,u,h,p,c;(this.tokentype===t.START||this.tokentype===t.SINGLETON)&&(e.build.date_parts=[],e.build.date_variables=this.variables,e.build.extension||t.Util.substituteStart.call(this,e,i),s=e.build.extension?t.dateMacroAsSortKey:function(t,e,i){var s;if(t.tmp.element_rendered_ok=!1,t.tmp.donesies=[],t.tmp.dateparts=[],s=[],!this.variables.length||t.tmp.just_looking&&"issued"!==this.variables[0])t.tmp.date_object=!1;else{for(t.parallel.StartVariable(this.variables[0]),r=e[this.variables[0]],"undefined"==typeof r&&(r={"date-parts":[[0]]},t.opt.development_extensions.locator_date_and_revision&&i&&"locator-date"===this.variables[0]&&i["locator-date"]&&(r=i["locator-date"])),t.tmp.date_object=r,n=this.dateparts.length,a=0;n>a;a+=1)o=this.dateparts[a],"undefined"!=typeof t.tmp.date_object[o+"_end"]?s.push(o):"month"===o&&"undefined"!=typeof t.tmp.date_object.season_end&&s.push(o);for(l=[],u=["year","month","day"],n=u.length,a=0;n>a;a+=1)s.indexOf(u[a])>-1&&l.push(u[a]);for(s=l.slice(),h=2,n=s.length,a=0;n>a;a+=1)if(o=s[a],p=t.tmp.date_object[o],c=t.tmp.date_object[o+"_end"],p!==c){h=a;break}t.tmp.date_collapse_at=s.slice(h)}},this.execs.push(s),s=function(t,e){if(t.output.startTag("date",this),"issued"===this.variables[0]&&"legal_case"===e.type&&!t.tmp.extension&&""+e["collection-number"]==""+t.tmp.date_object.year&&1===this.dateparts.length&&"year"===this.dateparts[0])for(var i in t.tmp.date_object)if(t.tmp.date_object.hasOwnProperty(i)&&"year"===i.slice(0,4)){t.tmp.issued_date={};var s=t.output.current.mystack.slice(-2)[0].blobs;t.tmp.issued_date.list=s,t.tmp.issued_date.pos=s.length-1}},this.execs.push(s)),e.build.extension||this.tokentype!==t.END&&this.tokentype!==t.SINGLETON||(s=function(t){t.output.endTag(),t.parallel.CloseVariable("date")},this.execs.push(s)),i.push(this),(this.tokentype===t.END||this.tokentype===t.SINGLETON)&&(e.build.extension||t.Util.substituteEnd.call(this,e,i))}},t.Node["date-part"]={build:function(e,i){var s,r,n,a,o,l,u,h,p,c,f,m,g,d,b,_,y,v,x,I,S,O,T,A;this.strings.form||(this.strings.form="long"),e.build.date_parts.push(this.strings.name);var E=e.build.date_variables[0];s=function(e,i){if(e.tmp.date_object){if(a=!0,o="",l="",e.tmp.donesies.push(this.strings.name),e.tmp.date_object.literal&&"year"===this.strings.name&&(e.parallel.AppendToVariable(e.tmp.date_object.literal),e.output.append(e.tmp.date_object.literal,this)),e.tmp.date_object&&(o=e.tmp.date_object[this.strings.name],l=e.tmp.date_object[this.strings.name+"_end"]),"year"!==this.strings.name||0!==o||e.tmp.suppress_decorations||(o=!1),u=!e.tmp.suppress_decorations,h=e.tmp.have_collapsed,p="year-suffix"===e[e.tmp.area].opt.collapse||"year-suffix-ranged"===e[e.tmp.area].opt.collapse,c=e.opt["disambiguate-add-year-suffix"],u&&c&&p&&(e.tmp.years_used.push(o),f=e.tmp.last_years_used.length>=e.tmp.years_used.length,f&&h&&e.tmp.last_years_used[e.tmp.years_used.length-1]===o&&(o=!1)),"undefined"!=typeof o){m=!1,g=!1,d=!1,b=!1,"year"===this.strings.name&&(parseInt(o,10)<500&&parseInt(o,10)>0&&(g=e.getTerm("ad")),parseInt(o,10)<0&&(m=e.getTerm("bc"),o=-1*parseInt(o,10)),l&&(parseInt(l,10)<500&&parseInt(l,10)>0&&(b=e.getTerm("ad")),parseInt(l,10)<0&&(d=e.getTerm("bc"),l=-1*parseInt(l,10)))),e.parallel.AppendToVariable(o);for(var s=""+e.tmp.date_object.month;s.length<2;)s="0"+s;s="month-"+s;var N=e.locale[e.opt.lang]["noun-genders"][s];if(this.strings.form){var k=this.strings.form;if("day"===this.strings.name&&"ordinal"===k&&e.locale[e.opt.lang].opts["limit-day-ordinals-to-day-1"]&&"1"!=""+o&&(k="numeric"),o=t.Util.Dates[this.strings.name][k](e,o,N,"accessed"===E),"month"===this.strings.name)if(e.tmp.strip_periods)o=o.replace(/\./g,"");else for(T=0,A=this.decorations.length;A>T;T+=1)if("@strip-periods"===this.decorations[T][0]&&"true"===this.decorations[T][1]){o=o.replace(/\./g,"");break}if(l)if(l=t.Util.Dates[this.strings.name][k](e,l,N,"accessed"===E,"_end"),e.tmp.strip_periods)l=l.replace(/\./g,"");else for(T=0,A=this.decorations.length;A>T;T+=1)if("@strip-periods"===this.decorations[T][0]&&"true"===this.decorations[T][1]){l=l.replace(/\./g,"");break}}if(e.output.openLevel("empty"),e.tmp.date_collapse_at.length){for(_=!0,n=e.tmp.date_collapse_at.length,r=0;n>r;r+=1)if(O=e.tmp.date_collapse_at[r],-1===e.tmp.donesies.indexOf(O)){_=!1;break}if(_){if("0"!=""+l){if(0===e.dateput.queue.length&&(a=!0),e.opt["year-range-format"]&&"expanded"!==e.opt["year-range-format"]&&!e.tmp.date_object.day&&!e.tmp.date_object.month&&!e.tmp.date_object.season&&"year"===this.strings.name&&o&&l){l=e.fun.year_mangler(o+"-"+l,!0);var R=e.getTerm("year-range-delimiter");l=l.slice(l.indexOf(R)+1)}e.dateput.append(l,this),a&&(e.dateput.current.value()[0].strings.prefix="")}e.output.append(o,this),y=e.output.current.value(),y.blobs[y.blobs.length-1].strings.suffix="",e.output.append(e.getTerm("year-range-delimiter"),"empty"),v=e.dateput.current.value(),y.blobs=y.blobs.concat(v),e.dateput.string(e,e.dateput.queue),e.tmp.date_collapse_at=[]}else e.output.append(o,this),e.tmp.date_collapse_at.indexOf(this.strings.name)>-1&&"0"!=""+l&&(0===e.dateput.queue.length&&(a=!0),e.dateput.openLevel("empty"),e.dateput.append(l,this),a&&(e.dateput.current.value().blobs[0].strings.prefix=""),m&&e.dateput.append(m),g&&e.dateput.append(g),e.dateput.closeLevel())}else e.output.append(o,this);m&&e.output.append(m),g&&e.output.append(g),e.output.closeLevel()}else"month"===this.strings.name&&e.tmp.date_object.season&&(o=""+e.tmp.date_object.season,o&&o.match(/^[1-4]$/)?(e.tmp.group_context.replace([!1,!1,!0]),e.output.append(e.getTerm("season-0"+o),this)):o&&e.output.append(o,this));e.tmp.value=[],!o&&!e.tmp.have_collapsed||e.opt.has_year_suffix||"year"!==this.strings.name||e.tmp.just_looking||e.registry.registry[i.id]&&e.registry.registry[i.id].disambig.year_suffix!==!1&&!e.tmp.has_done_year_suffix&&(e.tmp.has_done_year_suffix=!0,I=parseInt(e.registry.registry[i.id].disambig.year_suffix,10),x=new t.NumericBlob(I,this,i.id),this.successor_prefix=e[e.build.area].opt.layout_delimiter,this.splice_prefix=e[e.build.area].opt.layout_delimiter,S=new t.Util.Suffixator(t.SUFFIX_CHARS),x.setFormatter(S),"year-suffix-ranged"===e[e.tmp.area].opt.collapse&&(x.range_prefix=e.getTerm("citation-range-delimiter")),x.successor_prefix=e[e.tmp.area].opt["year-suffix-delimiter"]?e[e.tmp.area].opt["year-suffix-delimiter"]:e[e.tmp.area].opt.layout_delimiter,x.UGLY_DELIMITER_SUPPRESS_HACK=!0,e.output.append(x,"literal"))}},this.execs.push(s),i.push(this)}},t.Node["else-if"]={build:function(e,i){t.Conditions.TopNode.call(this,e,i),i.push(this)},configure:function(e,i){t.Conditions.Configure.call(this,e,i)}},t.Node["else"]={build:function(t,e){e.push(this)},configure:function(e,i){this.tokentype===t.START&&(e.configure.fail[e.configure.fail.length-1]=i)}},t.Node["et-al"]={build:function(t,e){if("citation"===t.build.area||"bibliography"===t.build.area){var i=function(t){t.tmp.etal_node=this,"string"==typeof this.strings.term&&(t.tmp.etal_term=this.strings.term)};this.execs.push(i)}e.push(this)}},t.Node.group={build:function(e,i){var s,r;this.tokentype===t.START?(t.Util.substituteStart.call(this,e,i),e.build.substitute_level.value()&&e.build.substitute_level.replace(e.build.substitute_level.value()+1),s=function(e){e.output.startTag("group",this),e.tmp.group_context.mystack.length&&(e.output.current.value().parent=e.tmp.group_context.value()[4]);var i=e.tmp.group_context.value()[5];!i&&this.strings.label_form_override&&(i=this.strings.label_form_override),e.tmp.group_context.push([!1,!1,!1,!1,e.output.current.value(),i,this.strings.set_parallel_condition],t.LITERAL),this.strings.oops&&(e.tmp.group_context.value()[3]=this.strings.oops)},r=[],r.push(s),this.execs=r.concat(this.execs),this.strings["has-publisher-and-publisher-place"]&&(e.build["publisher-special"]=!0,s=function(e,i){if(this.strings["subgroup-delimiter"]&&i.publisher&&i["publisher-place"]){var s=i.publisher.split(/;\s*/),r=i["publisher-place"].split(/;\s*/);s.length>1&&s.length===r.length&&(e.publisherOutput=new t.PublisherOutput(e,this),e.publisherOutput["publisher-list"]=s,e.publisherOutput["publisher-place-list"]=r)}},this.execs.push(s))):(e.build["publisher-special"]&&(e.build["publisher-special"]=!1,"string"==typeof e[e.build.root].opt["name-delimiter"]&&(s=function(t){t.publisherOutput&&(t.publisherOutput.render(),t.publisherOutput=!1)},this.execs.push(s))),s=function(t,e){var i=t.tmp.group_context.pop();if(t.output.endTag(),t.tmp.group_context.value(),i[1]&&(t.tmp.group_context.value()[1]=!0),i[2]||i[0]&&!i[1]){t.tmp.group_context.value()[2]=!0;var s=t.output.current.value().blobs,r=t.output.current.value().blobs.length-1;if(!t.tmp.just_looking&&"undefined"!=typeof i[6]){var n={blobs:s,conditions:i[6],id:e.id,pos:r};t.parallel.parallel_conditional_blobs_list.push(n)}}else t.output.current.value().blobs&&t.output.current.value().blobs.pop(),t.tmp.group_context.value()[3]&&(t.output.current.mystack[t.output.current.mystack.length-2].strings.delimiter=t.tmp.group_context.value()[3])},this.execs.push(s)),i.push(this),this.tokentype===t.END&&(e.build.substitute_level.value()&&e.build.substitute_level.replace(e.build.substitute_level.value()-1),t.Util.substituteEnd.call(this,e,i))}},t.Node["if"]={build:function(e,i){t.Conditions.TopNode.call(this,e,i),i.push(this)},configure:function(e,i){t.Conditions.Configure.call(this,e,i)}},t.Node.conditions={build:function(e){this.tokentype===t.START&&e.tmp.conditions.addMatch(this.match),this.tokentype===t.END&&e.tmp.conditions.matchCombine()}},t.Node.condition={build:function(e){if(this.tokentype===t.SINGLETON){var i=e.fun.match[this.match](this,e,this.tests);e.tmp.conditions.addTest(i)}}},t.Conditions={},t.Conditions.TopNode=function(e){var i;(this.tokentype===t.START||this.tokentype===t.SINGLETON)&&(this.locale&&(e.opt.lang=this.locale),this.tests&&this.tests.length?this.test=e.fun.match[this.match](this,e,this.tests):e.tmp.conditions=new t.Conditions.Engine(e,this)),(this.tokentype===t.END||this.tokentype===t.SINGLETON)&&(i=function(t){this.locale_default&&(t.output.current.value().old_locale=this.locale_default,t.output.closeLevel("empty"),t.opt.lang=this.locale_default);var e=this[t.tmp.jump.value()];return e},this.execs.push(i),this.locale_default&&(e.opt.lang=this.locale_default))},t.Conditions.Configure=function(e,i){this.tokentype===t.START?(this.fail=e.configure.fail.slice(-1)[0],this.succeed=this.next,e.configure.fail[e.configure.fail.length-1]=i):this.tokentype===t.SINGLETON?(this.fail=this.next,this.succeed=e.configure.succeed.slice(-1)[0],e.configure.fail[e.configure.fail.length-1]=i):(this.succeed=e.configure.succeed.slice(-1)[0],this.fail=this.next)},t.Conditions.Engine=function(t,e){this.token=e,this.state=t},t.Conditions.Engine.prototype.addTest=function(t){this.token.tests.push(t)},t.Conditions.Engine.prototype.addMatch=function(t){this.token.match=t},t.Conditions.Engine.prototype.matchCombine=function(){this.token.test=this.state.fun.match[this.token.match](this.token,this.state,this.token.tests)},t.Node.info={build:function(e){e.build.skip=this.tokentype===t.START?"info":!1}},t.Node.institution={build:function(e,i){if([t.SINGLETON,t.START].indexOf(this.tokentype)>-1){var s=function(e){"string"!=typeof e.build.name_delimiter||this.strings.delimiter||(this.strings.delimiter=e.tmp.name_delimiter),"text"===this.strings.and?this.and_term=e.getTerm("and","long",0):"symbol"===this.strings.and?this.and_term=e.opt.development_extensions.expect_and_symbol_form?e.getTerm("and","symbol",0):"&":"none"===this.strings.and&&(this.and_term=this.strings.delimiter),"undefined"==typeof this.and_term&&e.tmp.and_term&&(this.and_term=e.getTerm("and","long",0)),t.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]&&this.and_prefix_multiple&&(this.and_prefix_multiple=" "),this.and={},"undefined"!=typeof this.and_term?(e.output.append(this.and_term,"empty",!0),this.and.single=e.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,e.output.append(this.and_term,"empty",!0),this.and.multiple=e.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):"undefined"!==this.strings.delimiter&&(this.and.single=new t.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new t.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),e.nameOutput.institution=this};this.execs.push(s)}i.push(this)},configure:function(e){[t.SINGLETON,t.START].indexOf(this.tokentype)>-1&&(e.build.has_institution=!0)}},t.Node["institution-part"]={build:function(t,e){var i;"long"===this.strings.name?i=this.strings["if-short"]?function(t){t.nameOutput.institutionpart["long-with-short"]=this}:function(t){t.nameOutput.institutionpart["long"]=this}:"short"===this.strings.name&&(i=function(t){t.nameOutput.institutionpart["short"]=this}),this.execs.push(i),e.push(this)}},t.Node.key={build:function(e,i){var s,r=new t.Token("key",t.START);r.strings["et-al-min"]=this.strings["et-al-min"],r.strings["et-al-use-first"]=this.strings["et-al-use-first"],r.strings["et-al-use-last"]=this.strings["et-al-use-last"],s=function(t){t.tmp.done_vars=[]},r.execs.push(s),e.opt.citation_number_sort_direction=this.strings.sort_direction,s=function(t){t.output.openLevel("empty")},r.execs.push(s);var n=[];if(this.strings.sort_direction===t.DESCENDING?(n.push(1),n.push(-1)):(n.push(-1),n.push(1)),e[e.build.area].opt.sort_directions.push(n),t.DATE_VARIABLES.indexOf(this.variables[0])>-1&&(e.build.date_key=!0),s=function(t){t.tmp.sort_key_flag=!0,this.strings["et-al-min"]&&(t.tmp["et-al-min"]=this.strings["et-al-min"]),this.strings["et-al-use-first"]&&(t.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"boolean"==typeof this.strings["et-al-use-last"]&&(t.tmp["et-al-use-last"]=this.strings["et-al-use-last"])},r.execs.push(s),i.push(r),this.variables.length){var a=this.variables[0];if("citation-number"===a&&("citation_sort"===e.build.area&&(e.opt.citation_number_sort=!0),"bibliography_sort"===e.build.area&&(e.opt.citation_number_sort_used=!0)),t.CREATORS.indexOf(a)>-1){var o=new t.Token("names",t.START);o.tokentype=t.START,o.variables=this.variables,t.Node.names.build.call(o,e,i);var l=new t.Token("name",t.SINGLETON);l.tokentype=t.SINGLETON,l.strings["name-as-sort-order"]="all",l.strings["sort-separator"]=" ",l.strings["et-al-use-last"]=this.strings["et-al-use-last"],l.strings["et-al-min"]=this.strings["et-al-min"],l.strings["et-al-use-first"]=this.strings["et-al-use-first"],t.Node.name.build.call(l,e,i);var u=new t.Token("institution",t.SINGLETON);u.tokentype=t.SINGLETON,t.Node.institution.build.call(u,e,i);var h=new t.Token("names",t.END);h.tokentype=t.END,t.Node.names.build.call(h,e,i)}else{var p=new t.Token("text",t.SINGLETON);if(p.dateparts=this.dateparts,t.NUMERIC_VARIABLES.indexOf(a)>-1)s=function(e,i){var s;s=!1,s="citation-number"===a?e.registry.registry[i.id].seq.toString():i[a],s&&(s=t.Util.padding(s)),e.output.append(s,this)};else if("citation-label"===a)s=function(t,e){var i=t.getCitationLabel(e);t.output.append(i,this)};else if(t.DATE_VARIABLES.indexOf(a)>-1)s=t.dateAsSortKey,p.variables=this.variables;else if("title"===a){var c="title",f=!1,m=!1,g=!0;s=e.transform.getOutputFunction(this.variables,c,f,m,g)}else s=function(t,e){var i=e[a];t.output.append(i,"empty")};p.execs.push(s),i.push(p)}}else{var d=new t.Token("text",t.SINGLETON);d.postponed_macro=this.postponed_macro,t.expandMacro.call(e,d)}var b=new t.Token("key",t.END);s=function(t){var e=t.output.string(t,t.output.queue);""===e&&(e=void 0),("string"!=typeof e||t.tmp.empty_date)&&(e=void 0,t.tmp.empty_date=!1),t[t.tmp.area].keys.push(e),t.tmp.value=[]},b.execs.push(s),e.build.date_key&&("citation_sort"===e.build.area&&(e[e.build.area].opt.sort_directions.push([-1,1]),s=function(e,i){var s=e.registry.registry[i.id].disambig.year_suffix;s||(s=0);var r=t.Util.padding(""+s);e[e.tmp.area].keys.push(r)},b.execs.push(s)),e.build.date_key=!1),s=function(t){t.tmp["et-al-min"]=void 0,t.tmp["et-al-use-first"]=void 0,t.tmp["et-al-use-last"]=void 0,t.tmp.sort_key_flag=!1},b.execs.push(s),i.push(b)}},t.Node.label={build:function(e,i){if(this.strings.term){this.strings.form||(this.strings.form="long");var s=function(e,i,s){var r=t.evaluateLabel(this,e,i,s);s&&"locator"===this.strings.term&&(e.parallel.StartVariable("label"),e.parallel.AppendToVariable(s.label),s.section_form_override=this.strings.form),e.output.append(r,this),s&&"locator"===this.strings.term&&e.parallel.CloseVariable()};this.execs.push(s)}else{var r=e.build.names_variables.slice(-1)[0];e.build.name_label||(e.build.name_label={});for(var n=0,a=r.length;a>n;n+=1)e.build.name_label[r[n]]||(e.build.name_label[r[n]]={});if(e.build.name_flag)for(var n=0,a=r.length;a>n;n+=1)e.build.name_label[r[n]].after=this;else for(var n=0,a=r.length;a>n;n+=1)e.build.name_label[r[n]].before=this}i.push(this)}},t.Node.layout={build:function(e,i){var s,r,n,a;this.tokentype===t.START&&(s=function(e,i,s){e.opt.development_extensions.apply_citation_wrapper&&e.sys.wrapCitationEntry&&!e.tmp.just_looking&&i.system_id&&"citation"===e.tmp.area&&(cite_entry=new t.Token("group",t.START),cite_entry.decorations=[["@cite","entry"]],e.output.startTag("cite_entry",cite_entry),e.output.current.value().item_id=i.system_id,s&&(e.output.current.value().locator_txt=s.locator_txt,e.output.current.value().suffix_txt=s.suffix_txt))},this.execs.push(s)),this.tokentype!==t.START||e.tmp.cite_affixes[e.build.area]||(s=function(t,e){t.tmp.done_vars=[],!t.tmp.just_looking&&t.registry.registry[e.id].parallel&&t.tmp.done_vars.push("first-reference-note-number"),t.tmp.rendered_name=!1,t.tmp.name_node={}},this.execs.push(s),s=function(t){t.tmp.sort_key_flag=!1},this.execs.push(s),s=function(t){t.tmp.nameset_counter=0},this.execs.push(s),s=function(e,i){var s="empty";e.opt.development_extensions.rtl_support&&["ar","he","fa","ur","yi","ps","syr"].indexOf(i.language)>-1&&(s=new t.Token,s.strings.prefix="‫",s.strings.suffix="‬"),e.output.openLevel(s)},this.execs.push(s),i.push(this),"citation"===e.build.area&&(r=new t.Token("text",t.SINGLETON),s=function(e,i,s){var r;if(s&&s.prefix){r="";var n=s.prefix.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019]/g,"").replace(/\s+$/,"").replace(/^[.\s]+/,"");n.match(t.ENDSWITH_ROMANESQUE_REGEXP)&&(r=" ");var a=!1;t.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(n.slice(-1))>-1&&n.slice(0,1)!=n.slice(0,1).toLowerCase()&&(e.tmp.term_predecessor=!1,a=!0),n=(s.prefix+r).replace(/\s+/g," "),e.output.append(n,this,!1,a)}},r.execs.push(s),i.push(r)));var o;if(this.locale_raw&&(o=new t.Token("dummy",t.START),o.locale=this.locale_raw,o.strings.delimiter=this.strings.delimiter,o.strings.suffix=this.strings.suffix,e.tmp.cite_affixes[e.build.area]||(e.tmp.cite_affixes[e.build.area]={})),this.tokentype===t.START&&(e.build.layout_flag=!0,this.locale_raw||(e[e.tmp.area].opt.topdecor=[this.decorations],e[e.tmp.area+"_sort"].opt.topdecor=[this.decorations],e[e.build.area].opt.layout_prefix=this.strings.prefix,e[e.build.area].opt.layout_suffix=this.strings.suffix,e[e.build.area].opt.layout_delimiter=this.strings.delimiter,e[e.build.area].opt.layout_decorations=this.decorations,e.tmp.cite_affixes[e.build.area]&&(a=new t.Token("else",t.START),t.Node["else"].build.call(a,e,i))),this.locale_raw)){if(e.build.layout_locale_flag)o.name="else-if",t.Attributes["@locale-internal"].call(o,e,this.locale_raw),t.Node["else-if"].build.call(o,e,i);
else{var l=new t.Token("choose",t.START);t.Node.choose.build.call(l,e,i),o.name="if",t.Attributes["@locale-internal"].call(o,e,this.locale_raw),t.Node["if"].build.call(o,e,i)}e.tmp.cite_affixes[e.build.area][o.locale]={},e.tmp.cite_affixes[e.build.area][o.locale].delimiter=this.strings.delimiter,e.tmp.cite_affixes[e.build.area][o.locale].suffix=this.strings.suffix}this.tokentype===t.END&&(this.locale_raw&&(e.build.layout_locale_flag?(o.name="else-if",o.tokentype=t.END,t.Attributes["@locale-internal"].call(o,e,this.locale_raw),t.Node["else-if"].build.call(o,e,i)):(o.name="if",o.tokentype=t.END,t.Attributes["@locale-internal"].call(o,e,this.locale_raw),t.Node["if"].build.call(o,e,i),e.build.layout_locale_flag=!0)),this.locale_raw||(e.tmp.cite_affixes[e.build.area]&&e.build.layout_locale_flag&&(a=new t.Token("else",t.END),t.Node["else"].build.call(a,e,i),a=new t.Token("choose",t.END),t.Node.choose.build.call(a,e,i)),e.build_layout_locale_flag=!0,"citation"===e.build.area&&(n=new t.Token("text",t.SINGLETON),s=function(e,i,s){var r;s&&s.suffix&&(r="",s.suffix.match(t.STARTSWITH_ROMANESQUE_REGEXP)&&(r=" "),e.output.append(r+s.suffix,this))},n.execs.push(s),i.push(n)),s=function(t){"bibliography"===t.tmp.area&&t.bibliography.opt["second-field-align"]&&t.output.endTag(),t.output.closeLevel()},this.execs.push(s),s=function(t,e){t.opt.development_extensions.apply_citation_wrapper&&t.sys.wrapCitationEntry&&!t.tmp.just_looking&&e.system_id&&"citation"===t.tmp.area&&t.output.endTag()},this.execs.push(s),i.push(this),e.build.layout_flag=!1,e.build.layout_locale_flag=!1))}},t.Node.macro={build:function(){}},t.NameOutput=function(t,e,i){this.debug=!1,this.state=t,this.Item=e,this.item=i,this.nameset_base=0,this.etal_spec={},this._first_creator_variable=!1,this._please_chop=!1},t.NameOutput.prototype.init=function(t){this.state.tmp.term_predecessor&&(this.state.tmp.subsequent_author_substitute_ok=!1),this.nameset_offset&&(this.nameset_base=this.nameset_base+this.nameset_offset),this.nameset_offset=0,this.names=t,this.variables=t.variables,this.state.tmp.value=[],this.state.tmp.rendered_name=[],this.state.tmp.label_blob=!1,this.state.tmp.etal_node=!1,this.state.tmp.etal_term=!1;for(var e=0,i=this.variables.length;i>e;e+=1)this.Item[this.variables[e]]&&this.Item[this.variables[e]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[e]]));this["et-al"]=void 0,this["with"]=void 0,this.name=void 0,this.institutionpart={},this.state.tmp.group_context.value()[1]=!0,!this.state.tmp.value.length},t.NameOutput.prototype.reinit=function(e){if(this.state.tmp.can_substitute.value()){this.nameset_offset=0,this.variables=e.variables;var i=this.state.tmp.value.slice();this.state.tmp.value=[];for(var s=0,r=this.variables.length;r>s;s+=1)this.Item[this.variables[s]]&&this.Item[this.variables[s]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[s]]));this.state.tmp.value.length&&this.state.tmp.can_substitute.replace(!1,t.LITERAL),this.state.tmp.value=i}},t.NameOutput.prototype.outputNames=function(){var e,i,s=this.variables;if(this.institution.and&&(this.institution.and.single.blobs&&this.institution.and.single.blobs.length||(this.institution.and.single.blobs=this.name.and.single.blobs),this.institution.and.multiple.blobs&&this.institution.and.multiple.blobs.length||(this.institution.and.multiple.blobs=this.name.and.multiple.blobs)),this.variable_offset={},this.family)for(this.family_decor=t.Util.cloneToken(this.family),this.family_decor.strings.prefix="",this.family_decor.strings.suffix="",e=0,i=this.family.execs.length;i>e;e+=1)this.family.execs[e].call(this.family_decor,this.state,this.Item);else this.family_decor=!1;if(this.given)for(this.given_decor=t.Util.cloneToken(this.given),this.given_decor.strings.prefix="",this.given_decor.strings.suffix="",e=0,i=this.given.execs.length;i>e;e+=1)this.given.execs[e].call(this.given_decor,this.state,this.Item);else this.given_decor=!1;if(this.getEtAlConfig(),this.divideAndTransliterateNames(),this.truncatePersonalNameLists(),this.disambigNames(),this.constrainNames(),"count"===this.name.strings.form)return(this.state.tmp.extension||0!=this.names_count)&&(this.state.output.append(this.names_count,"empty"),this.state.tmp.group_context.value()[2]=!0),void 0;this.setEtAlParameters(),this.setCommonTerm(),this.state.tmp.name_node={},this.state.tmp.name_node.children=[],this.renderAllNames();var r=[];for(e=0,i=s.length;i>e;e+=1){for(var n=s[e],a=[],o=!1,l=0,u=this.institutions[n].length;u>l;l+=1)a.push(this.joinPersonsAndInstitutions([this.persons[n][l],this.institutions[n][l]]));if(this.institutions[n].length){var h=this.nameset_base+this.variable_offset[n];this.freeters[n].length&&(h+=1),o=this.joinInstitutionSets(a,h)}var p=this.joinFreetersAndInstitutionSets([this.freeters[n],o]);if(p&&("_sort"!==this.state.tmp.area.slice(-5)&&(p=this._applyLabels(p,n)),r.push(p)),this.common_term)break}for(this.state.output.openLevel("empty"),this.state.output.current.value().strings.delimiter=this.names.strings.delimiter,e=0,i=r.length;i>e;e+=1)this.state.output.append(r[e],"literal",!0);this.state.output.closeLevel("empty");var c=this.state.output.pop();if(this.state.output.append(c,this.names),this.state.tmp.term_predecessor_name&&(this.state.tmp.term_predecessor=!0),this.state.tmp.name_node.top=this.state.output.current.value(),"authority"!==s[0]){var f=[],m=this.Item[s[0]];if(m)for(var e=0,i=m.length;i>e;e+=1)substring=t.Util.Names.getRawName(m[e]),substring&&f.push(substring);f=f.join(", "),f&&(this.state.tmp.name_node.string=f)}if(this.state.tmp.name_node.string&&!this.state.tmp.first_name_string&&(this.state.tmp.first_name_string=this.state.tmp.name_node.string),"classic"===this.Item.type){var g=[];this.state.tmp.first_name_string&&g.push(this.state.tmp.first_name_string),this.Item.title&&g.push(this.Item.title),g=g.join(", "),g&&this.state.sys.getAbbreviation&&(this.state.transform.loadAbbreviation("default","classic",g),this.state.transform.abbrevs["default"].classic[g]&&(this.state.tmp.done_vars.push("title"),this.state.output.append(this.state.transform.abbrevs["default"].classic[g],"empty",!0),c=this.state.output.pop(),this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.top.blobs.push(c)))}this._collapseAuthor(),this.variables=[]},t.NameOutput.prototype._applyLabels=function(t,e){var i;if(!this.label||!this.label[e])return t;var s=0,r=this.freeters_count[e]+this.institutions_count[e];if(r>1)s=1;else{for(var n=0,a=this.persons[e].length;a>n;n+=1)r+=this.persons_count[e][n];r>1&&(s=1)}return this.label[e].before&&("number"==typeof this.label[e].before.strings.plural&&(s=this.label[e].before.strings.plural),i=this._buildLabel(e,s,"before",e),this.state.output.openLevel("empty"),this.state.output.append(i,this.label[e].before,!0),this.state.output.append(t,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()),this.label[e].after&&("number"==typeof this.label[e].after.strings.plural&&(s=this.label[e].after.strings.plural),i=this._buildLabel(e,s,"after",e),this.state.output.openLevel("empty"),this.state.output.append(t,"literal",!0),this.state.output.append(i,this.label[e].after,!0),this.state.tmp.label_blob=this.state.output.pop(),this.state.output.append(this.state.tmp.label_blob,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()),t},t.NameOutput.prototype._buildLabel=function(e,i,s,r){this.common_term&&(e=this.common_term);var n=!1,a=this.label[r][s];return a&&(n=t.castLabel(this.state,a,e,i,t.TOLERANT)),n},t.NameOutput.prototype._collapseAuthor=function(){var t,e,i;0===this.nameset_base&&this.Item[this.variables[0]]&&!this._first_creator_variable&&(this._first_creator_variable=this.variables[0]),(this.item&&this.item["suppress-author"]&&this._first_creator_variable==this.variables[0]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter.length)&&(this.state.tmp.authorstring_request?(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),this.state.tmp.offset_characters=i,this.state.registry.authorstrings[this.Item.id]=e):this.state.tmp.just_looking||this.state.tmp.suppress_decorations||!(this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter)||(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),e===this.state.tmp.last_primary_names_string?((this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i),this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!0)):(this.state.tmp.last_primary_names_string=e,this.variables.indexOf(this._first_creator_variable)>-1&&this.item&&this.item["suppress-author"]&&"legal_case"!==this.Item.type&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i,this.state.tmp.term_predecessor=!1),this.state.tmp.have_collapsed=!1,this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!1))))},t.NameOutput.prototype.isPerson=function(t){return t.literal||!t.given&&t.family&&t.isInstitution?!1:!0},t.NameOutput.prototype.truncatePersonalNameLists=function(){var t,e,i,s,r,n,a;this.freeters_count={},this.persons_count={},this.institutions_count={};for(t in this.freeters)this.freeters.hasOwnProperty(t)&&(this.freeters_count[t]=this.freeters[t].length,this.freeters[t]=this._truncateNameList(this.freeters,t));for(t in this.persons)if(this.persons.hasOwnProperty(t))for(this.institutions_count[t]=this.institutions[t].length,this._truncateNameList(this.institutions,t),this.persons[t]=this.persons[t].slice(0,this.institutions[t].length),this.persons_count[t]=[],s=0,r=this.persons[t].length;r>s;s+=1)this.persons_count[t][s]=this.persons[t][s].length,this.persons[t][s]=this._truncateNameList(this.persons,t,s);if(n=1!==this.etal_min||1!==this.etal_use_first||this.state.tmp.extension||this.state.tmp.just_looking?!1:t,n||this._please_chop)for(e=0,i=this.variables.length;i>e;e+=1){for(t=this.variables[e],this.freeters[t].length&&(this._please_chop===t?(this.freeters[t]=this.freeters[t].slice(1),this.freeters_count[t]+=-1,this._please_chop=!1):n&&!this._please_chop&&(this.freeters[t]=this.freeters[t].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],this._please_chop=n)),e=0,i=this.persons[t].length;i>e;e+=1)if(this.persons[t][e].length){if(this._please_chop===t){this.persons[t][e]=this.persons[t][e].slice(1),this.persons_count[t][e]+=-1,this._please_chop=!1;break}if(n&&!this._please_chop){this.freeters[t]=this.persons[t][e].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],a=[],this._please_chop=n;break}}this.institutions[t].length&&(this._please_chop===t?(this.institutions[t]=this.institutions[t].slice(1),this.institutions_count[t]+=-1,this._please_chop=!1):n&&!this._please_chop&&(this.institutions[t]=this.institutions[t].slice(0,1),this.institutions_count[t]=1,a=[],this._please_chop=n))}for(e=0,i=this.variables.length;i>e;e+=1)for(this.institutions[t].length&&(this.nameset_offset+=1),e=0,i=this.persons[t].length;i>e;e+=1)this.persons[t][e].length&&(this.nameset_offset+=1)},t.NameOutput.prototype._truncateNameList=function(t,e,i){var s;return s="undefined"==typeof i?t[e]:t[e][i],this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names&&s.length>50&&s.length>this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2&&(s=s.slice(0,this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2)),s},t.NameOutput.prototype.divideAndTransliterateNames=function(){var t,e,i,s,r=this.Item,n=this.variables;for(this.varnames=n.slice(),this.freeters={},this.persons={},this.institutions={},t=0,e=n.length;e>t;t+=1){var a=n[t];this.variable_offset[a]=this.nameset_offset;var o=this._normalizeVariableValue(r,a);if(this.name.strings["suppress-min"]&&o.length>=this.name.strings["suppress-min"]&&(o=[]),this.name.strings["suppress-max"]&&o.length<=this.name.strings["suppress-max"]&&(o=[]),this._getFreeters(a,o),this._getPersonsAndInstitutions(a,o),0===this.name.strings["suppress-min"])for(this.freeters[a]=[],i=0,s=this.persons[a].length;s>i;i+=1)this.persons[a][i]=[];else if(0===this.institution.strings["suppress-min"]){for(this.institutions[a]=[],this.freeters[a]=this.freeters[a].concat(this.persons[a]),i=0,s=this.persons[a].length;s>i;i+=1)for(var l=0,u=this.persons[a][i].length;u>l;l+=1)this.freeters[a].push(this.persons[a][i][l]);this.persons[a]=[]}}},t.NameOutput.prototype._normalizeVariableValue=function(t,e){var i;return i="string"==typeof t[e]?[{literal:t[e]}]:t[e]?t[e].slice():[]},t.NameOutput.prototype._getFreeters=function(t,e){this.freeters[t]=[];for(var i=e.length-1;i>-1&&this.isPerson(e[i]);i+=-1){var s=this._checkNickname(e.pop());s&&this.freeters[t].push(s)}this.freeters[t].reverse(),this.freeters[t].length&&(this.nameset_offset+=1)},t.NameOutput.prototype._getPersonsAndInstitutions=function(t,e){this.persons[t]=[],this.institutions[t]=[];for(var i=[],s=!1,r=!0,n=e.length-1;n>-1;n+=-1)if(this.isPerson(e[n])){var a=this._checkNickname(e[n]);a&&i.push(a)}else s=!0,this.institutions[t].push(e[n]),r||(i.reverse(),this.persons[t].push(i),i=[]),r=!1;s&&(i.reverse(),this.persons[t].push(i),this.persons[t].reverse(),this.institutions[t].reverse())},t.NameOutput.prototype._clearValues=function(t){for(var e=t.length-1;e>-1;e+=-1)t.pop()},t.NameOutput.prototype._checkNickname=function(e){if(["interview","personal_communication"].indexOf(this.Item.type)>-1){var i="";if(i=t.Util.Names.getRawName(e),i&&this.state.sys.getAbbreviation&&(!this.item||!this.item["suppress-author"])){this.state.transform.loadAbbreviation("default","nickname",i);var s=this.state.transform.abbrevs["default"].nickname[i];s&&(e="!here>>>"===s?!1:{family:s,given:""})}}return e},t.NameOutput.prototype.joinPersons=function(t,e,i){var s;return s="undefined"==typeof i?1===this.etal_spec[e].freeters?this._joinEtAl(t,"name"):2===this.etal_spec[e].freeters?this._joinEllipsis(t,"name"):this.state.tmp.sort_key_flag?this._join(t," "):this._joinAnd(t,"name"):1===this.etal_spec[e].persons[i]?this._joinEtAl(t,"name"):2===this.etal_spec[e].persons[i]?this._joinEllipsis(t,"name"):this.state.tmp.sort_key_flag?this._join(t," "):this._joinAnd(t,"name")},t.NameOutput.prototype.joinInstitutionSets=function(t,e){var i;return i=1===this.etal_spec[e].institutions?this._joinEtAl(t,"institution"):2===this.etal_spec[e].institutions?this._joinEllipsis(t,"institution"):this._joinAnd(t,"institution")},t.NameOutput.prototype.joinPersonsAndInstitutions=function(t){return this._join(t,this.name.strings.delimiter)},t.NameOutput.prototype.joinFreetersAndInstitutionSets=function(t){var e=this._join(t,"[never here]",this["with"].single,this["with"].multiple);return e},t.NameOutput.prototype._joinEtAl=function(t,e){var i=this._join(t,this.name.strings.delimiter);return this.state.output.openLevel(this._getToken(e)),this.state.output.current.value().strings.delimiter="",this.state.output.append(i,"literal",!0),t.length>1?this.state.output.append(this["et-al"].multiple,"literal",!0):1===t.length&&this.state.output.append(this["et-al"].single,"literal",!0),this.state.output.closeLevel(),this.state.output.pop()},t.NameOutput.prototype._joinEllipsis=function(t,e){return this._join(t,this.name.strings.delimiter,this.name.ellipsis.single,this.name.ellipsis.multiple,e)},t.NameOutput.prototype._joinAnd=function(t,e){return this._join(t,this[e].strings.delimiter,this[e].and.single,this[e].and.multiple,e)},t.NameOutput.prototype._join=function(t,e,i,s,r){var n,a;if(!t)return!1;for(n=t.length-1;n>-1;n+=-1)t[n]&&0!==t[n].length&&t[n].blobs.length||(t=t.slice(0,n).concat(t.slice(n+1)));if(!t.length)return!1;if(i&&2===t.length)t=[t[0],i,t[1]];else{var o;for(o=s?2:1,n=0,a=t.length-o;a>n;n+=1)t[n].strings.suffix+=e;if(t.length>1){var l=t.pop();s?t.push(s):t.push(i),t.push(l)}}for(this.state.output.openLevel(this._getToken(r)),i&&s&&(this.state.output.current.value().strings.delimiter=""),n=0,a=t.length;a>n;n+=1)this.state.output.append(t[n],!1,!0);return this.state.output.closeLevel(),this.state.output.pop()},t.NameOutput.prototype._getToken=function(e){var i=this[e];if("institution"===e){var s=new t.Token;return s}return i},t.NameOutput.prototype.setCommonTerm=function(){var t=this.variables,e=t.slice();if(e.sort(),this.common_term=e.join(""),!this.common_term)return!1;var i=!1;if(this.label&&this.label[this.variables[0]]&&(this.label[this.variables[0]].before?i=this.state.getTerm(this.common_term,this.label[this.variables[0]].before.strings.form,0):this.label[this.variables[0]].after&&(i=this.state.getTerm(this.common_term,this.label[this.variables[0]].after.strings.form,0))),!this.state.locale[this.state.opt.lang].terms[this.common_term]||!i||this.variables.length<2)return this.common_term=!1,void 0;for(var s=0,r=0,n=this.variables.length-1;n>r;r+=1){var a=this.variables[r],o=this.variables[r+1];if(this.freeters[a].length||this.freeters[o].length){if(this.etal_spec[a].freeters!==this.etal_spec[o].freeters||!this._compareNamesets(this.freeters[a],this.freeters[o]))return this.common_term=!1,void 0;s+=1}for(var l=0,u=this.persons[a].length;u>l;l+=1)if(this.etal_spec[a].persons[l]!==this.etal_spec[o].persons[l]||!this._compareNamesets(this.persons[a][l],this.persons[o][l]))return this.common_term=!1,void 0}},t.NameOutput.prototype._compareNamesets=function(e,i){if(e.length!==i.length)return!1;for(var s=0,r=i.length;r>s;s+=1){i[s];for(var n=0,a=t.NAME_PARTS.length;a>n;n+=1){var o=t.NAME_PARTS[n];if(!e[s]||e[s][o]!=i[s][o])return!1}}return!0},t.NameOutput.prototype.constrainNames=function(){this.names_count=0;for(var t,e=0,i=this.variables.length;i>e;e+=1){var s=this.variables[e];t=this.nameset_base+e,this.freeters[s].length&&(this.state.tmp.names_max.push(this.freeters[s].length,"literal"),this._imposeNameConstraints(this.freeters,this.freeters_count,s,t),this.names_count+=this.freeters[s].length),this.institutions[s].length&&(this.state.tmp.names_max.push(this.institutions[s].length,"literal"),this._imposeNameConstraints(this.institutions,this.institutions_count,s,t),this.persons[s]=this.persons[s].slice(0,this.institutions[s].length),this.names_count+=this.institutions[s].length);for(var r=0,n=this.persons[s].length;n>r;r+=1)this.persons[s][r].length&&(this.state.tmp.names_max.push(this.persons[s][r].length,"literal"),this._imposeNameConstraints(this.persons[s],this.persons_count[s],r,t),this.names_count+=this.persons[s][r].length)}},t.NameOutput.prototype._imposeNameConstraints=function(t,e,i,s){var r=t[i],n=this.state.tmp["et-al-min"];this.state.tmp.suppress_decorations?this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[s]?n=this.state.tmp.disambig_request.names[s]:e[i]>=this.etal_min&&(n=this.etal_use_first):(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[s]>this.etal_use_first?n=e[i]<this.etal_min?e[i]:this.state.tmp.disambig_request.names[s]:e[i]>=this.etal_min&&(n=this.etal_use_first),this.etal_use_last&&n>this.etal_min-2&&(n=this.etal_min-2));var a=this.etal_min>=this.etal_use_first,o=e[i]>n;n>e[i]&&(n=r.length),a&&o&&(t[i]=this.etal_use_last?r.slice(0,n).concat(r.slice(-1)):r.slice(0,n)),this.state.tmp.disambig_settings.names[s]=t[i].length,this.state.disambiguate.padBase(this.state.tmp.disambig_settings)},t.NameOutput.prototype.disambigNames=function(){for(var t,e=0,i=this.variables.length;i>e;e+=1){var s=this.variables[e];if(t=this.nameset_base+e,this.freeters[s].length&&this._runDisambigNames(this.freeters[s],t),this.institutions[s].length){"undefined"==typeof this.state.tmp.disambig_settings.givens[t]&&(this.state.tmp.disambig_settings.givens[t]=[]);for(var r=0,n=this.institutions[s].length;n>r;r+=1)"undefined"==typeof this.state.tmp.disambig_settings.givens[t][r]&&this.state.tmp.disambig_settings.givens[t].push(2)}for(var r=0,n=this.persons[s].length;n>r;r+=1)this.persons[s][r].length&&this._runDisambigNames(this.persons[s][r],t)}},t.NameOutput.prototype._runDisambigNames=function(e,i){var s,r,n,a,o,l,u;for(o=0,l=e.length;l>o;o+=1)if(e[o].given||e[o].family){if(n=this.name.strings["initialize-with"],this.state.registry.namereg.addname(""+this.Item.id,e[o],o),s=this.state.tmp.disambig_settings.givens[i],"undefined"==typeof s)for(var h=0,p=i+1;p>h;h+=1)this.state.tmp.disambig_settings.givens[h]||(this.state.tmp.disambig_settings.givens[h]=[]);if(s=this.state.tmp.disambig_settings.givens[i][o],"undefined"==typeof s&&(r=this.name.strings.form,a=this.state.registry.namereg.evalname(""+this.Item.id,e[o],o,0,r,n),this.state.tmp.disambig_settings.givens[i].push(a)),r=this.name.strings.form,u=this.state.registry.namereg.evalname(""+this.Item.id,e[o],o,0,r,n),this.state.tmp.disambig_request){var c=this.state.tmp.disambig_settings.givens[i][o];1!==c||"by-cite"!==this.state.citation.opt["givenname-disambiguation-rule"]||"undefined"!=typeof this.name.strings["initialize-with"]&&"undefined"!=typeof e[o].given||(c=2),a=c,this.state.opt["disambiguate-add-givenname"]&&e[o].given&&(a=this.state.registry.namereg.evalname(""+this.Item.id,e[o],o,a,this.name.strings.form,this.name.strings["initialize-with"]))}else a=u;!this.state.tmp.just_looking&&this.item&&this.item.position===t.POSITION_FIRST&&(a=u),this.state.tmp.sort_key_flag||(this.state.tmp.disambig_settings.givens[i][o]=a,"string"!=typeof n||"undefined"!=typeof this.name.strings.initialize&&!0!==this.name.strings.initialize||(this.state.tmp.disambig_settings.use_initials=!0))}},t.NameOutput.prototype.getEtAlConfig=function(){var t=this.item;this["et-al"]={},this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].single=this.state.output.pop(),this["et-al"].single.strings.suffix=this.etal_suffix,this["et-al"].single.strings.prefix=this.etal_prefix_single,this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].multiple=this.state.output.pop(),this["et-al"].multiple.strings.suffix=this.etal_suffix,this["et-al"].multiple.strings.prefix=this.etal_prefix_multiple,"undefined"==typeof t&&(t={}),t.position?(this.etal_min=this.name.strings["et-al-subsequent-min"]?this.name.strings["et-al-subsequent-min"]:this.name.strings["et-al-min"],this.etal_use_first=this.name.strings["et-al-subsequent-use-first"]?this.name.strings["et-al-subsequent-use-first"]:this.name.strings["et-al-use-first"]):(this.etal_min=this.state.tmp["et-al-min"]?this.state.tmp["et-al-min"]:this.name.strings["et-al-min"],this.etal_use_first=this.state.tmp["et-al-use-first"]?this.state.tmp["et-al-use-first"]:this.name.strings["et-al-use-first"],this.etal_use_last="boolean"==typeof this.state.tmp["et-al-use-last"]?this.state.tmp["et-al-use-last"]:this.name.strings["et-al-use-last"]),this.state.tmp["et-al-min"]||(this.state.tmp["et-al-min"]=this.etal_min)},t.NameOutput.prototype.setEtAlParameters=function(){var t,e,i,s;for(t=0,e=this.variables.length;e>t;t+=1){var r=this.variables[t];for("undefined"==typeof this.etal_spec[r]&&(this.etal_spec[r]={freeters:0,institutions:0,persons:[]}),this.etal_spec[this.nameset_base+t]=this.etal_spec[r],this.freeters[r].length&&this._setEtAlParameter("freeters",r),i=0,s=this.persons[r].length;s>i;i+=1)"undefined"==typeof this.etal_spec[r][i]&&(this.etal_spec[r].persons[i]=0),this._setEtAlParameter("persons",r,i);this.institutions[r].length&&this._setEtAlParameter("institutions",r)}},t.NameOutput.prototype._setEtAlParameter=function(t,e,i){var s,r;"persons"===t?(s=this.persons[e][i],r=this.persons_count[e][i]):(s=this[t][e],r=this[t+"_count"][e]),s.length<r&&!this.state.tmp.sort_key_flag?this.etal_use_last?"persons"===t?this.etal_spec[e].persons[i]=2:this.etal_spec[e][t]=2:"persons"===t?this.etal_spec[e].persons[i]=1:this.etal_spec[e][t]=1:"persons"===t?this.etal_spec[e].persons[i]=0:this.etal_spec[e][t]=0},t.NameOutput.prototype.renderAllNames=function(){for(var t,e=0,i=this.variables.length;i>e;e+=1){var s=this.variables[e];t=this.nameset_base+e,this.freeters[s].length&&(this.freeters[s]=this._renderPersonalNames(this.freeters[s],t));for(var r=0,n=this.institutions[s].length;n>r;r+=1)this.persons[s][r]=this._renderPersonalNames(this.persons[s][r],t,r)}this.renderInstitutionNames()},t.NameOutput.prototype.renderInstitutionNames=function(){for(var t=0,e=this.variables.length;e>t;t+=1)for(var i=this.variables[t],s=0,r=this.institutions[i].length;r>s;s+=1){var n,a,o,l,u,s,r,h,p=this.institutions[i][s];if(h=this.state.tmp.extension?["sort"]:p.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},h)for(var c=["primary","secondary","tertiary"],f=0,m=c.length;m>f&&!(h.length-1<f);f+=1)h[f]&&(slot[c[f]]="locale-"+h[f]);else slot.primary="locale-translat";"bibliography"===this.state.tmp.area||"citation"===this.state.tmp.area&&"note"===this.state.opt.xclass&&this.item&&!this.item.position||(slot.secondary=!1,slot.tertiary=!1);var g;this.setRenderedName(p),g=this.getName(p,slot.primary,!0);var d=g.name,b=g.usedOrig;switch(d&&(d=this.fixupInstitution(d,i,s)),secondary=!1,slot.secondary&&(g=this.getName(p,slot.secondary,!1,b),secondary=g.name,b=g.usedOrig,secondary&&(secondary=this.fixupInstitution(secondary,i,s))),tertiary=!1,slot.tertiary&&(g=this.getName(p,slot.tertiary,!1,b),tertiary=g.name,tertiary&&(tertiary=this.fixupInstitution(tertiary,i,s))),this.institution.strings["institution-parts"]){case"short":d["short"].length?(l=this._getShortStyle(),n=[this._renderOneInstitutionPart(d["short"],l)]):(u=this._getLongStyle(d,i,s),n=[this._renderOneInstitutionPart(d["long"],u)]);break;case"short-long":u=this._getLongStyle(d,i,s),l=this._getShortStyle(),a=this._renderOneInstitutionPart(d["short"],l),o=this._composeOneInstitutionPart([d,secondary,tertiary],slot,u),n=[a,o];break;case"long-short":u=this._getLongStyle(d,i,s),l=this._getShortStyle(),a=this._renderOneInstitutionPart(d["short"],l),o=this._composeOneInstitutionPart([d,secondary,tertiary],slot,u,!0),n=[o,a];break;default:u=this._getLongStyle(d,i,s),n=[this._composeOneInstitutionPart([d,secondary,tertiary],slot,u)]}this.institutions[i][s]=this._join(n,"")}},t.NameOutput.prototype._composeOneInstitutionPart=function(e,i,s){var r=!1,n=!1,a=!1;e[0]&&(r=this._renderOneInstitutionPart(e[0]["long"],s)),e[1]&&(n=this._renderOneInstitutionPart(e[1]["long"],s)),e[2]&&(a=this._renderOneInstitutionPart(e[2]["long"],s));var o;return n||a?(this.state.output.openLevel("empty"),this.state.output.append(r),secondary_tok=t.Util.cloneToken(s),i.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[i.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[i.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(n,secondary_tok),tertiary_tok=t.Util.cloneToken(s),i.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[i.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[i.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(a,tertiary_tok),this.state.output.closeLevel(),o=this.state.output.pop()):o=r,o},t.NameOutput.prototype._renderOneInstitutionPart=function(e,i){for(var s=0,r=e.length;r>s;s+=1)if(e[s]){var n=e[s];if(this.state.tmp.strip_periods)n=n.replace(/\./g,"");else for(var a=0,o=i.decorations.length;o>a;a+=1)if("@strip-periods"===i.decorations[a][0]&&"true"===i.decorations[a][1]){n=n.replace(/\./g,"");break}this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,t.LITERAL),"!here>>>"===n?e[s]=!1:(this.state.output.append(n,i,!0),e[s]=this.state.output.pop())}return"undefined"==typeof this.institution.strings["part-separator"]&&(this.institution.strings["part-separator"]=this.name.strings.delimiter),this._join(e,this.institution.strings["part-separator"])},t.NameOutput.prototype._renderPersonalNames=function(e,i,s){var r=!1;if(e.length){for(var n=[],a=0,o=e.length;o>a;a+=1){var r,l,u=e[a];if(l=this.state.tmp.extension?["sort"]:u.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},l)for(var h=["primary","secondary","tertiary"],p=0,c=h.length;c>p&&!(l.length-1<p);p+=1)slot[h[p]]="locale-"+l[p];else slot.primary="locale-translat";(this.state.tmp.sort_key_flag||"bibliography"!==this.state.tmp.area&&("citation"!==this.state.tmp.area||"note"!==this.state.opt.xclass||!this.item||this.item.position))&&(slot.secondary=!1,slot.tertiary=!1),this.setRenderedName(u);var f=this.getName(u,slot.primary,!0),m=this._renderOnePersonalName(f.name,i,a,s);secondary=!1,slot.secondary&&(f=this.getName(u,slot.secondary,!1,f.usedOrig),f.name&&(secondary=this._renderOnePersonalName(f.name,i,a,s))),tertiary=!1,slot.tertiary&&(f=this.getName(u,slot.tertiary,!1,f.usedOrig),f.name&&(tertiary=this._renderOnePersonalName(f.name,i,a,s)));var g;secondary||tertiary?(this.state.output.openLevel("empty"),this.state.output.append(m),secondary_tok=new t.Token,slot.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(secondary,secondary_tok),tertiary_tok=new t.Token,slot.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(tertiary,tertiary_tok),this.state.output.closeLevel(),g=this.state.output.pop()):g=m,n.push(g)}r=this.joinPersons(n,i,s)}return r},t.NameOutput.prototype._isRomanesque=function(e){var i=2;if(e.family.replace('"',"","g").match(t.ROMANESQUE_REGEXP)||(i=0),!i&&e.given&&e.given.match(t.STARTSWITH_ROMANESQUE_REGEXP)&&(i=1),2==i){if(e.multi&&e.multi.main)var s=e.multi.main.slice(0,2);else this.Item.language&&(s=this.Item.language.slice(0,2));["ja","zh"].indexOf(s)>-1&&(i=1)}return i},t.NameOutput.prototype._renderOnePersonalName=function(e,i,s,r){var n=e,a=this._droppingParticle(n,i,r),o=this._familyName(n),l=this._nonDroppingParticle(n),u=this._givenName(n,i,s),h=this._nameSuffix(n);this._isShort(i,s)&&!n["full-form-always"]&&(a=!1,u=!1,h=!1);var p=this.name.strings["sort-separator"];p||(p="");var c;c=n["comma-suffix"]?", ":" ";var f,m,g,d,b=this._isRomanesque(n),_=l&&"-"===l.blobs.slice(-1);return 0===b?f=this._join([l,o,u],""):1===b||n["static-ordering"]?f=this._join([l,o,u]," "):n["reverse-ordering"]?f=this._join([u,l,o]," "):this.state.tmp.sort_key_flag?"never"===this.state.opt["demote-non-dropping-particle"]?(g=this._join([l,o,a]," "),m=this._join([g,u]," "),f=this._join([m,h]," ")):(d=this._join([u,a,l]," "),m=this._join([o,d]," "),f=this._join([m,h]," ")):"all"===this.name.strings["name-as-sort-order"]||"first"===this.name.strings["name-as-sort-order"]&&0===s&&(0===r||"undefined"==typeof r)?(["Lord","Lady"].indexOf(n.given)>-1&&(p=", "),["always","display-and-sort"].indexOf(this.state.opt["demote-non-dropping-particle"])>-1&&!_?(d=this._join([u,a],n["comma-dropping-particle"]+" "),d=this._join([d,l]," "),d&&this.given&&(d.strings.prefix=this.given.strings.prefix,d.strings.suffix=this.given.strings.suffix),o&&this.family&&(o.strings.prefix=this.family.strings.prefix,o.strings.suffix=this.family.strings.suffix),m=this._join([o,d],p),f=this._join([m,h],p)):("bibliography"===this.state.tmp.area&&!this.state.tmp.term_predecessor&&l&&(_||(l.blobs=t.Output.Formatters["capitalize-first"](this.state,l.blobs))),g=_?this._join([l,o],""):this._join([l,o]," "),g&&this.family&&(g.strings.prefix=this.family.strings.prefix,g.strings.suffix=this.family.strings.suffix),d=this._join([u,a],n["comma-dropping-particle"]+" "),d&&this.given&&(d.strings.prefix=this.given.strings.prefix,d.strings.suffix=this.given.strings.suffix),m=this._join([g,d],p),f=this._join([m,h],p))):(n["dropping-particle"]&&n.family&&!n["non-dropping-particle"]&&["'","ʼ","’"].indexOf(n["dropping-particle"].slice(-1))>-1&&(o=this._join([a,o],""),a=!1),this.state.tmp.term_predecessor||u||"bibliography"!==this.state.tmp.area||(!a&&l?_||(l.blobs=t.Output.Formatters["capitalize-first"](this.state,l.blobs)):a&&(a.blobs=t.Output.Formatters["capitalize-first"](this.state,a.blobs))),_?(d=this._join([l,o],""),d=this._join([a,d]," ")):d=this._join([a,l,o]," "),d=this._join([d,h],c),d&&this.family&&(d.strings.prefix=this.family.strings.prefix,d.strings.suffix=this.family.strings.suffix),u&&this.given&&(u.strings.prefix=this.given.strings.prefix,u.strings.suffix=this.given.strings.suffix),d.strings.prefix&&(n["comma-dropping-particle"]=""),f=this._join([u,d],n["comma-dropping-particle"]+" ")),this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,t.LITERAL),this.state.tmp.term_predecessor=!0,this.state.tmp.name_node.children.push(f),f
},t.NameOutput.prototype._isShort=function(t,e){return 0===this.state.tmp.disambig_settings.givens[t][e]?!0:!1},t.NameOutput.prototype._normalizeNameInput=function(t){var e={literal:t.literal,family:t.family,isInstitution:t.isInstitution,given:t.given,suffix:t.suffix,"comma-suffix":t["comma-suffix"],"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],"static-ordering":t["static-ordering"],"reverse-ordering":t["reverse-ordering"],"full-form-always":t["full-form-always"],"parse-names":t["parse-names"],"comma-dropping-particle":"",block_initialize:t.block_initialize,multi:t.multi};return this._parseName(e),e},t.NameOutput.prototype._stripPeriods=function(t,e){var i=this[t+"_decor"];if(e)if(this.state.tmp.strip_periods)e=e.replace(/\./g,"");else if(i)for(var s=0,r=i.decorations.length;r>s;s+=1)if("@strip-periods"===i.decorations[s][0]&&"true"===i.decorations[s][1]){e=e.replace(/\./g,"");break}return e},t.NameOutput.prototype._nonDroppingParticle=function(t){var e=t["non-dropping-particle"];e&&this.state.tmp.sort_key_flag&&(e=e.replace(/[\'\u2019]/,""));var i=this._stripPeriods("family",e);return this.state.output.append(i,this.family_decor,!0)?this.state.output.pop():!1},t.NameOutput.prototype._droppingParticle=function(t,e,i){var s=t["dropping-particle"];s&&this.state.tmp.sort_key_flag&&(s=s.replace(/[\'\u2019]/,""));var r=this._stripPeriods("given",s);if(t["dropping-particle"]&&t["dropping-particle"].match(/^et.?al[^a-z]$/))this.name.strings["et-al-use-last"]?"undefined"==typeof i?this.etal_spec[e].freeters=2:this.etal_spec[e].persons=2:"undefined"==typeof i?this.etal_spec[e].freeters=1:this.etal_spec[e].persons=1,t["comma-dropping-particle"]="";else if(this.state.output.append(r,this.given_decor,!0))return this.state.output.pop();return!1},t.NameOutput.prototype._familyName=function(t){var e=this._stripPeriods("family",t.family);return this.state.output.append(e,this.family_decor,!0)?this.state.output.pop():!1},t.NameOutput.prototype._givenName=function(e,i,s){if(this.name.strings.initialize===!1)e.family&&e.given&&this.name.strings.initialize===!1&&(e.given=t.Util.Names.initializeWith(this.state,e.given,this.name.strings["initialize-with"],!0)),e.given=t.Util.Names.unInitialize(this.state,e.given);else if(e.family&&1===this.state.tmp.disambig_settings.givens[i][s]&&!e.block_initialize){var r=this.name.strings["initialize-with"];e.given=t.Util.Names.initializeWith(this.state,e.given,r)}else e.given=t.Util.Names.unInitialize(this.state,e.given);var n=this._stripPeriods("given",e.given);return this.state.output.append(n,this.given_decor,!0)?this.state.output.pop():!1},t.NameOutput.prototype._nameSuffix=function(e){var i=e.suffix;return"string"==typeof this.name.strings["initialize-with"]&&(i=t.Util.Names.initializeWith(this.state,e.suffix,this.name.strings["initialize-with"],!0)),i=this._stripPeriods("family",i),this.state.output.append(i,"empty",!0)?this.state.output.pop():!1},t.NameOutput.prototype._getLongStyle=function(e){var i;return i=e["short"].length?this.institutionpart["long-with-short"]?this.institutionpart["long-with-short"]:this.institutionpart["long"]:this.institutionpart["long"],i||(i=new t.Token),i},t.NameOutput.prototype._getShortStyle=function(){var e;return e=this.institutionpart["short"]?this.institutionpart["short"]:new t.Token},t.NameOutput.prototype._parseName=function(t){var e,i;if(!t["parse-names"]&&"undefined"!=typeof t["parse-names"])return t;t.family&&!t.given&&t.isInstitution&&(t.literal=t.family,t.family=void 0,t.isInstitution=void 0);var s;if(t.family&&'"'===t.family.slice(0,1)&&'"'===t.family.slice(-1)||!t["parse-names"]&&"undefined"!=typeof t["parse-names"]?(t.family=t.family.slice(1,-1),s=!0,t["parse-names"]=0):s=!1,!t["non-dropping-particle"]&&t.family&&!s&&t.given&&(e=t.family.match(/^((?:[\'\u2019a-z][ \'\u2019a-z]*[-\s\'\u2019]+|[ABDVL][^ ][-\s]+[a-z]*\s*|[ABDVL][^ ][^ ][-\s]+[a-z]*\s*))/),e&&(t.family=t.family.slice(e[1].length),t["non-dropping-particle"]=e[1].replace(/\s+$/,"").replace("'","’"))),!t.suffix&&t.given&&(e=t.given.match(/(\s*,!*\s*)/))){i=t.given.indexOf(e[1]);var r=t.given.slice(i+e[1].length),n=t.given.slice(i,i+e[1].length).replace(/\s*/g,"");r.length<=3?(2===n.length&&(t["comma-suffix"]=!0),t.suffix=r):!t["dropping-particle"]&&t.given&&(t["dropping-particle"]=r,t["comma-dropping-particle"]=","),t.given=t.given.slice(0,i)}!t["dropping-particle"]&&t.given&&(e=t.given.match(/(\s+)([a-z][ \'\u2019a-z]*)$/),e&&(t.given=t.given.slice(0,-1*(e[1].length+e[2].length)),t["dropping-particle"]=e[2]))},t.NameOutput.prototype.getName=function(t,e,s,r){if(r&&"locale-orig"===e)return{name:!1,usedOrig:r};t.family||(t.family=""),t.given||(t.given="");var n={};n["static-ordering"]=this.getStaticOrder(t);var a=!0;if("locale-orig"!==e&&(a=!1,t.multi)){var o=this.state.opt[e];for(i=0,ilen=o.length;ilen>i;i+=1)if(l=o[i],t.multi._key[l]){a=!0,t=t.multi._key[l],n=this.getNameParams(l),n.transliterated=!0;break}}if(!a){var l=!1;t.multi&&t.multi.main?l=t.multi.main:this.Item.language&&(l=this.Item.language),l&&(n=this.getNameParams(l))}if(!s&&!a)return{name:!1,usedOrig:r};t.family||(t.family=""),t.given||(t.given=""),t={family:t.family,given:t.given,"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],suffix:t.suffix,"static-ordering":n["static-ordering"],"reverse-ordering":n["reverse-ordering"],"full-form-always":n["full-form-always"],"parse-names":t["parse-names"],"comma-suffix":t["comma-suffix"],"comma-dropping-particle":t["comma-dropping-particle"],transliterated:n.transliterated,block_initialize:n["block-initialize"],literal:t.literal,isInstitution:t.isInstitution,multi:t.multi},!t.literal&&!t.given&&t.family&&t.isInstitution&&(t.literal=t.family),t.literal&&(delete t.family,delete t.given),t=this._normalizeNameInput(t);var u;return u=r?r:!a,{name:t,usedOrig:u}},t.NameOutput.prototype.getNameParams=function(e){var i={},s=t.localeResolve(this.Item.language,this.state.opt["default-locale"][0]),r=this.state.locale[s.best]?s.best:this.state.opt["default-locale"][0],n=this.state.locale[r].opts["name-as-sort-order"],a=this.state.locale[r].opts["name-as-reverse-order"],o=this.state.locale[r].opts["name-never-short"],l=e.split("-")[0];return n&&n[l]&&(i["static-ordering"]=!0,i["reverse-ordering"]=!1),a&&a[l]&&(i["reverse-ordering"]=!0,i["static-ordering"]=!1),o&&o[l]&&(i["full-form-always"]=!0),i["static-ordering"]&&(i["block-initialize"]=!0),i},t.NameOutput.prototype.setRenderedName=function(e){if("bibliography"===this.state.tmp.area){for(var i="",s=0,r=t.NAME_PARTS.length;r>s;s+=1)e[t.NAME_PARTS[s]]&&(i+=e[t.NAME_PARTS[s]]);this.state.tmp.rendered_name.push(i)}},t.NameOutput.prototype.fixupInstitution=function(t,e,i){t=this._splitInstitution(t,e,i),this.institution.strings["reverse-order"]&&t["long"].reverse();var s=t["long"],r=s.slice();if(this.state.sys.getAbbreviation)for(var n=this.Item.jurisdiction,a=0,o=s.length;o>a;a+=1)n=this.state.transform.loadAbbreviation(n,"institution-part",s[a]),this.state.transform.abbrevs[n]["institution-part"][s[a]]&&(r[a]=this.state.transform.abbrevs[n]["institution-part"][s[a]]);return t["short"]=r,t},t.NameOutput.prototype.getStaticOrder=function(e,i){var s=!1;return!i&&e["static-ordering"]?s=!0:0===this._isRomanesque(e)?s=!0:(!e.multi||!e.multi.main)&&this.Item.language&&["vi","hu"].indexOf(this.Item.language)>-1?s=!0:e.multi&&e.multi.main&&["vi","hu"].indexOf(e.multi.main.slice(0,2))>-1?s=!0:this.state.opt["auto-vietnamese-names"]&&t.VIETNAMESE_NAMES.exec(e.family+" "+e.given)&&t.VIETNAMESE_SPECIALS.exec(e.family+e.given)&&(s=!0),s},t.NameOutput.prototype._splitInstitution=function(t,e,i){var s={},r=t.literal.replace(/\s*\|\s*/g,"|");if(r=r.split("|"),"short"===this.institution.strings.form&&this.state.sys.getAbbreviation)for(var n=this.Item.jurisdiction,a=r.length;a>0;a+=-1){var o=r.slice(0,a).join("|");if(n=this.state.transform.loadAbbreviation(n,"institution-entire",o),this.state.transform.abbrevs[n]["institution-entire"][o]){var l=this.state.transform.abbrevs[n]["institution-entire"][o];l=this.state.transform.quashCheck(l);var u=l.split(/>>[0-9]{4}>>/),h=l.match(/>>([0-9]{4})>>/);if(l=u.pop(),u.length>0&&this.Item["original-date"]&&this.Item["original-date"].year)for(var p=h.length-1;p>0&&!(parseInt(this.Item["original-date"].year,10)>=parseInt(h[p],10));p+=-1)l=u.pop();l=l.replace(/\s*\|\s*/g,"|"),r=[l]}}return r.reverse(),s["long"]=this._trimInstitution(r,e,i),s},t.NameOutput.prototype._trimInstitution=function(t,e){var i=!1,s=!1,r=!1,n=t.slice();return this.institution&&("undefined"!=typeof this.institution.strings["use-first"]&&(i=this.institution.strings["use-first"]),"undefined"!=typeof this.institution.strings["stop-last"]&&(n=n.slice(0,this.institution.strings["stop-last"]),t=t.slice(0,this.institution.strings["stop-last"])),"undefined"!=typeof this.institution.strings["use-last"]&&(s=this.institution.strings["use-last"])),!1===i&&(0===this.persons[e].length&&(i=this.institution.strings["substitute-use-first"]),i||(i=0)),!1===s&&(s=i?0:t.length),i>t.length-s&&(i=t.length-s),r&&(s=0),t=t.slice(0,i),n=n.slice(i),s&&(s>n.length&&(s=n.length),s&&(t=t.concat(n.slice(n.length-s)))),t},t.PublisherOutput=function(t,e){this.state=t,this.group_tok=e,this.varlist=[]},t.PublisherOutput.prototype.render=function(){this.clearVars(),this.composeAndBlob(),this.composeElements(),this.composePublishers(),this.joinPublishers()},t.PublisherOutput.prototype.composeAndBlob=function(){this.and_blob={};var e=!1;"text"===this.group_tok.strings.and?e=this.state.getTerm("and"):"symbol"===this.group_tok.strings.and&&(e="&");var i=new t.Token;i.strings.suffix=" ",i.strings.prefix=" ",this.state.output.append(e,i,!0);var s=this.state.output.pop();i.strings.prefix=this.group_tok.strings["subgroup-delimiter"],this.state.output.append(e,i,!0);var r=this.state.output.pop();this.and_blob.single=!1,this.and_blob.multiple=!1,e&&("always"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?this.and_blob.single=r:"never"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?(this.and_blob.single=s,this.and_blob.multiple=s):(this.and_blob.single=s,this.and_blob.multiple=r))},t.PublisherOutput.prototype.composeElements=function(){for(var t=0,e=2;e>t;t+=1)for(var i=["publisher","publisher-place"][t],s=0,r=this["publisher-list"].length;r>s;s+=1){var n=this[i+"-list"][s],a=this[i+"-token"];this.state.output.append(n,a,!0),this[i+"-list"][s]=this.state.output.pop()}},t.PublisherOutput.prototype.composePublishers=function(){for(var t,e=0,i=this["publisher-list"].length;i>e;e+=1)t=[this[this.varlist[0]+"-list"][e],this[this.varlist[1]+"-list"][e]],this["publisher-list"][e]=this._join(t,this.group_tok.strings.delimiter)},t.PublisherOutput.prototype.joinPublishers=function(){var t=this["publisher-list"];this.name_delimiter;var e=this._join(t,this.group_tok.strings["subgroup-delimiter"],this.and_blob.single,this.and_blob.multiple,this.group_tok);this.state.output.append(e,"literal")},t.PublisherOutput.prototype._join=t.NameOutput.prototype._join,t.PublisherOutput.prototype._getToken=t.NameOutput.prototype._getToken,t.PublisherOutput.prototype.clearVars=function(){this.state.tmp["publisher-list"]=!1,this.state.tmp["publisher-place-list"]=!1,this.state.tmp["publisher-group-token"]=!1,this.state.tmp["publisher-token"]=!1,this.state.tmp["publisher-place-token"]=!1},t.evaluateLabel=function(e,i,s,r){var n;"locator"===e.strings.term?(r&&r.label&&(n="sub verbo"===r.label?"sub-verbo":r.label),n||(n="page")):n=e.strings.term;var a=e.strings.plural;return r&&"number"==typeof r.force_pluralism?a=r.force_pluralism:"number"!=typeof a&&("locator"===e.strings.term?r&&r.locator&&(i.opt.development_extensions.locator_parsing_for_plurals?(i.tmp.shadow_numbers.locator||i.processNumber(!1,r,"locator",s.type),a=i.tmp.shadow_numbers.locator.plural):a=t.evaluateStringPluralism(r.locator)):["page","page-first"].indexOf(e.variables[0])>-1?(i.processNumber(!1,s,n,s.type),a=i.tmp.shadow_numbers[n].plural,n=i.tmp.shadow_numbers[n].label):(i.tmp.shadow_numbers[n]||i.processNumber(!1,s,n,s.type),a=i.tmp.shadow_numbers[n].plural),e.decorations&&i.opt.development_extensions.csl_reverse_lookup_support&&(e.decorations.reverse(),e.decorations.push(["@showid","true",e.cslid]),e.decorations.reverse())),t.castLabel(i,e,n,a,t.TOLERANT)},t.evaluateStringPluralism=function(t){if(t){var e=t.match(/(?:[0-9],\s*[0-9]|\s+and\s+|&|([0-9]+)\s*[\-\u2013]\s*([0-9]+))/);if(e&&(!e[1]||parseInt(e[1],10)<parseInt(e[2],10)))return 1}return 0},t.castLabel=function(t,e,i,s,r){var n=e.strings.form;t.tmp.group_context.value()[5]&&(n=t.tmp.group_context.value()[5]);var a=t.getTerm(i,n,s,!1,r);if(t.tmp.strip_periods)a=a.replace(/\./g,"");else for(var o=0,l=e.decorations.length;l>o;o+=1)if("@strip-periods"===e.decorations[o][0]&&"true"===e.decorations[o][1]){a=a.replace(/\./g,"");break}return a},t.Node.name={build:function(e,i){var s;[t.SINGLETON,t.START].indexOf(this.tokentype)>-1&&(e.fixOpt(this,"name-delimiter","name_delimiter"),e.fixOpt(this,"name-form","form"),e.fixOpt(this,"and","and"),e.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),e.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),e.fixOpt(this,"initialize-with","initialize-with"),e.fixOpt(this,"initialize","initialize"),e.fixOpt(this,"name-as-sort-order","name-as-sort-order"),e.fixOpt(this,"sort-separator","sort-separator"),e.fixOpt(this,"and","and"),e.fixOpt(this,"et-al-min","et-al-min"),e.fixOpt(this,"et-al-use-first","et-al-use-first"),e.fixOpt(this,"et-al-use-last","et-al-use-last"),e.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),e.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),this.strings["et-al-subsequent-min"]&&this.strings["et-al-subsequent-min"]!==this.strings["et-al-min"]&&(e.opt.update_mode=t.POSITION),this.strings["et-al-subsequent-use-first"]&&this.strings["et-al-subsequent-use-first"]!==this.strings["et-al-use-first"]&&(e.opt.update_mode=t.POSITION),this.strings.delimiter="undefined"==typeof this.strings.name_delimiter?", ":this.strings.name_delimiter,this.strings["et-al-use-last"]&&(this.ellipsis_term="…",this.ellipsis_prefix_single=" ",this.ellipsis_prefix_multiple=this.strings.delimiter,this.ellipsis_suffix=" "),s=function(e){e.tmp.etal_term="et-al",e.tmp.name_delimiter=this.strings.delimiter,e.tmp["delimiter-precedes-et-al"]=this.strings["delimiter-precedes-et-al"],"text"===this.strings.and?this.and_term=e.getTerm("and","long",0):"symbol"===this.strings.and&&(this.and_term=e.opt.development_extensions.expect_and_symbol_form?e.getTerm("and","symbol",0):"&"),e.tmp.and_term=this.and_term,t.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" ",e.build.name_delimiter=this.strings.delimiter):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]?this.and_prefix_multiple&&(this.and_prefix_multiple=" "):"after-inverted-name"===this.strings["delimiter-precedes-last"]&&(this.and_prefix_single&&(this.and_prefix_single=this.strings.delimiter),this.and_prefix_multiple&&(this.and_prefix_multiple=" ")),this.and={},this.strings.and?(e.output.append(this.and_term,"empty",!0),this.and.single=e.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,e.output.append(this.and_term,"empty",!0),this.and.multiple=e.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):this.strings.delimiter&&(this.and.single=new t.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new t.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),this.ellipsis={},this.strings["et-al-use-last"]&&(this.ellipsis.single=new t.Blob(this.ellipsis_term),this.ellipsis.single.strings.prefix=this.ellipsis_prefix_single,this.ellipsis.single.strings.suffix=this.ellipsis_suffix,this.ellipsis.multiple=new t.Blob(this.ellipsis_term),this.ellipsis.multiple.strings.prefix=this.ellipsis_prefix_multiple,this.ellipsis.multiple.strings.suffix=this.ellipsis_suffix),"undefined"==typeof e.tmp["et-al-min"]&&(e.tmp["et-al-min"]=this.strings["et-al-min"]),"undefined"==typeof e.tmp["et-al-use-first"]&&(e.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"undefined"==typeof e.tmp["et-al-use-last"]&&(e.tmp["et-al-use-last"]=this.strings["et-al-use-last"]),e.nameOutput.name=this},e.build.name_flag=!0,this.execs.push(s)),i.push(this)}},t.Node["name-part"]={build:function(t){t.build[this.strings.name]=this}},t.Node.names={build:function(e,i){var s;if((this.tokentype===t.START||this.tokentype===t.SINGLETON)&&(t.Util.substituteStart.call(this,e,i),e.build.substitute_level.push(1),e.fixOpt(this,"names-delimiter","delimiter")),this.tokentype===t.SINGLETON){e.build.names_variables.push(this.variables);for(var r=0,n=this.variables.length;n>r;r+=1)e.build.name_label[this.variables[r]]=e.build.name_label[e.build.names_variables.slice(0)[0]];s=function(t){t.nameOutput.reinit(this)},this.execs.push(s)}if(this.tokentype===t.START&&(e.build.names_flag=!0,e.build.names_level+=1,1===e.build.names_level&&(e.build.names_variables=[],e.build.name_label={}),e.build.names_variables.push(this.variables),s=function(t){t.tmp.can_substitute.push(!0),t.parallel.StartVariable("names",this.variables[0]),t.nameOutput.init(this)},this.execs.push(s)),this.tokentype===t.END){for(var r=0,n=3;n>r;r+=1){var a=["family","given","et-al"][r];this[a]=e.build[a],1===e.build.names_level&&(e.build[a]=void 0)}this.label=e.build.name_label,1===e.build.names_level&&(e.build.name_label={}),e.build.names_level+=-1,e.build.names_variables.pop();var o="with",l="",u="";t.STARTSWITH_ROMANESQUE_REGEXP.test(o)&&(l=" ",u=" "),this["with"]={},this["with"].single=new t.Blob(o),this["with"].single.strings.suffix=u,this["with"].multiple=new t.Blob(o),this["with"].multiple.strings.suffix=u,"always"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=this.strings.delimiter):"contextual"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=this.strings.delimiter):"after-inverted-name"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=l):(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=l),s=function(e){this.etal_style=e.tmp.etal_node?e.tmp.etal_node:"empty",this.etal_term=e.getTerm(e.tmp.etal_term,"long",0),t.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)?(this.etal_prefix_single=" ",this.etal_prefix_multiple=e.tmp.name_delimiter,"always"===e.tmp["delimiter-precedes-et-al"]?this.etal_prefix_single=e.tmp.name_delimiter:"never"===e.tmp["delimiter-precedes-et-al"]?this.etal_prefix_multiple=" ":"after-inverted-name"===e.tmp["delimiter-precedes-et-al"]&&(this.etal_prefix_single=e.tmp.name_delimiter,this.etal_prefix_multiple=" "),this.etal_suffix=""):(this.etal_prefix_single="",this.etal_prefix_multiple="",this.etal_suffix="");for(var i=0,s=3;s>i;i+=1){var r=["family","given"][i];e.nameOutput[r]=this[r]}e.nameOutput["with"]=this["with"],e.nameOutput.label=this.label,e.nameOutput.etal_style=this.etal_style,e.nameOutput.etal_term=this.etal_term,e.nameOutput.etal_prefix_single=this.etal_prefix_single,e.nameOutput.etal_prefix_multiple=this.etal_prefix_multiple,e.nameOutput.etal_suffix=this.etal_suffix,e.nameOutput.outputNames(),e.tmp["et-al-use-first"]=void 0,e.tmp["et-al-min"]=void 0,e.tmp["et-al-use-last"]=void 0},this.execs.push(s),s=function(e){e.tmp.can_substitute.pop()||e.tmp.can_substitute.replace(!1,t.LITERAL),e.parallel.CloseVariable("names"),1===e.tmp.can_substitute.mystack.length&&(e.tmp.can_block_substitute=!1)},this.execs.push(s),e.build.name_flag=!1}i.push(this),(this.tokentype===t.END||this.tokentype===t.SINGLETON)&&(e.build.substitute_level.pop(),t.Util.substituteEnd.call(this,e,i))}},t.Node.number={build:function(e,i){var s;t.Util.substituteStart.call(this,e,i),"roman"===this.strings.form?this.formatter=e.fun.romanizer:"ordinal"===this.strings.form?this.formatter=e.fun.ordinalizer:"long-ordinal"===this.strings.form&&(this.formatter=e.fun.long_ordinalizer),"undefined"==typeof this.successor_prefix&&(this.successor_prefix=e[e.build.area].opt.layout_delimiter),"undefined"==typeof this.splice_prefix&&(this.splice_prefix=e[e.build.area].opt.layout_delimiter),s=function(e,i,s){var r,n,a,o;if(0!==this.variables.length){if("undefined"==typeof s)var s={};var l,u;if(l=this.variables[0],"locator"!==l||!e.tmp.just_looking){e.parallel.StartVariable(this.variables[0]),"locator"===this.variables[0]?e.parallel.AppendToVariable(i.section):e.parallel.AppendToVariable(i[this.variables[0]]);var h=new RegExp("(?:&|, | and |"+e.getTerm("page-range-delimiter")+")");"collection-number"===l&&"legal_case"===i.type&&(e.tmp.renders_collection_number=!0);var p=i[this.variables[0]],c="long";if(this.strings.label_form_override&&(c=this.strings.label_form_override),"locator"===l&&s.locator)if(s.locator=s.locator.replace(/([^\\])\s*-\s*/,"$1"+e.getTerm("page-range-delimiter")),u=s.locator.match(t.STATUTE_SUBDIV_GROUPED_REGEX)){for(o=s.locator.split(t.STATUTE_SUBDIV_PLAIN_REGEX),r=0,n=o.length;n>r;r+=1)o[r]=e.fun.page_mangler(o[r]);for(a=[o[0]],!this.strings.label_form_override&&e.tmp.group_context.value()[5]&&(c=e.tmp.group_context.value()[5]),r=1,n=o.length;n>r;r+=1){var f=0;o[r].match(h)&&(f=1);var m=t.STATUTE_SUBDIV_STRINGS[u[r-1].replace(/^\s*/,"")],g=c;s.section_label_count>r&&s.section_form_override&&(g=s.section_form_override),a.push(e.getTerm(m,g,f)),a.push(o[r].replace(/^\s*/,""))}p=a.join(" "),p=p.replace(/\\/,"","g"),e.output.append(p,this)}else p=e.fun.page_mangler(s.locator),p=p.replace(/\\/,"","g"),e.output.append(p,this);else{var d=this;(!e.tmp.shadow_numbers[l]||e.tmp.shadow_numbers[l].values.length&&e.tmp.shadow_numbers[l].values[0][2]===!1)&&("locator"===l?e.processNumber(d,s,l,i.type):e.processNumber(d,i,l,i.type));var b,_=e.tmp.shadow_numbers[l].values,y="",v="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(i.type)>-1&&"collection-number"===l&&(v="year"),("number"===l&&["bill","gazette","legislation","treaty"].indexOf(i.type)>-1||e.opt[v+"-range-format"])&&!this.strings.prefix&&!this.strings.suffix&&!this.strings.form)for(r=0,n=_.length;n>r;r+=1)y+=_[r][1];if(y&&!y.match(/^[\-.\u20130-9]+$/)){if("number"===l&&["bill","gazette","legislation","treaty"].indexOf(i.type)>-1){var x=y.split(/\s/)[0];if(x&&(a=[],u=y.match(t.STATUTE_SUBDIV_GROUPED_REGEX))){for(o=y.split(t.STATUTE_SUBDIV_PLAIN_REGEX),r=1,n=o.length;n>r;r+=1)a.push(e.getTerm(t.STATUTE_SUBDIV_STRINGS[u[r-1].replace(/^\s+/,"")],this.strings.label_form_override)),a.push(o[r].replace(/^\s+/,""));y=a.join(" ")}}e.output.append(y,this)}else if(_.length){for(e.output.openLevel("empty"),r=0,n=_.length;n>r;r+=1)b=new t[_[r][0]](_[r][1],_[r][2],i.id),r>0&&(b.strings.prefix=b.strings.prefix.replace(/^\s*/,"")),r<_.length-1&&(b.strings.suffix=b.strings.suffix.replace(/\s*$/,"")),"undefined"==typeof b.gender&&(b.gender=e.locale[e.opt.lang]["noun-genders"][l]),e.output.append(b,"literal",!1,!1,!0);e.output.closeLevel("empty")}}"locator"===l&&e.tmp.done_vars.push("locator"),e.parallel.CloseVariable("number")}}},this.execs.push(s),i.push(this),t.Util.substituteEnd.call(this,e,i)}},t.Node.sort={build:function(e,i){if(i=e[e.build.root+"_sort"].tokens,this.tokentype===t.START){"citation"===e.build.area&&(e.parallel.use_parallels=!1,e.opt.sort_citations=!0),e.build.area=e.build.root+"_sort",e.build.extension="_sort";var s=function(e,i){if(e.opt.has_layout_locale){for(var s,r=t.localeResolve(i.language,e.opt["default-locale"][0]),n=e[e.tmp.area.slice(0,-5)].opt.sort_locales,a=0,o=n.length;o>a&&(s=n[a][r.bare],s||(s=n[a][r.best]),!s);a+=1);s||(s=e.opt["default-locale"][0]),e.tmp.lang_sort_hold=e.opt.lang,e.opt.lang=s}};this.execs.push(s)}if(this.tokentype===t.END){e.build.area=e.build.root,e.build.extension="";var s=function(t){t.opt.has_layout_locale&&(t.opt.lang=t.tmp.lang_sort_hold,delete t.tmp.lang_sort_hold)};this.execs.push(s)}i.push(this)}},t.Node.substitute={build:function(e,i){var s;this.tokentype===t.START&&(s=function(e){e.tmp.can_block_substitute=!0,e.tmp.value.length&&e.tmp.can_substitute.replace(!1,t.LITERAL)},this.execs.push(s)),i.push(this)}},t.Node.text={build:function(e,i){var s,r,n,a,o,l,u,h,p,c,f,m,g,d,b;if(this.postponed_macro)return t.expandMacro.call(e,this);if(t.Util.substituteStart.call(this,e,i),this.variables_real||(this.variables_real=[]),this.variables||(this.variables=[]),r="long",n=0,this.strings.form&&(r=this.strings.form),this.strings.plural&&(n=this.strings.plural),"citation-number"===this.variables_real[0]||"year-suffix"===this.variables_real[0]||"citation-label"===this.variables_real[0])"citation-number"===this.variables_real[0]?("citation"===e.build.root&&(e.opt.update_mode=t.NUMERIC),"bibliography"===e.build.root&&(e.opt.bib_mode=t.NUMERIC),"bibliography_sort"===e.build.area&&(e.opt.citation_number_sort_used=!0),"citation-number"===e[e.tmp.area].opt.collapse&&(this.range_prefix=e.getTerm("citation-range-delimiter")),this.successor_prefix=e[e.build.area].opt.layout_delimiter,this.splice_prefix=e[e.build.area].opt.layout_delimiter,s=function(e,i,s){if(a=""+i.id,!e.tmp.just_looking){if(s&&s["author-only"]){e.tmp.element_trace.replace("do-not-suppress-me");var r=e.getTerm("reference","long","singular");"undefined"==typeof r&&(r="reference"),m=t.Output.Formatters["capitalize-first"](e,r),e.output.append(m+" "),e.tmp.last_element_trace=!0}s&&s["suppress-author"]&&(e.tmp.last_element_trace&&e.tmp.element_trace.replace("suppress-me"),e.tmp.last_element_trace=!1),o=e.registry.registry[a].seq,e.opt.citation_number_slug?e.output.append(e.opt.citation_number_slug,this):(l=new t.NumericBlob(o,this,i.id),e.output.append(l,"literal"))}},this.execs.push(s)):"year-suffix"===this.variables_real[0]?(e.opt.has_year_suffix=!0,"year-suffix-ranged"===e[e.tmp.area].opt.collapse&&(this.range_prefix=e.getTerm("citation-range-delimiter")),this.successor_prefix=e[e.build.area].opt.layout_delimiter,e[e.tmp.area].opt["year-suffix-delimiter"]&&(this.successor_prefix=e[e.build.area].opt["year-suffix-delimiter"]),s=function(e,i){if(e.registry.registry[i.id]&&e.registry.registry[i.id].disambig.year_suffix!==!1&&!e.tmp.just_looking){for(o=parseInt(e.registry.registry[i.id].disambig.year_suffix,10),l=new t.NumericBlob(o,this,i.id),u=new t.Util.Suffixator(t.SUFFIX_CHARS),l.setFormatter(u),e.output.append(l,"literal"),h=!1,g=e.tmp.group_context.mystack.length,d=0;g>d;d+=1)if(b=e.tmp.group_context.mystack[d],!b[2]&&(b[1]||!b[1]&&!b[0])){h=!0;break}p=e[e.tmp.area].opt["year-suffix-delimiter"],h&&p&&!e.tmp.sort_key_flag&&(e.tmp.splice_delimiter=e[e.tmp.area].opt["year-suffix-delimiter"])}},this.execs.push(s)):"citation-label"===this.variables_real[0]&&(e.opt.has_year_suffix=!0,s=function(t,e){c=e["citation-label"],c||(c=t.getCitationLabel(e)),t.tmp.just_looking||(f="",t.registry.registry[e.id]&&t.registry.registry[e.id].disambig.year_suffix!==!1&&(o=parseInt(t.registry.registry[e.id].disambig.year_suffix,10),f=t.fun.suffixator.format(o)),c+=f),t.output.append(c,this)},this.execs.push(s));else if(this.strings.term)s=function(e,i){var s=e.opt.gender[i.type],a=this.strings.term;a=e.getTerm(a,r,n,s,!1,"accessed"===a);var o;if(""!==a&&(b=e.tmp.group_context.value(),b[0]=!0,e.tmp.group_context.replace(b)),o=e.tmp.term_predecessor||"in-text"===e.opt["class"]&&"citation"===e.tmp.area?a:t.Output.Formatters["capitalize-first"](e,a),e.tmp.strip_periods)o=o.replace(/\./g,"");else for(var l=0,u=this.decorations.length;u>l;l+=1)if("@strip-periods"===this.decorations[l][0]&&"true"===this.decorations[l][1]){o=o.replace(/\./g,"");break}e.output.append(o,this)},this.execs.push(s),e.build.term=!1,e.build.form=!1,e.build.plural=!1;else if(this.variables_real.length){if(s=function(t,e){var i=this.variables[0];"title"!==i||"short"!==r&&!e["title-short"]||(i="shortTitle"),t.parallel.StartVariable(i),t.parallel.AppendToVariable(e[i],i)},this.execs.push(s),t.MULTI_FIELDS.indexOf(this.variables_real[0])>-1){var _=this.variables[0],y=!1,v=!1,x=!1;"short"===r?"container-title"===this.variables_real[0]?v="journalAbbreviation":"title"===this.variables_real[0]&&(v="shortTitle"):_=!1,e.build.extension?x=!0:(x=!0,y=!0),s=e.transform.getOutputFunction(this.variables,_,y,v,x)}else s=t.CITE_FIELDS.indexOf(this.variables_real[0])>-1?function(t,e,i){if(i&&i[this.variables[0]]){var s=""+i[this.variables[0]];s=s.replace(/([^\\])--*/g,"$1"+t.getTerm("page-range-delimiter")),s=s.replace(/\\-/g,"-"),t.output.append(s,this,!1,!1,!0),"locator-revision"===this.variables[0]&&t.tmp.done_vars.push("locator-revision")}}:"page-first"===this.variables_real[0]?function(t,e){var i;i=t.getVariable(e,"page-first",r),i&&(i=i.replace("\\",""),t.output.append(i,this,!1,!1,!0))}:"page"===this.variables_real[0]?function(t,e){var i=t.getVariable(e,"page",r);i&&(i=""+i,i=i.replace(/([^\\])--*/g,"$1"+t.getTerm("page-range-delimiter")),i=i.replace(/\\-/g,"-"),i=t.fun.page_mangler(i),t.output.append(i,this,!1,!1,!0))}:"volume"===this.variables_real[0]?function(t,e){if(this.variables[0]){var i=t.getVariable(e,this.variables[0],r);i&&t.output.append(i,this)}}:["URL","DOI"].indexOf(this.variables_real[0])>-1?function(t,e){var i;this.variables[0]&&(i=t.getVariable(e,this.variables[0],r),i&&(t.opt.development_extensions.wrap_url_and_doi?this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]||(this.decorations=[["@"+this.variables[0],"true"]].concat(this.decorations)):this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]&&(this.decorations=this.decorations.slice(1)),t.output.append(i,this,!1,!1,!0)))}:"section"===this.variables_real[0]?function(t,e){var i;i=t.getVariable(e,this.variables[0],r),i&&t.output.append(i,this)}:"hereinafter"===this.variables_real[0]?function(t,e){var i=t.transform.abbrevs["default"].hereinafter[e.id];i&&(t.output.append(i,this),t.tmp.group_context.value()[2]=!0)}:function(t,e){var i;this.variables[0]&&(i=t.getVariable(e,this.variables[0],r),i&&(i=""+i,i=i.replace("\\","","g"),t.output.append(i,this)))};this.execs.push(s),s=function(t){t.parallel.CloseVariable("text")},this.execs.push(s)}else this.strings.value&&(s=function(t){var e;e=t.tmp.group_context.value(),e[0]=!0,t.tmp.group_context.replace(e),t.output.append(this.strings.value,this)},this.execs.push(s));i.push(this),t.Util.substituteEnd.call(this,e,i)}},t.Attributes={},t.Attributes["@genre"]=function(t,e){e=e.replace("-"," ");var i=function(t){return e===t.genre?!0:!1};this.tests.push(i)},t.Attributes["@disambiguate"]=function(t,e){if("true"===e){t.opt.has_disambiguate=!0;var i=function(){return t.tmp.disambiguate_maxMax+=1,t.tmp.disambig_settings.disambiguate&&t.tmp.disambiguate_count<t.tmp.disambig_settings.disambiguate?(t.tmp.disambiguate_count+=1,!0):!1};this.tests.push(i)}},t.Attributes["@is-numeric"]=function(e,i){for(var s=i.split(/\s+/),r=function(i){return function(s,r){var n=s;if(["locator","locator-revision"].indexOf(i)>-1&&(n=r),"undefined"==typeof n)return!1;if(t.NUMERIC_VARIABLES.indexOf(i)>-1){if(e.tmp.shadow_numbers[i]||e.processNumber(!1,n,i,s.type),n[i]&&e.tmp.shadow_numbers[i].numeric)return!0}else if(["title","locator-revision","version"].indexOf(i)>-1&&n[i]&&n[i].slice(-1)===""+parseInt(n[i].slice(-1),10))return!0;return!1}},n=0;n<s.length;n+=1)this.tests.push(r(s[n]))},t.Attributes["@is-uncertain-date"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){return e[t]&&e[t].circa?!0:!1
}},r=0,n=i.length;n>r;r+=1)this.tests.push(s(i[r]))},t.Attributes["@locator"]=function(t,e){var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var s=function(t){return function(e,i){var s;return s="undefined"!=typeof i&&i.label?"sub verbo"===i.label?"sub-verbo":i.label:"page",t===s?!0:!1}},r=0,n=i.length;n>r;r+=1)this.tests.push(s(i[r]))},t.Attributes["@position"]=function(e,i){var s;e.opt.update_mode=t.POSITION,e.parallel.use_parallels=!0;for(var r=i.split(/\s+/),n=function(t){return function(i,s){if("bibliography"===e.tmp.area)return!1;if(s&&"undefined"==typeof s.position&&(s.position=0),s&&"number"==typeof s.position){if(0===s.position&&0===t)return!0;if(t>0&&s.position>=t)return!0}else if(0===t)return!0;return!1}},a=0,o=r.length;o>a;a+=1){var s=r[a];"first"===s?s=t.POSITION_FIRST:"subsequent"===s?s=t.POSITION_SUBSEQUENT:"ibid"===s?s=t.POSITION_IBID:"ibid-with-locator"===s&&(s=t.POSITION_IBID_WITH_LOCATOR),"near-note"===s?this.tests.push(function(e,i){return i&&i.position>=t.POSITION_SUBSEQUENT&&i["near-note"]?!0:!1}):this.tests.push(n(s))}},t.Attributes["@type"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e.type===t;return i?!0:!1}},r=[],n=0,a=i.length;a>n;n+=1)r.push(s(i[n]));this.tests.push(t.fun.match.any(this,t,r))},t.Attributes["@variable"]=function(e,i){var s;if(this.variables=i.split(/\s+/),this.variables_real=this.variables.slice(),"label"===this.name&&this.variables[0])this.strings.term=this.variables[0];else if(["names","date","text","number"].indexOf(this.name)>-1)s=function(t,e,i){variables=this.variables_real.slice();for(var s=this.variables.length-1;s>-1;s+=-1)this.variables.pop();for(len=variables.length,pos=0;len>pos;pos+=1)-1!==t.tmp.done_vars.indexOf(variables[pos])||i&&"legal_case"===e.type&&i["suppress-author"]&&"title"===variables[pos]||this.variables.push(variables[pos]),t.tmp.can_block_substitute&&t.tmp.done_vars.push(variables[pos])},this.execs.push(s),s=function(e,i,s){for(output=!1,len=this.variables.length,pos=0;len>pos;pos+=1){if(variable=this.variables[pos],"authority"===variable&&"string"==typeof i[variable]&&"names"===this.name&&(i[variable]=[{family:i[variable],isInstitution:!0}]),"short"!==this.strings.form||i[variable]||("title"===variable?variable="shortTitle":"container-title"===variable&&(variable="journalAbbreviation")),"year-suffix"===variable){output=!0;break}if(t.DATE_VARIABLES.indexOf(variable)>-1){if(e.opt.development_extensions.locator_date_and_revision&&"locator-date"===variable){output=!0;break}if(i[variable]){for(var r in i[variable])if((-1!==this.dateparts.indexOf(r)||"literal"===r)&&i[variable][r]){output=!0;break}if(output)break}}else{if("locator"===variable){s&&s.locator&&(output=!0);break}if("locator-revision"===variable){s&&s["locator-revision"]&&(output=!0);break}if(["citation-number","citation-label"].indexOf(variable)>-1){output=!0;break}if("first-reference-note-number"===variable){s&&s["first-reference-note-number"]&&(output=!0);break}if("hereinafter"===variable){e.transform.abbrevs["default"].hereinafter[i.id]&&e.sys.getAbbreviation&&i.id&&(output=!0);break}if("object"==typeof i[variable]){i[variable].length;break}if("string"==typeof i[variable]&&i[variable]){output=!0;break}if("number"==typeof i[variable]){output=!0;break}}if(output)break}flag=e.tmp.group_context.value(),output?(("citation-number"!==variable||"bibliography"!==e.tmp.area)&&(e.tmp.cite_renders_content=!0),flag[2]=!0,e.tmp.group_context.replace(flag),e.tmp.can_substitute.value()&&"bibliography"===e.tmp.area&&"string"==typeof i[variable]&&e.tmp.rendered_name.push(i[variable]),e.tmp.can_substitute.replace(!1,t.LITERAL)):flag[1]=!0},this.execs.push(s);else if(["if","else-if","condition"].indexOf(this.name)>-1)for(var r=function(t){return function(i,s){var r=i;if(s&&["locator","locator-revision","first-reference-note-number","locator-date"].indexOf(t)>-1&&(r=s),"hereinafter"===t&&e.sys.getAbbreviation&&r.id){if(e.transform.abbrevs["default"].hereinafter[r.id])return!0}else if(r[t]){if("number"==typeof r[t]||"string"==typeof r[t])return!0;if("object"==typeof r[t])for(key in r[t])if(r[t][key])return!0}return!1}},n=0,a=this.variables.length;a>n;n+=1)this.tests.push(r(this.variables[n]))},t.Attributes["@page"]=function(t,e){var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var s=function(e){return function(i){var s;return t.processNumber(!1,i,"page",i.type),s=t.tmp.shadow_numbers.page.label?"sub verbo"===t.tmp.shadow_numbers.page.label?"sub-verbo":t.tmp.shadow_numbers.page.label:"page",e===s?!0:!1}},r=0,n=i.length;n>r;r+=1)this.tests.push(s(i[r]))},t.Attributes["@jurisdiction"]=function(t,e){for(var i=e.split(/\s+/),s=0,r=i.length;r>s;s+=1)i[s]=i[s].split(";");for(var n=function(t){return function(e){if(!e.jurisdiction)return!1;for(var i=e.jurisdiction.split(";"),s=0,r=i.length;r>s;s+=1)i[s]=i[s].split(";");for(s=t.length;s>0;s+=-1){var n=t.slice(0,s).join(";"),a=i.slice(0,s).join(";");if(n!==a)return!1}return!0}},s=0,r=i.length;r>s;s+=1){var a=i[s].slice();this.tests.push(n(a))}},t.Attributes["@context"]=function(t,e){var i=function(){var i=t.tmp.area.slice(0,e.length);return i===e?!0:!1};this.tests.push(i)},t.Attributes["@has-year-only"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e[t];return!i||i.month||i.season?!1:!0}},r=0,n=i.length;n>r;r+=1)this.tests.push(s(i[r]))},t.Attributes["@has-to-month-or-season"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e[t];return!i||!i.month&&!i.season||i.day?!1:!0}},r=0,n=i.length;n>r;r+=1)this.tests.push(s(i[r]))},t.Attributes["@has-day"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e[t];return i&&i.day?!0:!1}},r=0,n=i.length;n>r;r+=1)this.tests.push(s(i[r]))},t.Attributes["@subjurisdictions"]=function(t,e){var i=parseInt(e,10),s=function(t){var e=0;return t.jurisdiction&&(e=t.jurisdiction.split(";").length),e&&(e+=-1),e>=i?!0:!1};this.tests.push(s)},t.Attributes["@is-plural"]=function(t,e){var i=function(t){var i=t[e];if(i&&i.length){for(var s=0,r=0,n=!1,a=0,o=i.length;o>a;a+=1)i[a].isInstitution&&(i[a].literal||i[a].family&&!i[a].given)?(r+=1,n=!1):(s+=1,n=!0);if(s>1)return!0;if(r>1)return!0;if(r&&n)return!0}return!1};this.tests.push(i)},t.Attributes["@locale"]=function(e,i){var s,r,n,a,o,l,u=e.opt["default-locale"][0];if("layout"===this.name){if(this.locale_raw=i,this.tokentype===t.START){var h=i.split(/\s+/),p={},c=t.localeResolve(h[0],u);c.generic?p[c.generic]=c.best:p[c.best]=c.best;for(var o=1,l=h.length;l>o;o+=1){var f=t.localeResolve(h[o],u);f.generic?p[f.generic]=c.best:p[f.best]=c.best}e[e.build.area].opt.sort_locales.push(p)}e.opt.has_layout_locale=!0}else{a=i.split(/\s+/);var m=[];for(o=0,l=a.length;l>o;o+=1)n=a[o],r=t.localeResolve(n,u),2===a[o].length&&m.push(r.bare),e.localeConfigure(r,!0),a[o]=r;var g=a.slice(),d=function(e,i,r){return function(n){var a;s=[],a=!1;var u,h=!1;for(u=n.language?n.language:i,h=t.localeResolve(u,i),o=0,l=e.length;l>o;o+=1)if(h.best===e[o].best){a=!0;break}return!a&&r.indexOf(h.bare)>-1&&(a=!0),a}};this.tests.push(d(g,u,m))}},t.Attributes["@locale-internal"]=function(e,i){var s,r,n,a,o,l;for(a=i.split(/\s+/),this.locale_bares=[],o=0,l=a.length;l>o;o+=1)n=a[o],r=t.localeResolve(n,e.opt["default-locale"][0]),2===a[o].length&&this.locale_bares.push(r.bare),e.localeConfigure(r),a[o]=r;this.locale_default=e.opt["default-locale"][0],this.locale=a[0].best,this.locale_list=a.slice();var u=function(i){return function(r){var a;s=[],a=!1;var u=!1;if(r.language&&(n=r.language,u=t.localeResolve(n,e.opt["default-locale"][0]),u.best===e.opt["default-locale"][0]&&(u=!1)),u){for(o=0,l=i.locale_list.length;l>o;o+=1)if(u.best===i.locale_list[o].best){e.opt.lang=i.locale,e.tmp.last_cite_locale=i.locale,e.output.openLevel("empty"),e.output.current.value().new_locale=i.locale,a=!0;break}!a&&i.locale_bares.indexOf(u.bare)>-1&&(e.opt.lang=i.locale,e.tmp.last_cite_locale=i.locale,e.output.openLevel("empty"),e.output.current.value().new_locale=i.locale,a=!0)}return a}},h=this;this.tests.push(u(h))},t.Attributes["@is-parallel"]=function(t,e){for(var i=e.split(" "),s=0,r=i.length;r>s;s+=1)"true"===i[s]?i[s]=!0:"false"===i[s]&&(i[s]=!1);this.strings.set_parallel_condition=i},t.Attributes["@gender"]=function(t,e){this.gender=e},t.Attributes["@cslid"]=function(t,e){this.cslid=parseInt(e,10)},t.Attributes["@label-form"]=function(t,e){this.strings.label_form_override=e},t.Attributes["@part-separator"]=function(t,e){this.strings["part-separator"]=e},t.Attributes["@leading-noise-words"]=function(t,e){this["leading-noise-words"]=e},t.Attributes["@name-never-short"]=function(t,e){this["name-never-short"]=e},t.Attributes["@class"]=function(t,e){t.opt["class"]=e},t.Attributes["@version"]=function(t,e){t.opt.version=e},t.Attributes["@value"]=function(t,e){this.strings.value=e},t.Attributes["@name"]=function(t,e){this.strings.name=e},t.Attributes["@form"]=function(t,e){this.strings.form=e},t.Attributes["@date-parts"]=function(t,e){this.strings["date-parts"]=e},t.Attributes["@range-delimiter"]=function(t,e){this.strings["range-delimiter"]=e},t.Attributes["@macro"]=function(t,e){this.postponed_macro=e},t.Attributes["@term"]=function(t,e){this.strings.term="sub verbo"===e?"sub-verbo":e},t.Attributes["@xmlns"]=function(){},t.Attributes["@lang"]=function(t,e){e&&(t.build.lang=e)},t.Attributes["@lingo"]=function(){},t.Attributes["@macro-has-date"]=function(){this["macro-has-date"]=!0},t.Attributes["@suffix"]=function(t,e){this.strings.suffix=e},t.Attributes["@prefix"]=function(t,e){this.strings.prefix=e},t.Attributes["@delimiter"]=function(t,e){"name"==this.name?this.strings.name_delimiter=e:this.strings.delimiter=e},t.Attributes["@match"]=function(t,e){this.match=e},t.Attributes["@names-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),this.strings["et-al-min"]=i},t.Attributes["@names-use-first"]=function(t,e){this.strings["et-al-use-first"]=parseInt(e,10)},t.Attributes["@names-use-last"]=function(t,e){this.strings["et-al-use-last"]="true"===e?!0:!1},t.Attributes["@sort"]=function(e,i){"descending"===i&&(this.strings.sort_direction=t.DESCENDING)},t.Attributes["@plural"]=function(t,e){"always"===e||"true"===e?this.strings.plural=1:"never"===e||"false"===e?this.strings.plural=0:"contextual"===e&&(this.strings.plural=!1)},t.Attributes["@number"]=function(t,e){var i,s=e.replace("sub verbo","sub-verbo");s=s.split(/\s+/),["if","else-if"].indexOf(this.name)>-1&&(i=function(t,e){var i,r=[];t.processNumber(!1,e,"number",e.type),i=t.tmp.shadow_numbers.number.label?"sub verbo"===t.tmp.shadow_numbers.number.label?"sub-verbo":t.tmp.shadow_numbers.number.label:"number";for(var n=0,a=s.length;a>n;n+=1)s[n]===i?r.push(!0):r.push(!1);return r},this.tests.push(i))},t.Attributes["@has-publisher-and-publisher-place"]=function(){this.strings["has-publisher-and-publisher-place"]=!0},t.Attributes["@publisher-delimiter-precedes-last"]=function(t,e){this.strings["publisher-delimiter-precedes-last"]=e},t.Attributes["@publisher-delimiter"]=function(t,e){this.strings["publisher-delimiter"]=e},t.Attributes["@publisher-and"]=function(t,e){this.strings["publisher-and"]=e},t.Attributes["@newdate"]=function(){},t.Attributes["@givenname-disambiguation-rule"]=function(e,i){t.GIVENNAME_DISAMBIGUATION_RULES.indexOf(i)>-1&&(e.citation.opt["givenname-disambiguation-rule"]=i)},t.Attributes["@collapse"]=function(t,e){e&&(t[this.name].opt.collapse=e)},t.Attributes["@cite-group-delimiter"]=function(t,e){e&&(t[t.tmp.area].opt.cite_group_delimiter=e)},t.Attributes["@names-delimiter"]=function(t,e){t.setOpt(this,"names-delimiter",e)},t.Attributes["@name-form"]=function(t,e){t.setOpt(this,"name-form",e)},t.Attributes["@subgroup-delimiter"]=function(t,e){this.strings["subgroup-delimiter"]=e},t.Attributes["@subgroup-delimiter-precedes-last"]=function(t,e){this.strings["subgroup-delimiter-precedes-last"]=e},t.Attributes["@name-delimiter"]=function(t,e){t.setOpt(this,"name-delimiter",e)},t.Attributes["@et-al-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-min",i)},t.Attributes["@et-al-use-first"]=function(t,e){t.setOpt(this,"et-al-use-first",parseInt(e,10))},t.Attributes["@et-al-use-last"]=function(t,e){"true"===e?t.setOpt(this,"et-al-use-last",!0):t.setOpt(this,"et-al-use-last",!1)},t.Attributes["@et-al-subsequent-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-subsequent-min",i)},t.Attributes["@et-al-subsequent-use-first"]=function(t,e){t.setOpt(this,"et-al-subsequent-use-first",parseInt(e,10))},t.Attributes["@suppress-min"]=function(t,e){this.strings["suppress-min"]=parseInt(e,10)},t.Attributes["@suppress-max"]=function(t,e){this.strings["suppress-max"]=parseInt(e,10)},t.Attributes["@and"]=function(t,e){t.setOpt(this,"and",e)},t.Attributes["@delimiter-precedes-last"]=function(t,e){t.setOpt(this,"delimiter-precedes-last",e)},t.Attributes["@delimiter-precedes-et-al"]=function(t,e){t.setOpt(this,"delimiter-precedes-et-al",e)},t.Attributes["@initialize-with"]=function(t,e){t.setOpt(this,"initialize-with",e)},t.Attributes["@initialize"]=function(t,e){"false"===e&&t.setOpt(this,"initialize",!1)},t.Attributes["@name-as-reverse-order"]=function(t,e){this["name-as-reverse-order"]=e},t.Attributes["@name-as-sort-order"]=function(t,e){"style-options"===this.name?this["name-as-sort-order"]=e:t.setOpt(this,"name-as-sort-order",e)},t.Attributes["@sort-separator"]=function(t,e){t.setOpt(this,"sort-separator",e)},t.Attributes["@year-suffix-delimiter"]=function(t,e){t[this.name].opt["year-suffix-delimiter"]=e},t.Attributes["@after-collapse-delimiter"]=function(t,e){t[this.name].opt["after-collapse-delimiter"]=e},t.Attributes["@subsequent-author-substitute"]=function(t,e){t[this.name].opt["subsequent-author-substitute"]=e},t.Attributes["@subsequent-author-substitute-rule"]=function(t,e){t[this.name].opt["subsequent-author-substitute-rule"]=e},t.Attributes["@disambiguate-add-names"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-names"]=!0)},t.Attributes["@disambiguate-add-givenname"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-givenname"]=!0)},t.Attributes["@disambiguate-add-year-suffix"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-year-suffix"]=!0)},t.Attributes["@second-field-align"]=function(t,e){("flush"===e||"margin"===e)&&(t[this.name].opt["second-field-align"]=e)},t.Attributes["@hanging-indent"]=function(t,e){"true"===e&&(t[this.name].opt.hangingindent=2)},t.Attributes["@line-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["line-spacing"]=parseFloat(e,10))},t.Attributes["@entry-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["entry-spacing"]=parseFloat(e,10))},t.Attributes["@near-note-distance"]=function(t,e){t[this.name].opt["near-note-distance"]=parseInt(e,10)},t.Attributes["@text-case"]=function(t,e){var i=function(t,i){"normal"===e?this.text_case_normal=!0:(this.strings["text-case"]=e,"title"===e&&(t.opt["default-locale"][0].slice(0,2),i.jurisdiction&&(this.strings["text-case"]="passthrough")))};this.execs.push(i)},t.Attributes["@page-range-format"]=function(t,e){t.opt["page-range-format"]=e},t.Attributes["@year-range-format"]=function(t,e){t.opt["year-range-format"]=e},t.Attributes["@default-locale"]=function(t,e){var i,s,r,n,a;if(n=e.match(/-x-(sort|translit|translat)-/g))for(r=0,s=n.length;s>r;r+=1)n[r]=n[r].replace(/^-x-/,"").replace(/-$/,"");for(i=e.split(/-x-(?:sort|translit|translat)-/),a=[i[0]],r=1,s=i.length;s>r;r+=1)a.push(n[r-1]),a.push(i[r]);for(i=a.slice(),s=i.length,r=1;s>r;r+=2)t.opt["locale-"+i[r]].push(i[r+1].replace(/^\s*/g,"").replace(/\s*$/g,""));t.opt["default-locale"]=i.length?i.slice(0,1):["en"]},t.Attributes["@default-locale-sort"]=function(t,e){t.opt["default-locale-sort"]=e},t.Attributes["@demote-non-dropping-particle"]=function(t,e){t.opt["demote-non-dropping-particle"]=e},t.Attributes["@initialize-with-hyphen"]=function(t,e){"false"===e&&(t.opt["initialize-with-hyphen"]=!1)},t.Attributes["@institution-parts"]=function(t,e){this.strings["institution-parts"]=e},t.Attributes["@if-short"]=function(t,e){"true"===e&&(this.strings["if-short"]=!0)},t.Attributes["@substitute-use-first"]=function(t,e){this.strings["substitute-use-first"]=parseInt(e,10)},t.Attributes["@use-first"]=function(t,e){this.strings["use-first"]=parseInt(e,10)},t.Attributes["@stop-last"]=function(t,e){this.strings["stop-last"]=-1*parseInt(e,10)},t.Attributes["@oops"]=function(t,e){this.strings.oops=e},t.Attributes["@use-last"]=function(t,e){this.strings["use-last"]=parseInt(e,10)},t.Attributes["@reverse-order"]=function(t,e){"true"===e&&(this.strings["reverse-order"]=!0)},t.Attributes["@display"]=function(t,e){this.strings.cls=e},t.Stack=function(t,e){this.mystack=[],(e||t)&&this.mystack.push(t)},t.Stack.prototype.push=function(t,e){e||t?this.mystack.push(t):this.mystack.push("")},t.Stack.prototype.clear=function(){this.mystack=[]},t.Stack.prototype.replace=function(t,e){if(0===this.mystack.length)throw"Internal CSL processor error: attempt to replace nonexistent stack item with "+t;this.mystack[this.mystack.length-1]=e||t?t:""},t.Stack.prototype.pop=function(){return this.mystack.pop()},t.Stack.prototype.value=function(){return this.mystack.slice(-1)[0]},t.Stack.prototype.length=function(){return this.mystack.length},t.Parallel=function(e){this.state=e,this.sets=new t.Stack([]),this.try_cite=!0,this.use_parallels=!1,this.midVars=["section","volume","container-title","collection-number","issue","page-first","page","number"],this.ignoreVarsLawGeneral=["first-reference-note-number","locator","label","page-first","page","genre"],this.ignoreVarsLawProceduralHistory=["issued","first-reference-note-number","locator","label","page-first","page","genre","jurisdiction"],this.ignoreVarsOrders=["first-reference-note-number"],this.ignoreVarsOther=["first-reference-note-number","locator","label","section","page-first","page"]},t.Parallel.prototype.isMid=function(t){return this.midVars.indexOf(t)>-1},t.Parallel.prototype.StartCitation=function(t,e){this.parallel_conditional_blobs_list=[],this.use_parallels&&(this.sortedItems=t,this.sortedItemsPos=-1,this.sets.clear(),this.sets.push([]),this.in_series=!0,this.delim_counter=0,this.delim_pointers=[],this.out=e?e:this.state.output.queue,this.master_was_neutral_cite=!0)},t.Parallel.prototype.StartCite=function(e,i,s){var r,n,a,o,l,u,h,p;if(this.use_parallels){this.sets.value().length&&this.sets.value()[0].itemId==e.id&&this.ComposeSet(),this.sortedItemsPos+=1,i&&(r=i.position),this.try_cite=!0;for(var c=!1,f=0,m=t.PARALLEL_MATCH_VARS.length;m>f;f+=1)if(e[t.PARALLEL_MATCH_VARS[f]]){c=!0;break}var g=!0,d=this.sets.value().slice(-1)[0];if(d&&d.Item&&(d.Item.title!==e.title?g=!1:d.Item.type!==e.type?g=!1:["article-journal","article-magazine"].indexOf(e.type)>-1&&(this.state.opt.development_extensions.handle_parallel_articles&&d.Item["container-title"]===e["container-title"]||(g=!1))),g&&c&&-1!==t.PARALLEL_TYPES.indexOf(e.type)||(this.try_cite=!0,this.in_series&&(this.in_series=!1)),this.cite={},this.cite.front=[],this.cite.mid=[],this.cite.back=[],this.cite.front_collapse={},this.cite.back_forceme=[],this.cite.position=r,this.cite.Item=e,this.cite.itemId=""+e.id,this.cite.prevItemID=""+s,this.target="front",["treaty"].indexOf(e.type)>-1)this.ignoreVars=this.ignoreVarsOrders;else if(["article-journal","article-magazine"].indexOf(e.type)>-1)this.ignoreVars=this.ignoreVarsOther;else if(i&&i.prefix){this.ignoreVars=this.ignoreVarsLawProceduralHistory,this.cite.useProceduralHistory=!0;var b=this.sets.value()[this.sets.value().length-1];if(b&&b.back)for(var f=b.back.length-1;f>-1;f+=-1)b.back[f]&&b[b.back[f]]&&delete b[b.back[f]]}else this.ignoreVars=this.ignoreVarsLawGeneral;if(this.sortedItems&&this.sortedItemsPos>0&&this.sortedItemsPos<this.sortedItems.length){if(o=this.sortedItems[this.sortedItemsPos][1],u=""+this.sortedItems[this.sortedItemsPos-1][1].id,l=this.state.registry.registry[u].parallel,h=!1,l==o.id){for(n=this.sortedItemsPos-1,a=n;a>-1;a+=-1)if(this.sortedItems[a][1].id==e.id){h=this.sortedItems[a][1].locator;break}p=this.sortedItems[this.sortedItemsPos][1].locator,o.position=!h&&p?t.POSITION_IBID_WITH_LOCATOR:p===h?t.POSITION_IBID:t.POSITION_IBID_WITH_LOCATOR}}else{if(!this.state.registry.registry[e.id])return this.try_cite=!1,this.force_collapse=!1,void 0;this.state.registry.registry[e.id].parallel=!1}this.force_collapse=!1,this.state.registry.registry[e.id].parallel&&(this.force_collapse=!0)}},t.Parallel.prototype.StartVariable=function(e,i){if(this.use_parallels&&(this.try_cite||this.force_collapse)){if(this.variable="names"===e?e+":"+this.target:e,this.ignoreVars.indexOf(e)>-1)return;"container-title"===e&&0===this.sets.value().length&&(this.master_was_neutral_cite=!1),this.data={},this.data.value="",this.data.blobs=[];var s=this.isMid(e);"authority"===i&&"names:front"===this.variable?(this.try_cite=!0,this.in_series=!1):"front"===this.target&&s?this.target="mid":"mid"===this.target&&!s&&this.cite.Item.title&&"names"!==e?this.target="back":"back"===this.target&&s&&(this.try_cite=!0,this.in_series=!1),"number"===e?this.cite.front.push(this.variable):t.PARALLEL_COLLAPSING_MID_VARSET.indexOf(e)>-1?["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1?this.cite.mid.push(this.variable):this.cite.front.push(this.variable):this.cite[this.target].push(this.variable)}},t.Parallel.prototype.AppendBlobPointer=function(t){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1){if(["volume","page","page-first","issue"].indexOf(this.variable)>-1)return;if("container-title"===this.variable&&this.cite.mid.length>1)return}this.variable&&(this.try_cite||this.force_collapse)&&t&&t.blobs&&(this.cite.useProceduralHistory&&"back"===this.target||this.data.blobs.push([t,t.blobs.length]))}}},t.Parallel.prototype.AppendToVariable=function(t){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.try_cite||this.force_collapse){this.data.value+="::"+t}}},t.Parallel.prototype.CloseVariable=function(){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if((this.try_cite||this.force_collapse)&&(this.cite[this.variable]=this.data,this.sets.value().length>0)){var e=this.sets.value()[this.sets.value().length-1];"front"===this.target&&"issued"===this.variable&&this.data.value&&this.master_was_neutral_cite&&(this.target="mid"),"front"===this.target?!e[this.variable]&&!this.data.value||e[this.variable]&&this.data.value===e[this.variable].value||"issued"!==this.variable&&(this.in_series=!1):"mid"===this.target?t.PARALLEL_COLLAPSING_MID_VARSET.indexOf(this.variable)>-1&&(this.cite.front_collapse[this.variable]=e[this.variable]?e[this.variable].value===this.data.value?!0:!1:!1):"back"===this.target&&e[this.variable]&&this.data.value!==e[this.variable].value&&-1===this.sets.value().slice(-1)[0].back_forceme.indexOf(this.variable)&&(this.in_series=!1)}this.variable=!1}},t.Parallel.prototype.CloseCite=function(){var t,e,i,s,r,n,a;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(s=!1,this.cite.front_collapse["container-title"]||(s=!0),this.cite.front_collapse.volume===!1&&(s=!0),this.cite.front_collapse["collection-number"]===!1&&(s=!0),this.cite.front_collapse.section===!1&&(s=!0),s&&(this.cite.use_journal_info=!0,a=this.cite.front.indexOf("section"),a>-1&&(this.cite.front=this.cite.front.slice(0,a).concat(this.cite.front.slice(a+1))),r=this.cite.front.indexOf("volume"),r>-1&&(this.cite.front=this.cite.front.slice(0,r).concat(this.cite.front.slice(r+1))),n=this.cite.front.indexOf("container-title"),n>-1&&(this.cite.front=this.cite.front.slice(0,n).concat(this.cite.front.slice(n+1))),collection_number_pos=this.cite.front.indexOf("collection-number"),collection_number_pos>-1&&(this.cite.front=this.cite.front.slice(0,collection_number_pos).concat(this.cite.front.slice(collection_number_pos+1)))),this.in_series||this.force_collapse||this.ComposeSet(!0),0===this.sets.value().length){for(has_date=!1,e=0,i=this.cite.back.length;i>e;e+=1)if(t=this.cite.back[e],"issued"===t&&this.cite.issued&&this.cite.issued.value){has_date=!0;break}has_date||this.cite.back_forceme.push("issued")}else{var o=this.cite.front.indexOf("issued");if((-1===o||this.master_was_neutral_cite)&&(this.cite.back_forceme=this.sets.value().slice(-1)[0].back_forceme),o>-1){var l=this.sets.value()[this.sets.value().length-1];l.issued||(this.cite.front=this.cite.front.slice(0,o).concat(this.cite.front.slice(o+1)))}this.master_was_neutral_cite&&this.cite.mid.indexOf("names:mid")>-1&&this.cite.front.push("names:mid")}this.sets.value().push(this.cite)}},t.Parallel.prototype.ComposeSet=function(){var e,i,s;if(this.use_parallels&&(this.force_collapse||this.try_cite)){var r=this.sets.value().length;if(1===this.sets.value().length)this.in_series||(this.sets.value().pop(),this.delim_counter+=1);else{for(s=this.sets.value().length,i=0;s>i;i+=1)e=this.sets.value()[i],0===i?this.delim_counter+=1:(!e.Item.title&&e.use_journal_info?this.delim_pointers.push(!1):this.delim_pointers.push(this.delim_counter),this.delim_counter+=1),t.POSITION_FIRST===e.position&&(0===i?(this.state.registry.registry[e.itemId].master=!0,this.state.registry.registry[e.itemId].siblings=[],this.state.registry.registry[e.itemId].parallel=!1):e.prevItemID&&(this.state.registry.registry[e.itemId].parallel=this.state.registry.registry[e.prevItemID].parallel?this.state.registry.registry[e.prevItemID].parallel:e.prevItemID,this.state.registry.registry[e.itemId].siblings=this.state.registry.registry[e.prevItemID].siblings,this.state.registry.registry[e.itemId].siblings||(this.state.registry.registry[e.itemId].siblings=[],t.debug("WARNING: adding missing siblings array to registry object")),this.state.registry.registry[e.itemId].siblings.push(e.itemId)));this.sets.push([])}2>r?this.purgeGroupsIfParallel(!1):this.purgeGroupsIfParallel(!0),this.in_series=!0}},t.Parallel.prototype.PruneOutputQueue=function(){var t,e,i,s,r,n;if(this.use_parallels)for(t=this.sets.mystack.length,e=0;t>e;e+=1)if(i=this.sets.mystack[e],i.length>1)for(r=i.length,s=0;r>s;s+=1)n=i[s],0===s?this.purgeVariableBlobs(n,n.back):s===i.length-1?this.purgeVariableBlobs(n,n.front.concat(n.back_forceme)):this.purgeVariableBlobs(n,n.front.concat(n.back))},t.Parallel.prototype.purgeVariableBlobs=function(t,e){var i,s,r,n,a,o,l;if(this.use_parallels){for(l=this.state.output.current.value(),"undefined"==typeof l.length&&(l=l.blobs),s=0,i=this.delim_pointers.length;i>s;s+=1)o=this.delim_pointers[s],o!==!1&&(l[o].parallel_delimiter=", ");for(i=e.length-1,s=i;s>-1;s+=-1)if(r=e[s],t[r])for(a=t[r].blobs.length-1,o=a;o>-1;o+=-1)n=t[r].blobs[o],n[0].blobs=n[0].blobs.slice(0,n[1]).concat(n[0].blobs.slice(n[1]+1)),this.state.tmp.has_purged_parallel=!0,n[0]&&n[0].strings&&"string"==typeof n[0].strings.oops&&n[0].parent&&n[0].parent&&(n[0].parent.parent.strings.delimiter=n[0].strings.oops)}},t.Parallel.prototype.purgeGroupsIfParallel=function(t){for(var e=this.parallel_conditional_blobs_list.length-1;e>-1;e+=-1){for(var i=this.parallel_conditional_blobs_list[e],s=!0,r=0,n=i.conditions.length;n>r;r+=1)if(!i.conditions[r]!=!!t&&("master"!==i.conditions[r]||this.state.registry.registry[i.id].master)&&("servant"!==i.conditions[r]||this.state.registry.registry[i.id].parallel)){var s=!1;break}if(s){for(var a=[];i.blobs.length>i.pos;)a.push(i.blobs.pop());for(a.length&&a.pop();a.length;)i.blobs.push(a.pop())}this.parallel_conditional_blobs_list.pop()}},t.Util={},t.Util.Match=function(){this.any=function(t,e,i){return function(t,e){for(var s=0,r=i.length;r>s;s+=1)if(result=i[s](t,e))return!0;return!1}},this[void 0]=this.any,this.none=function(t,e,i){return function(t,e){for(var s=0,r=i.length;r>s;s+=1)if(result=i[s](t,e))return!1;return!0}},this.all=function(t,e,i){return function(t,e){for(var s=0,r=i.length;r>s;s+=1)if(result=i[s](t,e),!result)return!1;return!0}},this.nand=function(t,e,i){return function(t,e){for(var s=0,r=i.length;r>s;s+=1)if(result=i[s](t,e),!result)return!0;return!1}}},t.Transform=function(e){function i(e,i,s,r,n,a){var o;if(!n)return r;var l=n,u=!1;if(["title","title-short"].indexOf(l)>-1&&!i.jurisdiction&&(u=!0),t.NUMERIC_VARIABLES.indexOf(n)>-1&&(n="number"),["publisher-place","event-place","jurisdiction","archive-place"].indexOf(n)>-1&&(n="place"),["publisher","authority"].indexOf(n)>-1&&(n="institution-part"),["genre","event","medium","title-short"].indexOf(n)>-1&&(n="title"),["archive"].indexOf(n)>-1&&(n="collection-title"),o="",e.sys.getAbbreviation){var h=e.transform.loadAbbreviation(i.jurisdiction,n,r,i.type,u);e.transform.abbrevs[h][n]&&r&&e.sys.getAbbreviation&&e.transform.abbrevs[h][n][r]&&(o=e.transform.abbrevs[h][n][r].replace("{stet}",r))}return o||e.opt.development_extensions.require_explicit_legal_case_title_short&&"legal_case"===i.type||!s||!i[s]||!a||(o=i[s]),o||(o=r),o&&"!here>>>"===o.slice(0,10)&&(o="jurisdiction"===l&&["treaty","patent"].indexOf(l)>-1?o.slice(10):!1),o}function s(t,i){var s,r=e.opt["default-locale"][0].slice(0,2);return s=e.opt.development_extensions.strict_text_case_locales?new RegExp("^([a-zA-Z]{2})(?:$|-.*| .*)"):new RegExp("^([a-zA-Z]{2})(?:$|-.*|.*)"),t.language&&(m=(""+t.language).match(s),r=m?m[1]:"tlh"),t.multi&&t.multi&&t.multi.main&&t.multi.main[i]&&(r=t.multi.main[i]),(!e.opt.development_extensions.strict_text_case_locales||e.opt.development_extensions.normalize_lang_keys_to_lowercase)&&(r=r.toLowerCase()),r}function r(t,i,r,n,a){var o,l,u,h;if(!t[i])return{name:"",usedOrig:a};if(u={name:"",usedOrig:a,locale:s(t,i)},h=e.opt[r],"locale-orig"===r)return u=a?{name:"",usedOrig:a}:{name:t[i],usedOrig:!1,locale:s(t,i)};if(n&&("undefined"==typeof h||0===h.length))return{name:t[i],usedOrig:!0,locale:s(t,i)};for(var p=0,c=h.length;c>p;p+=1){if(o=h[p],l=o.split(/[\-_]/)[0],o&&t.multi&&t.multi._keys[i]&&t.multi._keys[i][o]){u.name=t.multi._keys[i][o],u.locale=l;break}if(l&&t.multi&&t.multi._keys[i]&&t.multi._keys[i][l]){u.name=t.multi._keys[i][l],u.locale=l;break}}return!u.name&&n&&(u={name:t[i],usedOrig:!0,locale:s(t,i)}),u}function n(t,i,s,r,n){if(t||(t="default"),!s)return e.transform.abbrevs[t]||(e.transform.abbrevs[t]=new e.sys.AbbreviationSegments),t;if(e.sys.getAbbreviation){var a=["default"];if("default"!==t)for(var o=t.split(/\s*;\s*/),l=0,u=o.length;u>l;l+=1)a.push(o.slice(0,l+1).join(";"));for(var l=a.length-1;l>-1;l+=-1)if(e.transform.abbrevs[a[l]]||(e.transform.abbrevs[a[l]]=new e.sys.AbbreviationSegments),e.transform.abbrevs[a[l]][i][s]||e.sys.getAbbreviation(e.opt.styleID,e.transform.abbrevs,a[l],i,s,r,n),e.transform.abbrevs[a[l]][i][s]){l<a.length&&(e.transform.abbrevs[t][i][s]=e.transform.abbrevs[a[l]][i][s]);break}}return t}function a(t,s,r,n){var a=t.variables[0];if(e.publisherOutput&&r){if(-1===["publisher","publisher-place"].indexOf(a))return!1;e.publisherOutput[a+"-token"]=t,e.publisherOutput.varlist.push(a);var o=r.split(/;\s*/);o.length===e.publisherOutput[a+"-list"].length&&(e.publisherOutput[a+"-list"]=o);for(var l=0,u=o.length;u>l;l+=1)o[l]=i(e,s,!1,o[l],n,!0);return e.tmp[a+"-token"]=t,!0}return!1}function o(s,n,o,u){var h,p=t.LangPrefsMap[s[0]];return h=p?e.opt["cite-lang-prefs"][p]:!1,function(e,o,c){var f,m,g,d,b,_,y;if(!s[0]||!o[s[0]]&&!o[u])return null;var v={primary:!1,secondary:!1,tertiary:!1};if("_sort"===e.tmp.area.slice(-5))v.primary="locale-sort";else if(h)for(var x=["primary","secondary","tertiary"],I=0,S=x.length;S>I&&!(h.length-1<I);I+=1)h[I]&&(v[x[I]]="locale-"+h[I]);else v.primary="locale-orig";if("bibliography"===e.tmp.area||"citation"===e.tmp.area&&"note"===e.opt.xclass&&c&&!c.position||(v.secondary=!1,v.tertiary=!1),e.tmp["publisher-list"])return"publisher"===s[0]?e.tmp["publisher-token"]=this:"publisher-place"===s[0]&&(e.tmp["publisher-place-token"]=this),null;
var O=r(o,s[0],v.primary,!0);f=O.name,m=O.locale;var T=O.usedOrig;if(a(this,o,f,n))return null;g=!1,b=!1,v.secondary&&(O=r(o,s[0],v.secondary,!1,O.usedOrig),g=O.name,d=O.locale),v.tertiary&&(O=r(o,s[0],v.tertiary,!1,O.usedOrig),b=O.name,_=O.locale),n&&(f=i(e,o,u,f,n,!0),f&&(f=l(f)),g=i(e,o,!1,g,n,!0),b=i(e,o,!1,b,n,!0));var A,E=t.Util.cloneToken(this),y=t.Util.cloneToken(this);if("locale-translit"===v.primary&&(A=e.opt.citeAffixes[p][v.primary].prefix),"<i>"===A&&"title"===s[0]&&!T){for(var N=!1,I=0,S=y.decorations.length;S>I;I+=1)"@font-style"===y.decorations[I][0]&&"italic"===y.decorations[I][1]&&(N=!0);N||y.decorations.push(["@font-style","italic"])}if("en"!==m&&"title"===y.strings["text-case"]&&(y.strings["text-case"]="passthrough"),"title"===s[0]&&(f=t.demoteNoiseWords(e,f,this["leading-noise-words"])),g||b){if(e.output.openLevel("empty"),y.strings.suffix=y.strings.suffix.replace(/[ .,]+$/,""),e.output.append(f,y),g){secondary_tok=t.Util.cloneToken(E),secondary_tok.strings.prefix=e.opt.citeAffixes[p][v.secondary].prefix,secondary_tok.strings.suffix=e.opt.citeAffixes[p][v.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ");for(var I=secondary_tok.decorations.length-1;I>-1;I+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(secondary_tok.decorations[I].join("/"))>-1&&(secondary_tok.decorations=secondary_tok.decorations.slice(0,I).concat(secondary_tok.decorations.slice(I+1)));"en"!==d&&"title"===secondary_tok.strings["text-case"]&&(secondary_tok.strings["text-case"]="passthrough"),e.output.append(g,secondary_tok);var k=e.output.current.value(),R=e.output.current.value().blobs.length-1;e.parallel.use_parallels&&(e.parallel.cite.front.push(s[0]+":secondary"),e.parallel.cite[s[0]+":secondary"]={blobs:[[k,R]]})}if(b){tertiary_tok=t.Util.cloneToken(E),tertiary_tok.strings.prefix=e.opt.citeAffixes[p][v.tertiary].prefix,tertiary_tok.strings.suffix=e.opt.citeAffixes[p][v.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ");for(var I=tertiary_tok.decorations.length-1;I>-1;I+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(tertiary_tok.decorations[I].join("/"))>-1&&(tertiary_tok.decorations=tertiary_tok.decorations.slice(0,I).concat(tertiary_tok.decorations.slice(I+1)));"en"!==_&&"title"===tertiary_tok.strings["text-case"]&&(tertiary_tok.strings["text-case"]="passthrough"),e.output.append(b,tertiary_tok);var k=e.output.current.value(),R=e.output.current.value().blobs.length-1;e.parallel.use_parallels&&(e.parallel.cite.front.push(s[0]+":tertiary"),e.parallel.cite[s[0]+":tertiary"]={blobs:[[k,R]]})}e.output.closeLevel()}else e.output.append(f,y);return null}}function l(t){var i=t.match(/^!([-,_a-z]+)>>>/);if(i){var s=i[1].split(",");t=t.slice(i[0].length);for(var r=0,n=s.length;n>r;r+=1)-1===e.tmp.done_vars.indexOf(s[r])&&e.tmp.done_vars.push(s[r])}return t}this.abbrevs={},this.abbrevs["default"]=new e.sys.AbbreviationSegments,this.getTextSubField=r,this.loadAbbreviation=n,this.getOutputFunction=o,this.quashCheck=l},t.Token=function(t,e){this.name=t,this.strings={},this.strings.delimiter=void 0,this.strings.prefix="",this.strings.suffix="",this.decorations=[],this.variables=[],this.execs=[],this.tokentype=e,this.evaluator=!1,this.tests=[],this.rawtests=[],this.succeed=!1,this.fail=!1,this.next=!1},t.Util.cloneToken=function(e){var i,s,r,n;if("string"==typeof e)return e;i=new t.Token(e.name,e.tokentype);for(s in e.strings)e.strings.hasOwnProperty(s)&&(i.strings[s]=e.strings[s]);if(e.decorations)for(i.decorations=[],r=0,n=e.decorations.length;n>r;r+=1)i.decorations.push(e.decorations[r].slice());return e.variables&&(i.variables=e.variables.slice()),e.execs&&(i.execs=e.execs.slice(),i.tests=e.tests.slice(),i.rawtests=e.tests.slice()),i},t.AmbigConfig=function(){this.maxvals=[],this.minval=1,this.names=[],this.givens=[],this.year_suffix=!1,this.disambiguate=0},t.Blob=function(t,e,i){var s,r,n;if(this.levelname=i,e){this.strings={prefix:"",suffix:""};for(n in e.strings)e.strings.hasOwnProperty(n)&&(this.strings[n]=e.strings[n]);for(this.decorations=[],s=void 0===e.decorations?0:e.decorations.length,r=0;s>r;r+=1)this.decorations.push(e.decorations[r].slice())}else this.strings={},this.strings.prefix="",this.strings.suffix="",this.strings.delimiter="",this.decorations=[];this.blobs="string"==typeof t?t:t?[t]:[],this.alldecor=[this.decorations]},t.Blob.prototype.push=function(t){if("string"==typeof this.blobs)throw"Attempt to push blob onto string object";t.alldecor=t.alldecor.concat(this.alldecor),this.blobs.push(t)},t.NumericBlob=function(e,i,s){this.id=s,this.alldecor=[],this.num=e,this.blobs=e.toString(),this.status=t.START,this.strings={},i?(this.gender=i.gender,this.decorations=i.decorations,this.strings.prefix=i.strings.prefix,this.strings.suffix=i.strings.suffix,this.strings["text-case"]=i.strings["text-case"],this.successor_prefix=i.successor_prefix,this.range_prefix=i.range_prefix,this.splice_prefix=i.splice_prefix,this.formatter=i.formatter,this.formatter||(this.formatter=new t.Output.DefaultFormatter),this.formatter&&(this.type=this.formatter.format(1))):(this.decorations=[],this.strings.prefix="",this.strings.suffix="",this.successor_prefix="",this.range_prefix="",this.splice_prefix="",this.formatter=new t.Output.DefaultFormatter)},t.NumericBlob.prototype.setFormatter=function(t){this.formatter=t,this.type=this.formatter.format(1)},t.Output.DefaultFormatter=function(){},t.Output.DefaultFormatter.prototype.format=function(t){return t.toString()},t.NumericBlob.prototype.checkNext=function(e,i){i?(this.status=t.START,"object"==typeof e&&(e.status=e.num===this.num+1?t.SUCCESSOR:t.SEEN)):e&&e.num&&this.type===e.type&&e.num===this.num+1?this.status===t.START||this.status===t.SEEN?e.status=t.SUCCESSOR:(this.status===t.SUCCESSOR||this.status===t.SUCCESSOR_OF_SUCCESSOR)&&(this.range_prefix?(e.status=t.SUCCESSOR_OF_SUCCESSOR,this.status=t.SUPPRESS):e.status=t.SUCCESSOR):(this.status===t.SUCCESSOR_OF_SUCCESSOR&&(this.status=t.END),"object"==typeof e&&(e.status=t.SEEN))},t.NumericBlob.prototype.checkLast=function(e){return this.status===t.SEEN||e.num!==this.num-1&&this.status===t.SUCCESSOR?(this.status=t.SUCCESSOR,!0):!1},t.Util.fixDateNode=function(t,e,i){var s,r,n,a,o,l,u,h,p,c,f,m,g,d;this.build.date_key=!0,s=this.sys.xml.getAttributeValue(i,"form");var b;if(b="accessed"===this.sys.xml.getAttributeValue(i,"variable")?this.opt["default-locale"][0]:this.sys.xml.getAttributeValue(i,"lingo"),!this.getDate(s))return t;var _=this.sys.xml.getAttributeValue(i,"date-parts");r=this.sys.xml.getAttributeValue(i,"variable"),h=this.sys.xml.getAttributeValue(i,"prefix"),p=this.sys.xml.getAttributeValue(i,"suffix"),g=this.sys.xml.getAttributeValue(i,"display"),d=this.sys.xml.getAttributeValue(i,"cslid"),n=this.sys.xml.nodeCopy(this.getDate(s,"accessed"===r)),this.sys.xml.setAttribute(n,"lingo",this.opt.lang),this.sys.xml.setAttribute(n,"form",s),this.sys.xml.setAttribute(n,"date-parts",_),this.sys.xml.setAttribute(n,"cslid",d),this.sys.xml.setAttribute(n,"variable",r),h&&this.sys.xml.setAttribute(n,"prefix",h),p&&this.sys.xml.setAttribute(n,"suffix",p),g&&this.sys.xml.setAttribute(n,"display",g),c=this.sys.xml.children(i);for(f in c)if(a=c[f],"date-part"===this.sys.xml.nodename(a)){o=this.sys.xml.getAttributeValue(a,"name"),m=this.sys.xml.attributes(a);for(l in m)if(m.hasOwnProperty(l)){if("@name"===l)continue;if(b&&b!==this.opt.lang&&["@suffix","@prefix","@form"].indexOf(l)>-1)continue;u=m[l],this.sys.xml.setAttributeOnNodeIdentifiedByNameAttribute(n,"date-part",o,l,u)}}return"year"===this.sys.xml.getAttributeValue(i,"date-parts")?(this.sys.xml.deleteNodeByNameAttribute(n,"month"),this.sys.xml.deleteNodeByNameAttribute(n,"day")):"year-month"===this.sys.xml.getAttributeValue(i,"date-parts")&&this.sys.xml.deleteNodeByNameAttribute(n,"day"),this.sys.xml.insertChildNodeAfter(t,i,e,n)},t.dateMacroAsSortKey=function(e,i){t.dateAsSortKey.call(this,e,i,!0)},t.dateAsSortKey=function(e,i,s){var r,n,a,o,l,u,h,p,c=this.variables[0],f="empty";for(s&&(f="macro-with-date"),r=i[c],"undefined"==typeof r&&(r={"date-parts":[[0]]},r.year||(e.tmp.empty_date=!0)),"undefined"==typeof this.dateparts&&(this.dateparts=["year","month","day"]),r.raw?r=e.fun.dateparser.parse(r.raw):r["date-parts"]&&(r=e.dateParseArray(r)),"undefined"==typeof r&&(r={}),h=0,p=t.DATE_PARTS_INTERNAL.length;p>h;h+=1)n=t.DATE_PARTS_INTERNAL[h],a=0,o=n,"_end"===o.slice(-4)&&(o=o.slice(0,-4)),r[n]&&this.dateparts.indexOf(o)>-1&&(a=r[n]),"year"===n.slice(0,4)?(l=t.Util.Dates[o].numeric(e,a),u="Y","-"===l[0]&&(u="X",l=l.slice(1),l=9999-parseInt(l,10)),e.output.append(t.Util.Dates[n.slice(0,4)].numeric(e,u+l),f)):(a=t.Util.Dates[o]["numeric-leading-zeros"](e,a),a||(a="00"),e.output.append(a,f))},t.Engine.prototype.dateParseArray=function(e){var i,s,r,n;i={};for(s in e)if("date-parts"===s){r=e["date-parts"],r.length>1&&r[0].length!==r[1].length&&t.error("CSL data error: element mismatch in date range input."),n=["","_end"];for(var a=0,o=r.length;o>a;a+=1)for(var l=0,u=t.DATE_PARTS.length;u>l;l+=1)i[t.DATE_PARTS[l]+n[a]]="undefined"==typeof r[a][l]?r[a][l]:parseInt(r[a][l],10)}else e.hasOwnProperty(s)&&("literal"===s&&"object"==typeof e.literal&&"string"==typeof e.literal.part?(t.debug("Warning: fixing up weird literal date value"),i.literal=e.literal.part):i[s]=e[s]);return i},t.Util.Names={},t.Util.Names.compareNamesets=t.NameOutput.prototype._compareNamesets,t.Util.Names.unInitialize=function(e,i){var s,r,n,a,o;if(!i)return"";for(n=i.split(/(?:\-|\s+)/),a=i.match(/(\-|\s+)/g),o="",s=0,r=n.length;r>s;s+=1)t.ALL_ROMANESQUE_REGEXP.exec(n[s].slice(0,-1))&&n[s]&&n[s]!==n[s].toUpperCase()&&(n[s]=n[s].slice(0,1)+n[s].slice(1,2).toLowerCase()+n[s].slice(2)),o+=n[s],r-1>s&&(o+=a[s]);return o},t.Util.Names.initializeWith=function(e,i,s,r){var n,a,o,l,u,h,p;if(!i)return"";if(["Lord","Lady"].indexOf(i)>-1||!i.match(t.STARTSWITH_ROMANESQUE_REGEXP)&&!s.match("%s"))return i;s||(s="");var c=i;if(e.opt["initialize-with-hyphen"]===!1&&(c=c.replace(/\-/g," ")),c=c.replace(/\s*\-\s*/g,"-").replace(/\s+/g," "),c=c.replace(/-([a-z])/g,"–$1"),u=c.match(/[\-\s]+/g),h=c.split(/[\-\s]+/),0===h.length)c=u;else for(c=[h[0]],n=1,a=h.length;a>n;n+=1)c.push(u[n-1]),c.push(h[n]);for(h=c,n=h.length-1;n>-1;n+=-1)if(h[n]&&h[n].slice(0,-1).indexOf(".")>-1){var f=h.slice(n+1),m=h[n].slice(0,-1).split(".");for(h=h.slice(0,n),o=0,l=m.length;l>o;o+=1)h.push(m[o]+"."),o<m.length-1&&h.push(" ");h=h.concat(f)}return p=r?t.Util.Names.doNormalize(e,h,s):t.Util.Names.doInitialize(e,h,s),p=p.replace(/\u2013([a-z])/g,"-$1")},t.Util.Names.doNormalize=function(e,i,s){var r,n,a=[];for(r=0,n=i.length;n>r;r+=1)i[r].length>1&&"."===i[r].slice(-1)?(i[r]=i[r].slice(0,-1),a.push(!0)):1===i[r].length&&i[r].toUpperCase()===i[r]?a.push(!0):a.push(!1);for(r=0,n=i.length;n>r;r+=2)a[r]&&(r<i.length-2&&(i[r+1]="",(!s||s.slice(-1)&&" "!==s.slice(-1))&&i[r].length&&i[r].match(t.ALL_ROMANESQUE_REGEXP)&&(i[r].length>1||i[r+2].length>1)&&(i[r+1]=" "),i[r]=i[r]+s),r===i.length-1&&(i[r]=i[r]+s));return i.join("").replace(/\s+$/,"")},t.Util.Names.doInitialize=function(e,i,s){var r,n,a,o,l,u,h;for(r=0,n=i.length;n>r;r+=2)if(h=i[r])if(a=h.match(t.NAME_INITIAL_REGEXP),!a&&!h.match(t.STARTSWITH_ROMANESQUE_REGEXP)&&h.length>1&&s.match("%s")&&(a=h.match(/(.)(.*)/)),a&&a[1]===a[1].toUpperCase()){var p="";if(a[2]){var c="";for(u=a[2].split(""),o=0,l=u.length;l>o;o+=1){var f=u[o];if(f!==f.toUpperCase())break;c+=f}c.length<a[2].length&&(p=c.toLocaleLowerCase())}i[r]=a[1].toLocaleUpperCase()+p,n-1>r?s.match("%s")?i[r]=s.replace("%s",i[r]):i[r+1]=i[r+1].indexOf("-")>-1?s+i[r+1]:s:s.match("%s")?i[r]=s.replace("%s",i[r]):i.push(s)}else h.match(t.ROMANESQUE_REGEXP)&&(i[r]=" "+h);var m=i.join("");return m=m.replace(/\s+$/,"").replace(/\s*\-\s*/g,"-").replace(/\s+/g," ")},t.Util.Names.getRawName=function(t){var e=[];return t.given&&e.push(t.given),t.family&&e.push(t.family),e.join(" ")},t.Util.Dates={},t.Util.Dates.year={},t.Util.Dates.year["long"]=function(t,e){return e||(e="boolean"==typeof e?"":0),e.toString()},t.Util.Dates.year.imperial=function(t,e,i){e||(e="boolean"==typeof e?"":0),i=i?"_end":"";var s=t.tmp.date_object["month"+i];for(s=s?""+s:"1";s.length<2;)s="0"+s;var r=t.tmp.date_object["day"+i];for(r=r?""+r:"1";r.length<2;)r="0"+r;var n,a,o=parseInt(e+s+r,10);return o>=18680908&&19120730>o?(n="明治",a=1867):o>=19120730&&19261225>o?(n="大正",a=1911):o>=19261225&&19890108>o?(n="昭和",a=1925):o>=19890108&&(n="平成",a=1988),n&&a&&(t.transform.abbrevs["default"].number[n]||t.transform.loadAbbreviation("default","number",n),t.transform.abbrevs["default"].number[n]&&(n=t.transform.abbrevs["default"].number[n]),year=n+(e-a)),year},t.Util.Dates.year["short"]=function(t,e){return e=e.toString(),e&&4===e.length?e.substr(2):void 0},t.Util.Dates.year.numeric=function(t,e){var i,s;for(e=""+e,i=e.match(/([0-9]*)$/),i?(s=e.slice(0,-1*i[1].length),e=i[1]):(s=e,e="");e.length<4;)e="0"+e;return s+e},t.Util.Dates.normalizeMonth=function(t,e){var i;if(t||(t=0),t=""+t,t.match(/^[0-9]+$/)||(t=0),t=parseInt(t,10),e){var s={stub:"month-",num:t};s.num<1||s.num>20?s.num=0:s.num>16?(s.stub="season-",s.num=s.num-16):s.num>12&&(s.stub="season-",s.num=s.num-12),i=s}else(1>t||t>12)&&(t=0),i=t;return i},t.Util.Dates.month={},t.Util.Dates.month.numeric=function(e,i){var i=t.Util.Dates.normalizeMonth(i);return i||(i=""),i},t.Util.Dates.month["numeric-leading-zeros"]=function(e,i){var i=t.Util.Dates.normalizeMonth(i);if(i)for(i=""+i;i.length<2;)i="0"+i;else i="";return i},t.Util.Dates.month["long"]=function(e,i,s,r){var n=t.Util.Dates.normalizeMonth(i,!0),i=n.num;if(i){for(i=""+i;i.length<2;)i="0"+i;i=e.getTerm(n.stub+i,"long",0,0,!1,r)}else i="";return i},t.Util.Dates.month["short"]=function(e,i,s,r){var n=t.Util.Dates.normalizeMonth(i,!0),i=n.num;if(i){for(i=""+i;i.length<2;)i="0"+i;i=e.getTerm(n.stub+i,"short",0,0,!1,r)}else i="";return i},t.Util.Dates.day={},t.Util.Dates.day.numeric=function(t,e){return e.toString()},t.Util.Dates.day["long"]=t.Util.Dates.day.numeric,t.Util.Dates.day["numeric-leading-zeros"]=function(t,e){for(e||(e=0),e=e.toString();e.length<2;)e="0"+e;return e.toString()},t.Util.Dates.day.ordinal=function(t,e,i){return t.fun.ordinalizer.format(e,i)},t.Util.Sort={},t.Util.Sort.strip_prepositions=function(t){var e;return"string"==typeof t&&(e=t.toLocaleLowerCase(),e=t.match(/^((a|an|the)\s+)/)),e&&(t=t.substr(e[1].length)),t},t.Util.substituteStart=function(e,i){var s,r,n,a,o,l,u;a=function(t){for(var e=0,i=this.decorations.length;i>e;e+=1)if("@strip-periods"===this.decorations[e][0]&&"true"===this.decorations[e][1]){t.tmp.strip_periods+=1;break}},this.execs.push(a),this.decorations&&e.opt.development_extensions.csl_reverse_lookup_support&&(this.decorations.reverse(),this.decorations.push(["@showid","true",this.cslid]),this.decorations.reverse()),u=["number","date","names"],("text"===this.name&&!this.postponed_macro||u.indexOf(this.name)>-1)&&(s=function(t,e,i){"author"===t.tmp.element_trace.value()||"names"===this.name?i&&i["author-only"]?t.tmp.element_trace.push("do-not-suppress-me"):i&&i["suppress-author"]:i&&i["author-only"]?t.tmp.element_trace.push("suppress-me"):i&&i["suppress-author"]&&t.tmp.element_trace.push("do-not-suppress-me")},this.execs.push(s)),r=this.strings.cls,this.strings.cls=!1,0===e.build.render_nesting_level&&("bibliography"===e.build.area&&e.bibliography.opt["second-field-align"]?(n=new t.Token("group",t.START),n.decorations=[["@display","left-margin"]],a=function(t,e){t.tmp.render_seen||(n.strings.first_blob=e.id,t.output.startTag("bib_first",n))},n.execs.push(a),i.push(n)):t.DISPLAY_CLASSES.indexOf(r)>-1&&(n=new t.Token("group",t.START),n.decorations=[["@display",r]],a=function(t,e){n.strings.first_blob=e.id,t.output.startTag("bib_first",n)},n.execs.push(a),i.push(n)),e.build.cls=r),e.build.render_nesting_level+=1,1===e.build.substitute_level.value()&&(o=new t.Token("choose",t.START),t.Node.choose.build.call(o,e,i),l=new t.Token("if",t.START),a=function(){return e.tmp.can_substitute.value()?!0:!1},l.tests.push(a),l.test=e.fun.match.any(this,e,l.tests),i.push(l))},t.Util.substituteEnd=function(e,i){var s,r,n,a,o,l,u,h,p;s=function(t){for(var e=0,i=this.decorations.length;i>e;e+=1)if("@strip-periods"===this.decorations[e][0]&&"true"===this.decorations[e][1]){t.tmp.strip_periods+=-1;break}},this.execs.push(s),e.build.render_nesting_level+=-1,0===e.build.render_nesting_level&&(e.build.cls?(s=function(t){t.output.endTag("bib_first")},this.execs.push(s),e.build.cls=!1):"bibliography"===e.build.area&&e.bibliography.opt["second-field-align"]&&(r=new t.Token("group",t.END),s=function(t){t.tmp.render_seen||t.output.endTag()},r.execs.push(s),i.push(r),n=new t.Token("group",t.START),n.decorations=[["@display","right-inline"]],s=function(t){t.tmp.render_seen||(t.tmp.render_seen=!0,t.output.startTag("bib_other",n))},n.execs.push(s),i.push(n))),1===e.build.substitute_level.value()&&(a=new t.Token("if",t.END),i.push(a),o=new t.Token("choose",t.END),t.Node.choose.build.call(o,e,i)),l="names"===this.name&&0===e.build.substitute_level.value(),u="string"==typeof e[e.build.area].opt["subsequent-author-substitute"];var c=e[e.build.area].opt["subsequent-author-substitute-rule"];l&&u&&(h=new t.Token("text",t.SINGLETON),s=function(e){var i,s,r=!e.tmp.suppress_decorations;if(r&&"bibliography"===e.tmp.area&&e.tmp.subsequent_author_substitute_ok&&e.tmp.rendered_name)if("partial-each"===c||"partial-first"===c){var n=!0,a=[];for(i=0,s=e.tmp.name_node.children.length;s>i;i+=1){var o=e.tmp.rendered_name[i];n&&e.tmp.last_rendered_name&&e.tmp.last_rendered_name.length>i-1&&e.tmp.last_rendered_name[i]===o?(p=new t.Blob(e[e.tmp.area].opt["subsequent-author-substitute"]),e.tmp.name_node.children[i].blobs=[p],"partial-first"===c&&(n=!1)):n=!1,a.push(o)}e.tmp.last_rendered_name=a}else if("complete-each"===c){var a=e.tmp.rendered_name.join(",");if(a){if(a===e.tmp.last_rendered_name)for(i=0,s=e.tmp.name_node.children.length;s>i;i+=1)p=new t.Blob(e[e.tmp.area].opt["subsequent-author-substitute"]),e.tmp.name_node.children[i].blobs=[p];e.tmp.last_rendered_name=a}}else{var a=e.tmp.rendered_name.join(",");a&&(a===e.tmp.last_rendered_name&&(p=new t.Blob(e[e.tmp.area].opt["subsequent-author-substitute"]),e.tmp.name_node.top.blobs=e.tmp.label_blob?[p,e.tmp.label_blob]:[p]),e.tmp.last_rendered_name=a)}},h.execs.push(s),i.push(h)),("text"===this.name&&!this.postponed_macro||["number","date","names"].indexOf(this.name)>-1)&&(s=function(t){t.tmp.element_trace.pop()},this.execs.push(s))},t.Util.padding=function(t){var e=t.match(/\s*(-{0,1}[0-9]+)/);if(e)for(t=parseInt(e[1],10),0>t&&(t=1e20+t),t=""+t;t.length<20;)t="0"+t;return t},t.Util.LongOrdinalizer=function(){},t.Util.LongOrdinalizer.prototype.init=function(t){this.state=t},t.Util.LongOrdinalizer.prototype.format=function(e,i){10>e&&(e="0"+e);var s=t.Engine.getField(t.LOOSE,this.state.locale[this.state.opt.lang].terms,"long-ordinal-"+e,"long",0,i);return s||(s=this.state.fun.ordinalizer.format(e,i)),this.state.tmp.cite_renders_content=!0,s},t.Util.Ordinalizer=function(t){this.state=t,this.suffixes={}},t.Util.Ordinalizer.prototype.init=function(){if(!this.suffixes[this.state.opt.lang]){this.suffixes[this.state.opt.lang]={};for(var t=0,e=3;e>t;t+=1){var i=[void 0,"masculine","feminine"][t];this.suffixes[this.state.opt.lang][i]=[];for(var s=1;5>s;s+=1){var r=this.state.getTerm("ordinal-0"+s,"long",!1,i);if("undefined"==typeof r){delete this.suffixes[this.state.opt.lang][i];break}this.suffixes[this.state.opt.lang][i].push(r)}}}},t.Util.Ordinalizer.prototype.format=function(t,e){var i;t=parseInt(t,10),i=""+t;var s="",r=[];if(e&&r.push(e),r.push("neuter"),this.state.locale[this.state.opt.lang].ord["1.0.1"]){s=this.state.getTerm("ordinal",!1,0,e);for(var n,a=0,o=r.length;o>a;a+=1){n=r[a];var l=this.state.locale[this.state.opt.lang].ord["1.0.1"];if(l["whole-number"][i]&&l["whole-number"][i][n]?s=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["whole-number"][i][n],!1,0,e):l["last-two-digits"][i.slice(i.length-2)]&&l["last-two-digits"][i.slice(i.length-2)][n]?s=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-two-digits"][i.slice(i.length-2)][n],!1,0,e):l["last-digit"][i.slice(i.length-1)]&&l["last-digit"][i.slice(i.length-1)][n]&&(s=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-digit"][i.slice(i.length-1)][n],!1,0,e)),s)break}}else e||(e=void 0),this.state.fun.ordinalizer.init(),s=1===t/10%10||t>10&&20>t?this.suffixes[this.state.opt.lang][e][3]:1===t%10&&11!==t%100?this.suffixes[this.state.opt.lang][e][0]:2===t%10&&12!==t%100?this.suffixes[this.state.opt.lang][e][1]:3===t%10&&13!==t%100?this.suffixes[this.state.opt.lang][e][2]:this.suffixes[this.state.opt.lang][e][3];return i=i+=s},t.Util.Romanizer=function(){},t.Util.Romanizer.prototype.format=function(e){var i,s,r,n,a;if(i="",6e3>e)for(n=e.toString().split(""),n.reverse(),s=0,r=0,a=n.length,s=0;a>s;s+=1)r=parseInt(n[s],10),i=t.ROMAN_NUMERALS[s][r]+i;return i},t.Util.Suffixator=function(e){e||(e=t.SUFFIX_CHARS),this.slist=e.split(",")},t.Util.Suffixator.prototype.format=function(t){var e;t+=1;var i="";do e=0===t%26?26:t%26,i=this.slist[e-1]+i,t=(t-e)/26;while(0!==t);return i},t.Engine.prototype.processNumber=function(e,i,s,r){var n,a,o,l,u,h;if(this.tmp.shadow_numbers[s]){if(this.tmp.shadow_numbers[s].numeric)for(var o=0,l=this.tmp.shadow_numbers[s].values.length;l>o;o+=2)this.tmp.shadow_numbers[s].values[o][2]=e}else if(this.tmp.shadow_numbers[s]={},this.tmp.shadow_numbers[s].values=[],this.tmp.shadow_numbers[s].plural=0,this.tmp.shadow_numbers[s].numeric=!1,this.tmp.shadow_numbers[s].label=!1,i){var p=t.LangPrefsMap[s];if(p){var c=this.opt["cite-lang-prefs"][p][0];n=this.transform.getTextSubField(i,s,"locale-"+c,!0),n=n.name}else n=i[s];if(n&&this.sys.getAbbreviation){n=(""+n).replace(/^\"/,"").replace(/\"$/,"");var f=this.transform.loadAbbreviation(i.jurisdiction,"number",n);this.transform.abbrevs[f].number[n]?n=this.transform.abbrevs[f].number[n]:"undefined"!=typeof this.transform.abbrevs[f].number[n]&&delete this.transform.abbrevs[f].number[n]}if("undefined"!=typeof n){if("number"==typeof n&&(n=""+n),this.tmp.shadow_numbers[s].label=s,'"'===n.slice(0,1)&&'"'===n.slice(-1)&&(n=n.slice(1,-1)),n&&["number-of-volumes","number-of-pages"].indexOf(s)>-1){var a=n.match(/[^0-9]*([0-9]+).*/);a&&(this.tmp.shadow_numbers[s].numeric=!0,"1"!==a[1]&&(this.tmp.shadow_numbers[s].plural=1))}"locator"===s&&["bill","gazette","legislation","treaty"].indexOf(r)>-1&&(n=n.split(t.STATUTE_SUBDIV_PLAIN_REGEX)[0]);var m="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(r)>-1&&"collection-number"===s&&(m="year"),["page","page-first"].indexOf(s)>-1){var a=n.split(" ")[0].match(t.STATUTE_SUBDIV_GROUPED_REGEX);if(a){this.opt.development_extensions.static_statute_locator&&(this.tmp.shadow_numbers[s].label=t.STATUTE_SUBDIV_STRINGS[a[0]]);var g=n.match(/[^ ]+\s+(.*)/);g&&(n=g[1])}}for(var d=n.split(/(?:,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/),a=n.match(/(,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/g),b=[],o=0,l=d.length-1;l>o;o+=1)b.push(d[o]),b.push(a[o]);b.push(d[d.length-1]);for(var _=0,y=!0,o=0,l=b.length;l>o;o+=1){var v=0===o%2;if(v){if(b[o]){if(b[o].match(/(?:[0-9]|[xivcmlXIVCML])/))if(b[o-1]&&b[o-1].match(/^\s*\\*[\-\u2013]+\s*$/)){var x=this.tmp.shadow_numbers[s].values.slice(-1);if(-1==x[0][1].indexOf("\\")){if(b[o-2]&&(""+b[o-2]).match(/(:?[a-zA-Z]*[0-9]+$|^[ivxlcmIVXLCM]+$)/)&&b[o].match(/(?:^[a-zA-Z]*[0-9]+|^[ivxlcmIVXLCM]+$)/)){var I=this.tmp.shadow_numbers[s].values.slice(-2);if(x[0][1]=this.getTerm(m+"-range-delimiter"),this.opt[m+"-range-format"]){var S=this.fun[m+"_mangler"](I[0][1]+"-"+b[o]);S=S.split(this.getTerm(m+"-range-delimiter")),b[o]=S[1]}_+=1}x[0][1].indexOf("--")>-1&&(x[0][1]=x[0][1].replace(/--*/,"–"))}else x[0][1]=x[0][1].replace(/\\/,"","g")}else-1===b[o].indexOf(" ")&&(_+=1);for(var O=b[o].split(/\s+/),u=0,h=O.length;h>u;u+=1)this.opt.development_extensions.strict_page_numbers&&"page"===s&&!O[u].match(/^-*[0-9]/)?y=!1:O[u].match(/[-0-9]/)||(y=!1);if(b[o].match(/^[1-9][0-9]*$/))b[o]=parseInt(b[o],10),e&&"undefined"==typeof e.gender&&(e.gender=this.locale[this.opt.lang]["noun-genders"][s],e.gender||(e.gender="")),this.tmp.shadow_numbers[s].values.push(["NumericBlob",b[o],e]);else{var T=b[o];this.tmp.shadow_numbers[s].values.push(["Blob",T,e])}}}else b[o]&&this.tmp.shadow_numbers[s].values.push(["Blob",b[o],void 0])}this.tmp.shadow_numbers[s].numeric=this.opt.development_extensions.strict_page_numbers&&"page"===s?-1===n.indexOf(" ")&&n.match(/^-*[0-9]/)?!0:y:-1===n.indexOf(" ")&&n.match(/[0-9]/)?!0:y,this.tmp.shadow_numbers[s].numeric||this.transform.loadAbbreviation(i.jurisdiction,"number",n),_>1&&(this.tmp.shadow_numbers[s].plural=1),1===i.force_pluralism?this.tmp.shadow_numbers[s].plural=1:0===i.force_pluralism&&(this.tmp.shadow_numbers[s].plural=0)}}},t.Util.PageRangeMangler={},t.Util.PageRangeMangler.getFunction=function(t,e){var i,s,r,n,a,o,l,u,h,p,c,f,m,g,d,b,_,y=t.getTerm(e+"-range-delimiter");i=/([a-zA-Z]*)([0-9]+)\s*(?:\u2013|-)\s*([a-zA-Z]*)([0-9]+)/,n=function(i){for(r=i.length,s=1;r>s;s+=2)"object"==typeof i[s]&&(i[s]=i[s].join(""));var n=i.join("");return n=n.replace(/([^\\])\-/g,"$1"+t.getTerm(e+"-range-delimiter"))},a=function(t,e){var i,n,a;t=t.replace(/([^\\])\u2013/g,"$1-").replace(/\s+\u2013\s+/g," - ");var o=new RegExp("([a-zA-Z]*[0-9]+"+e+"[a-zA-Z]*[0-9]+)","g"),l=new RegExp("[a-zA-Z]*[0-9]+"+e+"[a-zA-Z]*[0-9]+");if(i=t.match(o),n=t.split(l),0===n.length)a=i;else for(a=[n[0]],s=1,r=n.length;r>s;s+=1)a.push(i[s-1].replace(/\s*\-\s*/,"-","g")),a.push(n[s]);return a},o=function(t,e){for(t=""+t,p=a(t,e),r=p.length,s=1;r>s;s+=2)c=p[s].match(i),c&&(c[3]&&c[1]!==c[3]||(c[4].length<c[2].length&&(c[4]=c[2].slice(0,c[2].length-c[4].length)+c[4]),parseInt(c[2],10)<parseInt(c[4],10)&&(c[3]=y+c[1],p[s]=c.slice(1)))),"string"==typeof p[s]&&(p[s]=p[s].replace("-",y,"g"));return p},l=function(t,e,i){r=t.length;for(var s=1,a=t.length;a>s;s+=2)t[s][3]=u(t[s][1],t[s][3],e,i),t[s][2].slice(1)===t[s][0]&&(t[s][2]=y);return n(t)},u=function(t,e,i,s){if(i||(i=0),f=(""+t).split(""),m=(""+e).split(""),g=m.slice(),g.reverse(),f.length===m.length)for(var r=0,n=f.length;n>r;r+=1){if(!(f[r]===m[r]&&g.length>i)){if(i&&s&&3===g.length){var a=f.slice(0,r);a.reverse(),g=g.concat(a)}break}g.pop()}return g.reverse(),g.join("")},h=function(t){for(r=t.length,s=1;r>s;s+=2)"object"==typeof t[s]&&(c=t[s],d=parseInt(c[1],10),b=parseInt(c[3],10),d>100&&d%100&&parseInt(d/100,10)===parseInt(b/100,10)?c[3]=""+b%100:d>=1e4&&(c[3]=""+b%1e3)),c[2].slice(1)===c[0]&&(c[2]=y);return n(t)};var v=function(t,e,i,s){var r;t=""+t;var n;return t.match(/[^\-\u20130-9 ,&]/)?(n=o(t,"\\s+\\-\\s+"),r=e(n,i,s)):(n=o(t,"-"),r=e(n,i,s)),r};return t.opt[e+"-range-format"]?"expanded"===t.opt[e+"-range-format"]?_=function(t){return v(t,n)}:"minimal"===t.opt[e+"-range-format"]?_=function(t){return v(t,l)}:"minimal-two"===t.opt[e+"-range-format"]?_=function(t,e){return v(t,l,2,e)}:"chicago"===t.opt[e+"-range-format"]&&(_=function(t){return v(t,h)}):_=function(t){return t},_},t.Util.FlipFlopper=function(t){var e,i,s,r,n,a,o,l,u,h,p,c,f,m,g,d,b,_;for(this.state=t,this.blob=!1,this.quotechars=['"',"'"],e=[["<i>","</i>","italics","@font-style",["italic","normal","normal"],!0],["<b>","</b>","bold","@font-weight",["bold","normal","normal"],!0],["<sup>","</sup>","superscript","@vertical-align",["sup","sup","baseline"],!0],["<sub>","</sub>","subscript","@vertical-align",["sub","sub","baseline"],!0],["<sc>","</sc>","smallcaps","@font-variant",["small-caps","small-caps","normal"],!0],['<span style="font-variant:small-caps;">',"</span>","smallcaps","@font-variant",["small-caps","normal","normal"],!0],['<span class="nocase">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['<span class="nodecor">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['"','"',"quotes","@quotes",["true","inner","true"],"'"],[" '","'","quotes","@quotes",["inner","true","true"],'"']],i=0;2>i;i+=1){r=["-","-inner-"][i],n=[];var y=t.getTerm("open"+r+"quote");n.push(y),this.quotechars.push(y);var v=t.getTerm("close"+r+"quote");n.push(v),this.quotechars.push(v),n.push("quotes"),n.push("@quotes"),"-"===r?n.push(["true","inner"]):n.push(["inner","true"]),n.push(!0),"-"===r?n.push(t.getTerm("close-inner-quote")):n.push(t.getTerm("close-quote")),e.push(n)}for(a=function(t){for(o=[],s=t.length,i=0;s>i;i+=1)l=t[i],-1===o.indexOf(l[0])&&(u="",["(",")","[","]"].indexOf(l[0])>-1&&(u="\\"),o.push(u+l[0])),-1===o.indexOf(l[1])&&(u="",["(",")","[","]"].indexOf(l[1])>-1&&(u="\\"),o.push(u+l[1]));return o},b=a(e),_=[],i=0,s=b.length;s>i;i+=1)b[i]&&_.push(b[i]);b=_.slice(),this.allTagsRexMatch=new RegExp("("+b.join("|")+")","g"),this.allTagsRexSplit=new RegExp("(?:"+b.join("|")+")"),h=function(t){for(p={},c={},f={},m={},g={},s=t.length,i=0;s>i;i+=1)p[t[i][1]]=!0,c[t[i][1]]=t[i][5],f[t[i][0]]=t[i][1],m[t[i][0]]=[t[i][3],t[i][4]],g[t[i][3]]=[t[i][3],[t[i][4][2],t[i][1]]];return[p,c,f,m,g]},d=h(e),this.closeTagsHash=d[0],this.flipTagsHash=d[1],this.openToCloseHash=d[2],this.openToDecorations=d[3],this.okReverseHash=d[4]},t.Util.FlipFlopper.prototype.init=function(e,i){this.txt_esc=t.getSafeEscape(this.state),i?(this.blob=i,this.strs=this.getSplitStrings(this.blob.blobs),this.blob.blobs=[]):(this.strs=this.getSplitStrings(e),this.blob=new t.Blob),this.blobstack=new t.Stack(this.blob)},t.Util.FlipFlopper.prototype._normalizeString=function(t){var e,i;if(t=t.replace(/\s+'\s+/," ’ ","g"),t.indexOf(this.quotechars[0])>-1)for(e=0,i=2;i>e;e+=1)this.quotechars[e+2]&&(t=t.replace(this.quotechars[e+2],this.quotechars[0]));if(t.indexOf(this.quotechars[1])>-1)for(e=0,i=2;i>e;e+=1)this.quotechars[e+4]&&(t=0===e?t.replace(this.quotechars[e+4]," "+this.quotechars[1]):t.replace(this.quotechars[e+4],this.quotechars[1]));return t},t.Util.FlipFlopper.prototype.getSplitStrings=function(t){var e,i,s,r,n,a,o,l,u,h,p,c,f,m,g,d,b,_,y,v,x,I,S,O,T,A,E,N,k;for(t=this._normalizeString(t),N=t.match(this.allTagsRexMatch),e=t.split(this.allTagsRexSplit),k=[e[0]],i=1,s=e.length;s>i;i+=1)k.push(N[i-1]),k.push(e[i]);for(e=k.slice(),s=e.length-2,i=s;i>0;i+=-2)"\\"===e[i-1].slice(e[i-1].length-1)&&(r=e[i-1].slice(0,e[i-1].length-1)+e[i]+e[i+1],n=e.slice(0,i-1),a=e.slice(i+2),n.push(r),e=n.concat(a));for(o=[],l=[],u=[],h=[],p=[],O=e.length-1,c=1;O>c;c+=2)if(d=e[c],this.closeTagsHash[d]&&(o.reverse(),f=this.openToCloseHash[d],m=o.indexOf(d),g=u.indexOf(d),o.reverse(),!f||m>-1&&(g>m||-1===g))){for(b=!1,T=o.length-1,_=T;_>-1;_+=-1){if(b=!0,y=o[_],d===y){o.pop(),l.pop(),u.pop(),h.pop();break}p.push(c)}b||p.push(c)}else this.openToCloseHash[d]&&(o.push(this.openToCloseHash[d]),l.push(d),u.push(this.flipTagsHash[d]),h.push(c));for(A=o.length-1,v=A;v>-1;v+=-1)o.pop(),u.pop(),l.pop(),p.push(h.pop());for(p.sort(function(t,e){return e>t?1:t>e?-1:0}),s=p.length,i=0;s>i;i+=1)E=p[i],n=e.slice(0,E-1),a=e.slice(E+2),x=e[E],x.length&&"<"!==x[0]&&this.openToDecorations[x]&&-1===this.quotechars.indexOf(x.replace(/\s+/g,""))&&(S=this.openToDecorations[x],x=this.state.fun.decorate[S[0]][S[1][0]](this.state)),I=e[E-1]+x+e[E+1],n.push(I),e=n.concat(a);for(s=e.length,i=0;s>i;i+=2)e[i]=e[i].replace("'","’","g"),e[i]=e[i].replace("  ’"," ’","g");return e},t.Util.FlipFlopper.prototype.processTags=function(){var e,i,s,r,n,a,o,l,u,h,p,c,f,m,g,d,b,_,y,v,x,I,S,O;if(e=[],i=[],s=[],r=[],n="",1===this.strs.length)this.blob.blobs=this.strs[0];else if(this.strs.length>2){for(x=this.strs.length-1,a=1;x>a;a+=2)if(o=this.strs[a],l=this.strs[a-1],l&&(u=new t.Blob(l),h=this.blobstack.value(),h.push(u)),this.closeTagsHash[o]&&(e.reverse(),p=this.openToCloseHash[o],c=e.indexOf(o),f=s.indexOf(o),e.reverse(),!p||c>-1&&(f>c||-1===f))){for(I=e.length,m=I;m>-1;m+=-1)if(g=e[m],o===g){e.pop(),i.pop(),s.pop(),r.pop(),this.blobstack.pop();break}}else if(this.openToCloseHash[o]){if(e.push(this.openToCloseHash[o]),i.push(o),s.push(this.flipTagsHash[o]),h=this.blobstack.value(),d=new t.Blob,h.push(d),b=this.addFlipFlop(d,this.openToDecorations[o]),'<span class="nodecor">'===o)for(_=this.state[this.state.tmp.area].opt.topdecor.concat(this.blob.alldecor).concat([[["@quotes","inner"]]]),I=_.length,m=0;I>m;m+=1)for(y=_[m],O=y.length,S=0;O>S;S+=1)v=y[S],["@font-style","@font-weight","@font-variant"].indexOf(v[0])>-1&&(b=this.addFlipFlop(d,this.okReverseHash[v[0]]));
r.push(this.state.fun.decorate[b[0]][b[1]](this.state)),this.blobstack.push(d)}this.strs.length>2&&(n=this.strs[this.strs.length-1],n&&(h=this.blobstack.value(),u=new t.Blob(n),h.push(u)))}return this.blob},t.Util.FlipFlopper.prototype.addFlipFlop=function(t,e){var i,s,r,n,a,o,l,u,h,p;for(s=0,r=this.state[this.state.tmp.area].opt.topdecor.concat(t.alldecor).concat([[["@quotes","inner"]]]),n=r.length,i=0;n>i;i+=1){for(a=r[i],o=!1,p=a.length-1,u=p;u>-1;u+=-1)if(l=a[u],l[0]===e[0]){l[1]===e[1][0]&&(s=1),o=!0;break}if(o)break}return h=[e[0],e[1][s]],t.decorations.reverse(),t.decorations.push(h),t.decorations.reverse(),h},t.Output.Formatters={},t.getSafeEscape=function(e){if(["bibliography","citation"].indexOf(e.tmp.area)>-1){var i=[];return e.opt.development_extensions.thin_non_breaking_space_html_hack&&"html"===e.opt.mode&&i.push(function(t){return t.replace(/\u202f/g,'<span style="white-space:nowrap">&thinsp;</span>')}),i.length?function(s){for(var r=0,n=i.length;n>r;r+=1)s=i[r](s);return t.Output.Formats[e.opt.mode].text_escape(s)}:t.Output.Formats[e.opt.mode].text_escape}return function(t){return t}},t.Output.Formatters.passthrough=function(t,e){return e},t.Output.Formatters.lowercase=function(e,i){var s=t.Output.Formatters.doppelString(i,t.TAG_USEALL);return s.string=s.string.toLowerCase(),t.Output.Formatters.undoppelString(s)},t.Output.Formatters.uppercase=function(e,i){var s=t.Output.Formatters.doppelString(i,t.TAG_USEALL);return s.string=s.string.toUpperCase(),t.Output.Formatters.undoppelString(s)},t.Output.Formatters["capitalize-first"]=function(e,i){var s=t.Output.Formatters.doppelString(i,t.TAG_ESCAPE);return s.string.length?(s.string=s.string.slice(0,1).toUpperCase()+s.string.substr(1),t.Output.Formatters.undoppelString(s)):""},t.Output.Formatters.sentence=function(e,i){var s=t.Output.Formatters.doppelString(i,t.TAG_ESCAPE);return s.string=s.string.slice(0,1).toUpperCase()+s.string.substr(1).toLowerCase(),t.Output.Formatters.undoppelString(s)},t.Output.Formatters["capitalize-all"]=function(e,i){for(var s=t.Output.Formatters.doppelString(i,t.TAG_ESCAPE),r=s.string.split(" "),n=0,a=r.length;a>n;n+=1)r[n].length>1?r[n]=e.opt.development_extensions.allow_force_lowercase?r[n].slice(0,1).toUpperCase()+r[n].substr(1).toLowerCase():r[n].slice(0,1).toUpperCase()+r[n].substr(1):1===r[n].length&&(r[n]=r[n].toUpperCase());return s.string=r.join(" "),t.Output.Formatters.undoppelString(s)},t.Output.Formatters.title=function(e,i){function s(t){var e=t.match(/([:?!]+\s+|-|^)(.)(.*)/);return e?e[1]+e[2].toUpperCase()+e[3]:t}var r,n,a,o,l;if(e.locale[e.opt.lang].opts["skip-words"],!i)return"";var u=t.Output.Formatters.doppelString(i,t.TAG_ESCAPE),r=u.string,l=r.split(e.locale[e.opt.lang].opts["skip-words-regexp"]);for(h=1,p=l.length;p>h;h+=2)l[h].match(/^[:?!]/)&&(l[h]=s(l[h]));l[0]||(l[1]=s(l[1])),l.length>2&&!l[l.length-1]&&(l[l.length-2]=s(l[l.length-2]));for(var h=0,p=l.length;p>h;h+=2){var n=l[h].split(/([:?!]*\s+|-)/);for(k=0,klen=n.length;klen>k;k+=2)if(0!==n[k].length){if(a=n[k].toUpperCase(),o=n[k].toLowerCase(),n[k].match(/[0-9]/))continue;n[k]===o&&(n[k]=s(n[k]))}l[h]=n.join("")}u.string=l.join("");var c=t.Output.Formatters.undoppelString(u);return c},t.Output.Formatters.doppelString=function(t,e){var i;i={},i.array=e(t),i.string="";for(var s=0,r=i.array.length;r>s;s+=2)i.string+=i.array[s];return i},t.Output.Formatters.undoppelString=function(t){var e;e="";for(var i=0,s=t.array.length;s>i;i+=1)i%2?e+=t.array[i]:(e+=t.string.slice(0,t.array[i].length),t.string=t.string.slice(t.array[i].length));return e},t.Output.Formatters.serializeItemAsRdf=function(){return""},t.Output.Formatters.serializeItemAsRdfA=function(){return""},t.demoteNoiseWords=function(t,e,i){var s=t.locale[t.opt.lang].opts["leading-noise-words"];if(e&&i){e=e.split(/\s+/),e.reverse();for(var r=[],n=e.length-1;n>-1&&s.indexOf(e[n].toLowerCase())>-1;n+=-1)r.push(e.pop());e.reverse();var a=e.join(" "),o=r.join(" ");"drop"!==i&&o?"demote"===i&&(e=[a,o].join(", ")):e=a}return e},t.Output.Formats=function(){},t.Output.Formats.prototype.html={text_escape:function(e){return e||(e=""),e.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace("  ","&#160; ","g").replace(t.SUPERSCRIPTS_REGEXP,function(e){return"<sup>"+t.SUPERSCRIPTS[e]+"</sup>"})},bibstart:'<div class="csl-bib-body">\n',bibend:"</div>","@font-style/italic":"<i>%%STRING%%</i>","@font-style/oblique":"<em>%%STRING%%</em>","@font-style/normal":'<span style="font-style:normal;">%%STRING%%</span>',"@font-variant/small-caps":'<span style="font-variant:small-caps;">%%STRING%%</span>',"@passthrough/true":t.Output.Formatters.passthrough,"@font-variant/normal":'<span style="font-variant:normal;">%%STRING%%</span>',"@font-weight/bold":"<b>%%STRING%%</b>","@font-weight/normal":'<span style="font-weight:normal;">%%STRING%%</span>',"@font-weight/light":!1,"@text-decoration/none":'<span style="text-decoration:none;">%%STRING%%</span>',"@text-decoration/underline":'<span style="text-decoration:underline;">%%STRING%%</span>',"@vertical-align/sup":"<sup>%%STRING%%</sup>","@vertical-align/sub":"<sub>%%STRING%%</sub>","@vertical-align/baseline":'<span style="baseline">%%STRING%%</span>',"@strip-periods/true":t.Output.Formatters.passthrough,"@strip-periods/false":t.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return"undefined"==typeof e?"’":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(e,i){var s="";e.sys.embedBibliographyEntry&&(s=e.sys.embedBibliographyEntry(this.item_id)+"\n");var r=i.lastIndexOf("http"),n=i.substring(r,i.lastIndexOf("."));i=i.replace(n+".","");var a='  <div class="csl-entry">';return-1!=r?a=' <div class="csl-entry"><a href="'+n+'">'+t.DecodeHtml(i)+"</a></div>\n":a+=i,a+="</div>\n"+s,a},"@display/block":function(t,e){return'\n\n    <div class="csl-block">'+e+"</div>\n"},"@display/left-margin":function(t,e){return'\n    <div class="csl-left-margin">'+e+"</div>"},"@display/right-inline":function(t,e){return'<div class="csl-right-inline">'+e+"</div>\n  "},"@display/indent":function(t,e){return'<div class="csl-indent">'+e+"</div>\n  "},"@showid/true":function(t,e,i){return'<span class="'+t.opt.nodenames[i]+'" cslid="'+i+'">'+e+"</span>"},"@URL/true":function(t,e){return'<a href="'+e+'">'+e+"</a>"},"@DOI/true":function(t,e){return'<a href="http://dx.doi.org/'+e+'">'+e+"</a>"}},t.Output.Formats.prototype.text={text_escape:function(t){return t||(t=""),t},bibstart:"",bibend:"","@font-style/italic":!1,"@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":t.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":!1,"@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":t.Output.Formatters.passthrough,"@strip-periods/false":t.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return"undefined"==typeof e?"’":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e+"\n"},"@display/block":function(t,e){return"\n"+e},"@display/left-margin":function(t,e){return e},"@display/right-inline":function(t,e){return e},"@display/indent":function(t,e){return"\n    "+e},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},t.Output.Formats.prototype.rtf={text_escape:function(e){return e||(e=""),e.replace(/([\\{}])/g,"\\$1","g").replace(t.SUPERSCRIPTS_REGEXP,function(e){return"\\super "+t.SUPERSCRIPTS[e]+"\\nosupersub{}"}).replace(/[\u007F-\uFFFF]/g,function(t){return"\\uc0\\u"+t.charCodeAt(0).toString()+"{}"}).replace("	","\\tab{}","g")},"@passthrough/true":t.Output.Formatters.passthrough,"@font-style/italic":"\\i %%STRING%%\\i0{}","@font-style/normal":"\\i0{}%%STRING%%\\i{}","@font-style/oblique":"\\i %%STRING%%\\i0{}","@font-variant/small-caps":"\\scaps %%STRING%%\\scaps0{}","@font-variant/normal":"\\scaps0{}%%STRING%%\\scaps{}","@font-weight/bold":"\\b %%STRING%%\\b0{}","@font-weight/normal":"\\b0{}%%STRING%%\\b{}","@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"\\ul %%STRING%%\\ul0{}","@vertical-align/baseline":!1,"@vertical-align/sup":"\\super %%STRING%%\\nosupersub{}","@vertical-align/sub":"\\sub %%STRING%%\\nosupersub{}","@strip-periods/true":t.Output.Formatters.passthrough,"@strip-periods/false":t.Output.Formatters.passthrough,"@quotes/true":function(e,i){return"undefined"==typeof i?t.Output.Formats.rtf.text_escape(e.getTerm("open-quote")):t.Output.Formats.rtf.text_escape(e.getTerm("open-quote"))+i+t.Output.Formats.rtf.text_escape(e.getTerm("close-quote"))},"@quotes/inner":function(e,i){return"undefined"==typeof i?t.Output.Formats.rtf.text_escape("’"):t.Output.Formats.rtf.text_escape(e.getTerm("open-inner-quote"))+i+t.Output.Formats.rtf.text_escape(e.getTerm("close-inner-quote"))},"@quotes/false":!1,bibstart:"{\\rtf ",bibend:"}","@display/block":"\\line{}%%STRING%%\\line\r\n","@cite/entry":function(t,e){return e},"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e},"@display/left-margin":function(t,e){return e+"\\tab "},"@display/right-inline":function(t,e){return e+"\n"},"@display/indent":function(t,e){return"\n\\tab "+e},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},t.Output.Formats=new t.Output.Formats,t.Registry=function(e){var i,s,r;this.debug=!1,this.state=e,this.registry={},this.reflist=[],this.namereg=new t.Registry.NameReg(e),this.citationreg=new t.Registry.CitationReg(e),this.authorstrings={},this.mylist=[],this.myhash={},this.deletes=[],this.inserts=[],this.uncited={},this.refreshes={},this.akeys={},this.oldseq={},this.return_data={},this.ambigcites={},this.ambigresets={},this.sorter=new t.Registry.Comparifier(e,"bibliography_sort"),this.getSortedIds=function(){for(i=[],s=0,r=this.reflist.length;r>s;s+=1)i.push(""+this.reflist[s].id);return i},this.getSortedRegistryItems=function(){for(i=[],s=0,r=this.reflist.length;r>s;s+=1)i.push(this.reflist[s]);return i}},t.Registry.prototype.init=function(t,e){var i,s;if(this.oldseq={},e){this.uncited={};for(var i=0,s=t.length;s>i;i+=1)this.myhash[t[i]]||this.mylist.push(""+t[i]),this.uncited[t[i]]=!0,this.myhash[t[i]]=!0}else{for(var r in this.uncited)t.push(r);var n={};for(i=t.length-1;i>-1;i+=-1)n[t[i]]?t=t.slice(0,i).concat(t.slice(i+1)):n[t[i]]=!0;this.mylist=[];for(var i=0,s=t.length;s>i;i+=1)this.mylist.push(""+t[i]);this.myhash=n}this.refreshes={},this.touched={},this.ambigsTouched={},this.ambigresets={}},t.Registry.prototype.dopurge=function(t){for(var e=this.mylist.length-1;e>-1;e+=-1)this.citationreg.citationsByItemId&&(this.citationreg.citationsByItemId[this.mylist[e]]||t[this.mylist[e]]||(delete this.myhash[this.mylist[e]],this.mylist=this.mylist.slice(0,e).concat(this.mylist.slice(e+1))));this.dodeletes(this.myhash)},t.Registry.prototype.dodeletes=function(t){var e,i,s,r,n,a,o,l,u;"string"==typeof t&&(t={},t[t]=!0);for(i in this.registry)if(!t[i]){if(this.uncited[i])continue;e=this.namereg.delitems(i);for(o in e)this.refreshes[o]=!0;for(s=this.registry[i].ambig,l=this.ambigcites[s].indexOf(i),l>-1&&(a=this.ambigcites[s].slice(),this.ambigcites[s]=a.slice(0,l).concat(a.slice(l+1,a.length)),this.ambigresets[s]=this.ambigcites[s].length),n=this.ambigcites[s].length,r=0;n>r;r+=1)u=""+this.ambigcites[s][r],this.refreshes[u]=!0;if(this.registry[i].siblings)if(1==this.registry[i].siblings.length){var h=this.registry[i].siblings[0];this.registry[h].master=!0,this.registry[h].siblings.pop(),this.registry[h].parallel=!1}else if(this.registry[i].siblings.length>1){var p=[i];if(this.registry[i].master){var c=this.registry[i].siblings[0],f=this.registry[c];f.master=!0,f.parallel=!1,p.push(c);for(var m=0,g=this.registry[i].siblings.length;g>m;m+=1)this.registry[this.registry[i].siblings[m]].parallel=c}for(var d=[],m=this.registry[i].siblings.length-1;m>-1;m+=-1){var b=this.registry[i].siblings.pop();-1===p.indexOf(b)&&d.push(b)}for(var m=d.length-1;m>-1;m+=-1)this.registry[i].siblings.push(d[m])}delete this.registry[i],this.return_data.bibchange=!0}},t.Registry.prototype.doinserts=function(e){var i,s,r,n,a,o,l;for("string"==typeof e&&(e=[e]),o=0,l=e.length;l>o;o+=1)i=e[o],this.registry[i]||(s=this.state.retrieveItem(i),r=t.getAmbiguousCite.call(this.state,s),this.ambigsTouched[r]=!0,s.legislation_id||(this.akeys[r]=!0),n={id:""+i,seq:0,offset:0,sortkeys:!1,ambig:!1,rendered:!1,disambig:!1,ref:s},this.registry[i]=n,a=t.getAmbigConfig.call(this.state),this.registerAmbigToken(r,i,a),this.touched[i]=!0,this.return_data.bibchange=!0)},t.Registry.prototype.rebuildlist=function(){var e,i,s;for(this.reflist=[],this.state.opt.citation_number_sort_direction===t.DESCENDING&&this.state.opt.citation_number_sort_used,e=this.mylist.length,i=0;e>i;i+=1)s=this.mylist[i],this.reflist.push(this.registry[s]),this.oldseq[s]=this.registry[s].seq,this.registry[s].seq=i+1;this.state.opt.citation_number_sort_direction===t.DESCENDING&&this.state.opt.citation_number_sort_used},t.Registry.prototype.dorefreshes=function(){var e,i,s,r,n;for(e in this.refreshes)if(i=this.registry[e]){i.sortkeys=void 0,s=this.state.retrieveItem(e);var r=i.ambig;"undefined"==typeof r&&(this.state.tmp.disambig_settings=!1,r=t.getAmbiguousCite.call(this.state,s),n=t.getAmbigConfig.call(this.state),this.registerAmbigToken(r,e,n));for(var a in this.ambigresets)if(1===this.ambigresets[a]){var o=this.ambigcites[r][0],s=this.state.retrieveItem(o);this.registry[o].disambig=new t.AmbigConfig,this.state.tmp.disambig_settings=!1;var r=t.getAmbiguousCite.call(this.state,s),n=t.getAmbigConfig.call(this.state);this.registerAmbigToken(r,o,n)}this.state.tmp.taintedItemIDs[e]=!0,this.ambigsTouched[r]=!0,s.legislation_id||(this.akeys[r]=!0),this.touched[e]=!0}},t.Registry.prototype.setdisambigs=function(){var t;this.leftovers=[];for(t in this.ambigsTouched)this.state.disambiguate.run(t);this.ambigsTouched={},this.akeys={}},t.Registry.prototype.renumber=function(){var e,i,s;for(this.state.opt.citation_number_sort_direction===t.DESCENDING&&this.state.opt.citation_number_sort_used,e=this.reflist.length,i=0;e>i;i+=1)s=this.reflist[i],s.seq=i+1,this.state.opt.update_mode===t.NUMERIC&&s.seq!=this.oldseq[s.id]&&(this.state.tmp.taintedItemIDs[s.id]=!0),this.state.opt.bib_mode===t.NUMERIC&&s.seq!=this.oldseq[s.id]&&(this.return_data.bibchange=!0);this.state.opt.citation_number_sort_direction===t.DESCENDING&&this.state.opt.citation_number_sort_used&&this.reflist.reverse()},t.Registry.prototype.setsortkeys=function(){for(var e,i=0,s=this.mylist.length;s>i;i+=1){var e=this.mylist[i];(this.touched[e]||this.state.tmp.taintedItemIDs[e]||!this.registry[e].sortkeys)&&(this.registry[e].sortkeys=t.getSortKeys.call(this.state,this.state.retrieveItem(e),"bibliography_sort"))}},t.Registry.prototype.sorttokens=function(){this.reflist.sort(this.sorter.compareKeys)},t.Registry.Comparifier=function(e,i){var s,r,n,a,o=t.getSortCompare(e.opt["default-locale-sort"]);s=e[i].opt.sort_directions,this.compareKeys=function(t,e){for(r=t.sortkeys?t.sortkeys.length:0,n=0;r>n;n+=1){var i=0;if(i=t.sortkeys[n]===e.sortkeys[n]?0:"undefined"==typeof t.sortkeys[n]?s[n][1]:"undefined"==typeof e.sortkeys[n]?s[n][0]:o(t.sortkeys[n],e.sortkeys[n]),i>0)return s[n][1];if(0>i)return s[n][0]}return t.seq>e.seq?1:t.seq<e.seq?-1:0},a=this.compareKeys,this.compareCompositeKeys=function(t,e){return a(t[1],e[1])}},t.Registry.prototype.compareRegistryTokens=function(t,e){return t.seq>e.seq?1:t.seq<e.seq?-1:0},t.Registry.prototype.registerAmbigToken=function(e,i,s){if(this.registry[i]&&this.registry[i].disambig&&this.registry[i].disambig.names)for(var r=0,n=s.names.length;n>r;r+=1){var a=s.names[r],o=this.registry[i].disambig.names[r];if(a!==o)this.state.tmp.taintedItemIDs[i]=!0;else if(s.givens[r])for(var l=0,u=s.givens[r].length;u>l;l+=1){var h=s.givens[r][l],p=this.registry[i].disambig.givens[r][l];h!==p&&(this.state.tmp.taintedItemIDs[i]=!0)}}this.ambigcites[e]||(this.ambigcites[e]=[]),-1===this.ambigcites[e].indexOf(""+i)&&this.ambigcites[e].push(""+i),this.registry[i].ambig=e,this.registry[i].disambig=t.cloneAmbigConfig(s)},t.getSortKeys=function(e,i){var s,r,n,a,o,l;for(s=this.tmp.area,r=this.tmp.extension,n=t.Util.Sort.strip_prepositions,this.tmp.area=i,this.tmp.extension="_sort",this.tmp.disambig_override=!0,this.tmp.disambig_request=!1,a=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,t.getCite.call(this,e),this.tmp.suppress_decorations=!1,this.parallel.use_parallels=a,this.tmp.disambig_override=!1,o=this[i].keys.length,l=0;o>l;l+=1)this[i].keys[l]=n(this[i].keys[l]);return this.tmp.area=s,this.tmp.extension=r,this[i].keys},t.Registry.NameReg=function(e){var i,s,r,n,a,o,l,u,h,p,c,f,m,g,d,b;this.state=e,this.namereg={},this.nameind={},this.nameindpkeys={},this.itemkeyreg={},u=function(t){return t||(t=""),t.replace("."," ","g").replace(/\s+/g," ").replace(/\s+$/,"")},h=function(e,n,a){i=u(a.family),r=u(a.given);var o=r.match(/,\!* [^,]$/);o&&o[1]===o[1].toLowerCase()&&(r=r.replace(/,\!* [^,]$/,"")),s=t.Util.Names.initializeWith(e,r,"%s"),"by-cite"===e.citation.opt["givenname-disambiguation-rule"]&&(i=""+n+i)},p=function(t,r,o,l,u,p){var c;if("bibliography"===e.tmp.area.slice(0,12)&&!u)return"string"==typeof p?1:2;var f=e.nameOutput.getName(r,"locale-translit",!0);r=f.name,h(this.state,""+t,r),c=2,n=e.opt["disambiguate-add-givenname"],a=e.citation.opt["givenname-disambiguation-rule"];var m=a;return"by-cite"===a&&(a="all-names"),"short"===u?c=0:"string"==typeof p&&(c=1),"undefined"==typeof this.namereg[i]||"undefined"==typeof this.namereg[i].ikey[s]?c:"by-cite"===m&&l>=c?l:n?"string"==typeof a&&"primary-name"===a.slice(0,12)&&o>0?c:(a&&"all-names"!==a&&"primary-name"!==a?("all-names-with-initials"===a||"primary-name-with-initials"===a)&&(c=this.namereg[i].count>1?1:0):(this.namereg[i].count>1&&(c=1),(this.namereg[i].ikey&&this.namereg[i].ikey[s].count>1||this.namereg[i].count>1&&"string"!=typeof p)&&(c=2)),e.registry.registry[t]?c:"short"==u?0:"string"==typeof p?1:void 0):c},c=function(t){var n,a,u,h,p;for(("string"==typeof t||"number"==typeof t)&&(t=[""+t]),o={},a=t.length,n=0;a>n;n+=1)if(h=""+t[n],this.nameind[h]){for(p in this.nameind[h])if(this.nameind[h].hasOwnProperty(p)){if(m=p.split("::"),i=m[0],s=m[1],r=m[2],"undefined"==typeof this.namereg[i])continue;if(l=this.namereg[i].items,r&&this.namereg[i].ikey[s]&&this.namereg[i].ikey[s].skey[r]&&(g=this.namereg[i].ikey[s].skey[r].items,u=g.indexOf(""+h),u>-1&&(this.namereg[i].ikey[s].skey[r].items=g.slice(0,u).concat(g.slice([u+1]))),0===this.namereg[i].ikey[s].skey[r].items.length&&(delete this.namereg[i].ikey[s].skey[r],this.namereg[i].ikey[s].count+=-1,this.namereg[i].ikey[s].count<2)))for(d=0,b=this.namereg[i].ikey[s].items.length;b>d;d+=1)e.tmp.taintedItemIDs[this.namereg[i].ikey[s].items[d]]=!0;if(s&&this.namereg[i].ikey[s]&&(u=this.namereg[i].ikey[s].items.indexOf(""+h),u>-1&&(l=this.namereg[i].ikey[s].items.slice(),this.namereg[i].ikey[s].items=l.slice(0,u).concat(l.slice([u+1]))),0===this.namereg[i].ikey[s].items.length&&(delete this.namereg[i].ikey[s],this.namereg[i].count+=-1,this.namereg[i].count<2)))for(d=0,b=this.namereg[i].items.length;b>d;d+=1)e.tmp.taintedItemIDs[this.namereg[i].items[d]]=!0;i&&(u=this.namereg[i].items.indexOf(""+h),u>-1&&(l=this.namereg[i].items.slice(),this.namereg[i].items=l.slice(0,u).concat(l.slice([u+1],l.length))),this.namereg[i].items.length<2&&delete this.namereg[i]),delete this.nameind[h][p]}delete this.nameind[h],delete this.nameindpkeys[h]}return o},f=function(t,n,a){var o,l,u=e.nameOutput.getName(n,"locale-translit",!0);if(n=u.name,!e.citation.opt["givenname-disambiguation-rule"]||"primary-"!==e.citation.opt["givenname-disambiguation-rule"].slice(0,8)||0===a){if(h(this.state,""+t,n),i&&("undefined"==typeof this.namereg[i]?(this.namereg[i]={},this.namereg[i].count=0,this.namereg[i].ikey={},this.namereg[i].items=[t]):-1===this.namereg[i].items.indexOf(t)&&this.namereg[i].items.push(t)),i&&s)if("undefined"==typeof this.namereg[i].ikey[s]){if(this.namereg[i].ikey[s]={},this.namereg[i].ikey[s].count=0,this.namereg[i].ikey[s].skey={},this.namereg[i].ikey[s].items=[t],this.namereg[i].count+=1,2===this.namereg[i].count)for(o=0,l=this.namereg[i].items.length;l>o;o+=1)e.tmp.taintedItemIDs[this.namereg[i].items[o]]=!0}else-1===this.namereg[i].ikey[s].items.indexOf(t)&&this.namereg[i].ikey[s].items.push(t);if(i&&s&&r)if("undefined"==typeof this.namereg[i].ikey[s].skey[r]){if(this.namereg[i].ikey[s].skey[r]={},this.namereg[i].ikey[s].skey[r].items=[t],this.namereg[i].ikey[s].count+=1,2===this.namereg[i].ikey[s].count)for(o=0,l=this.namereg[i].ikey[s].items.length;l>o;o+=1)e.tmp.taintedItemIDs[this.namereg[i].ikey[s].items[o]]=!0}else-1===this.namereg[i].ikey[s].skey[r].items.indexOf(t)&&this.namereg[i].ikey[s].skey[r].items.push(t);"undefined"==typeof this.nameind[t]&&(this.nameind[t]={},this.nameindpkeys[t]={}),i&&(this.nameind[t][i+"::"+s+"::"+r]=!0,this.nameindpkeys[t][i]=this.namereg[i])}},this.addname=f,this.delitems=c,this.evalname=p},t.Registry.CitationReg=function(){this.citationById={},this.citationByIndex=[]},t.Disambiguation=function(t){this.state=t,this.sys=this.state.sys,this.registry=t.registry.registry,this.ambigcites=t.registry.ambigcites,this.configModes(),this.debug=!1},t.Disambiguation.prototype.run=function(t){this.modes.length&&(this.akey=t,this.initVars(t)&&this.runDisambig())},t.Disambiguation.prototype.runDisambig=function(){var t;for(this.initGivens=!0;this.lists.length;){for(this.gnameset=0,this.gname=0,this.clashes=[1,0];this.lists[0][1].length;)this.listpos=0,this.base||(this.base=this.lists[0][0]),t=this.incrementDisambig(),this.scanItems(this.lists[0]),this.evalScan(t);this.lists=this.lists.slice(1)}},t.Disambiguation.prototype.scanItems=function(e){var i,s,r;this.Item=e[1][0],this.ItemCite=t.getAmbiguousCite.call(this.state,this.Item,this.base),this.scanlist=e[1],this.partners=[],this.partners.push(this.Item),this.nonpartners=[];var n=0;for(i=1,s=e[1].length;s>i;i+=1){r=e[1][i];var a=t.getAmbiguousCite.call(this.state,r,this.base);this.ItemCite===a?(n+=1,this.partners.push(r)):this.nonpartners.push(r)}this.clashes[0]=this.clashes[1],this.clashes[1]=n},t.Disambiguation.prototype.evalScan=function(t){this[this.modes[this.modeindex]](t),t&&(this.modeindex<this.modes.length-1?this.modeindex+=1:this.lists[this.listpos+1]=[this.base,[]])},t.Disambiguation.prototype.disNames=function(t){var e,i;if(0===this.clashes[1]&&1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,[]];else if(0===this.clashes[1])this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.nonpartners.length&&(this.initGivens=!0);else if(1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.partners];else if(this.clashes[1]<this.clashes[0])this.captureStepToBase(),this.lists[this.listpos]=[this.betterbase,this.partners],this.lists.push([this.betterbase,this.nonpartners]);else if(t&&(this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.lists.push([this.betterbase,this.partners]),this.modeindex===this.modes.length-1)){for(e=0,i=this.partners.length;i>e;e+=1)this.state.registry.registerAmbigToken(this.akey,""+this.partners[e].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,[]]}},t.Disambiguation.prototype.disExtraText=function(){if(this.base.disambiguate&&this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax){if(this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax)if(this.modeindex===this.modes.length-1){for(var t=this.lists[this.listpos][0],e=0,i=this.lists[this.listpos][1].length;i>e;e+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][e].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][e].id,t);this.lists[this.listpos]=[this.betterbase,[]]}else{this.modeindex=this.modes.length-1;var t=this.lists[this.listpos][0];t.disambiguate=!0;for(var e=0,i=this.lists[this.listpos][1].length;i>e;e+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][e].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][e].id,t)}}else if(this.modeindex=0,this.base.disambiguate=this.state.tmp.disambiguate_count,this.betterbase.disambiguate=this.state.tmp.disambiguate_count,this.base.disambiguate)this.disNames();else{this.initGivens=!0,this.base.disambiguate=1;for(var e=0,i=this.lists[this.listpos][1].length;i>e;e+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][e].id]=!0}},t.Disambiguation.prototype.disYears=function(){var e,i,s,r;s=[];var n=this.lists[this.listpos][0];if(this.clashes[1])for(var a=0,o=this.state.registry.mylist.length;o>a;a+=1)for(var l=this.state.registry.mylist[a],u=0,h=this.lists[this.listpos][1].length;h>u;u+=1){var r=this.lists[this.listpos][1][u];if(r.id==l){s.push(this.registry[r.id]);break}}for(s.sort(this.state.registry.sorter.compareKeys),e=0,i=s.length;i>e;e+=1){n.year_suffix=""+e;var p=this.state.registry.registry[s[e].id].disambig;this.state.registry.registerAmbigToken(this.akey,""+s[e].id,n),t.ambigConfigDiff(p,n)&&(this.state.tmp.taintedItemIDs[s[e].id]=!0)}this.lists[this.listpos]=[this.betterbase,[]]},t.Disambiguation.prototype.incrementDisambig=function(){if(this.initGivens)return this.initGivens=!1,!1;var t=!1,e=!0;if("disNames"===this.modes[this.modeindex]){e=!1,"number"!=typeof this.givensMax&&(e=!0);var i=!1;"number"!=typeof this.namesMax&&(i=!0),"number"==typeof this.givensMax&&(this.base.givens.length&&this.base.givens[this.gnameset][this.gname]<this.givensMax?this.base.givens[this.gnameset][this.gname]+=1:e=!0),"number"==typeof this.namesMax&&e&&(this.state.opt["disambiguate-add-names"]?(i=!1,this.gname<this.namesMax?(this.base.names[this.gnameset]+=1,this.gname+=1):i=!0):i=!0),"number"==typeof this.namesetsMax&&i&&this.gnameset<this.namesetsMax&&(this.gnameset+=1,this.base.names[this.gnameset]=1,this.gname=0),"number"==typeof this.namesetsMax&&-1!==this.namesetsMax&&this.gnameset!==this.namesetsMax||this.state.opt["disambiguate-add-names"]&&"number"==typeof this.namesMax&&this.gname!==this.namesMax||"number"==typeof this.givensMax&&"undefined"!=typeof this.base.givens[this.gnameset]&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&this.base.givens[this.gnameset][this.gname]!==this.givensMax||(t=!0)}else"disExtraText"===this.modes[this.modeindex]&&(this.base.disambiguate+=1,this.betterbase.disambiguate+=1);return t},t.Disambiguation.prototype.initVars=function(e){var i,s,r,n,a;if(this.lists=[],this.base=!1,this.betterbase=!1,this.akey=e,this.maxNamesByItemId={},n=[],r=this.ambigcites[e],!r||!r.length)return!1;var o=this.state.retrieveItem(""+r[0]);if(this.getCiteData(o),this.base=t.getAmbigConfig.call(this.state),r&&r.length>1){for(n.push([this.maxNamesByItemId[o.id],o]),i=1,s=r.length;s>i;i+=1)o=this.state.retrieveItem(""+r[i]),this.getCiteData(o,this.base),n.push([this.maxNamesByItemId[o.id],o]);for(n.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:t[1].id>e[1].id?1:t[1].id<e[1].id?-1:0}),a=[],i=0,s=n.length;s>i;i+=1)a.push(n[i][1]);this.lists.push([this.base,a]),this.Item=this.lists[0][1][0]}else this.Item=this.state.retrieveItem(""+r[0]);this.modeindex=0;var i,s;return this.namesMax=this.maxNamesByItemId[this.Item.id][0],this.padBase(this.base),this.padBase(this.betterbase),this.base.year_suffix=!1,this.base.disambiguate=!1,this.betterbase.year_suffix=!1,this.betterbase.disambiguate=!1,"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.state.opt["disambiguate-add-givenname"]&&(this.givensMax=2),!0},t.Disambiguation.prototype.padBase=function(t){for(var e=0,i=t.names.length;i>e;e+=1){t.givens[e]||(t.givens[e]=[]);for(var s=0,r=t.names[e];r>s;s+=1)t.givens[e][s]||(t.givens[e][s]=0)}},t.Disambiguation.prototype.configModes=function(){var t,e;this.modes=[],t=this.state.opt["disambiguate-add-givenname"],e=this.state.citation.opt["givenname-disambiguation-rule"],(this.state.opt["disambiguate-add-names"]||t&&"by-cite"===e)&&this.modes.push("disNames"),this.state.opt.has_disambiguate&&this.modes.push("disExtraText"),this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears")},t.Disambiguation.prototype.getCiteData=function(e,i){if(!this.maxNamesByItemId[e.id]){t.getAmbiguousCite.call(this.state,e,i),i=t.getAmbigConfig.call(this.state),this.maxNamesByItemId[e.id]=t.getMaxVals.call(this.state),this.state.registry.registry[e.id].disambig.givens=this.state.tmp.disambig_settings.givens.slice();for(var s=0,r=this.state.registry.registry[e.id].disambig.givens.length;r>s;s+=1)this.state.registry.registry[e.id].disambig.givens[s]=this.state.tmp.disambig_settings.givens[s].slice();this.namesetsMax=this.state.registry.registry[e.id].disambig.names.length-1,this.base||(this.base=i,this.betterbase=t.cloneAmbigConfig(i)),i.names.length<this.base.names.length&&(this.base=i);for(var s=0,r=i.names.length;r>s;s+=1)i.names[s]>this.base.names[s]&&(this.base.givens[s]=i.givens[s].slice(),this.base.names[s]=i.names[s],this.betterbase.names=this.base.names.slice(),this.betterbase.givens=this.base.givens.slice(),this.padBase(this.base),this.padBase(this.betterbase));this.betterbase.givens=this.base.givens.slice();for(var n=0,a=this.base.givens.length;a>n;n+=1)this.betterbase.givens[n]=this.base.givens[n].slice()}},t.Disambiguation.prototype.captureStepToBase=function(){"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.base.givens&&this.base.givens.length&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&(this.betterbase.givens[this.gnameset][this.gname]=this.base.givens[this.gnameset][this.gname]),this.betterbase.names[this.gnameset]=this.base.names[this.gnameset]},t.DecodeHtml=function(t){var e=document.createElement("textarea");return e.innerHTML=t,e.value},{CSL:t}}),s("citation-widget",["citeproc"],function(t){function e(t){for(var e=t.split("."),i=window,s=0;s<e.length;s++)"undefined"==typeof i[e[s]]&&(i[e[s]]={}),i=i[e[s]]}return e("Scrazzl"),Scrazzl.Widget=function(){document.getElementsByClassName("citation-widget").length>0&&(this.WidgetContainer=document.getElementsByClassName("citation-widget")[0],this.CiteObjectList=void 0,"Product"===Scrazzl.Config.WidgetType?(this.AttributeContainer=document.getElementsByClassName("productDetailUL")[0],this.ProductCatalogNo=this.AttributeContainer.getAttribute("data-catalog-no"),this.ProductVendorName=this.AttributeContainer.getAttribute("data-vendor-name")):this.ArticleId=this.WidgetContainer.getAttribute("data-article-id"))},Scrazzl.DataService={CiteRenderCallbackContext:{},CiteRenderCallbackFunction:{},XMLHttpFactories:[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")
}],CreateXMLHTTPObject:function(){for(var t=!1,e=0;e<this.XMLHttpFactories.length;e++){try{t=this.XMLHttpFactories[e]()}catch(i){continue}break}return t},GetProductListByArticle:function(t,e,i){var s=document.createElement("script");s.src=Scrazzl.UrlHelper.BuildGetArticleProductListUrl(i),s.async=!0,s.setAttribute("type","text/javascript"),document.body.appendChild(s),this.CiteRenderCallbackContext=e,this.CiteRenderCallbackFunction=t},GetArticleListByProduct:function(t,e,i,s){var r=document.createElement("script");r.src=Scrazzl.UrlHelper.BuildGetArticleListByProductAttributesUrl(i,s),r.async=!0,r.setAttribute("type","text/javascript"),document.body.appendChild(r),this.CiteRenderCallbackContext=e,this.CiteRenderCallbackFunction=t},CitationJsonParser:function(t){ if(t instanceof Array){$('.citations').trigger('citationsNotFound');} "function"==typeof this.CiteRenderCallbackFunction&&this.CiteRenderCallbackFunction.call(this.CiteRenderCallbackContext,t)}},Scrazzl.HtmlHelper={WriteStartTag:function(t,e){var i="<"+t;for(var s in e)i+=" ",i+=s+"="+e[s];return i+=">"},WriteEndTag:function(t){var e="</"+t+">";return e}},Scrazzl.CreateCitationProcessor=function(e,i,s){this.ItemList=i;var r=this.DataService.CreateXMLHTTPObject(),n={retrieveLocale:function(t){return r.open("GET",s+"locales-"+t+".css",!1),r.send(null),r.responseText},retrieveItem:function(t){return i[t]}};r.open("GET",e,!1),r.send(null);var a=r.responseText,o=new t.CSL.Engine(n,a);return o},Scrazzl.UrlHelper={BuildGetArticleProductListUrl:function(t){var e=encodeURIComponent(t),i=Scrazzl.Config.DataServiceBaseUrl;return i+="v2/articles/"+e,i+="/products?token=39e02fea6fac36fb23d19fd3ae4e717f&p=jove",i+="&callback=Scrazzl.DataService.CitationJsonParser",i+="&citation=1",i+="&limit=10"},BuildGetArticleListByProductAttributesUrl:function(t,e){encodeURIComponent(t), e = encodeURIComponent(e);var i=Scrazzl.Config.DataServiceBaseUrl;return i+="v2/products",i+="/articles?token=39e02fea6fac36fb23d19fd3ae4e717f&p=jove",i+="&callback=Scrazzl.DataService.CitationJsonParser",i+="&cid="+t,i+="&vname="+e,i+="&citation=1",i+="&limit=10"},GetQueryStringValueByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}},Scrazzl.Widget.prototype.RenderCiteObjects=function(t){if("undefined"==typeof t)return this.CiteObjectList={},void 0;this.CiteObjectList=t,this.CSLDocumentId=this.WidgetContainer.getAttribute("data-csl-doc"),this.LocaleFilesPath=this.WidgetContainer.getAttribute("data-locale-path");var e=Scrazzl.CreateCitationProcessor(this.CSLDocumentId,this.CiteObjectList,this.LocaleFilesPath),i=[];for(var s in t)i.push(s);e.updateItems(i);var r=e.makeBibliography();this.WidgetContainer.innerHTML=r[1].join("\n")},Scrazzl.Widget.prototype.Render=function(){"undefined"!=typeof this.WidgetContainer&&(void 0!=this.CiteObjectList?this.RenderCiteObjects(this.CiteObjectList):"Product"===Scrazzl.Config.WidgetType?Scrazzl.DataService.GetArticleListByProduct(this.RenderCiteObjects,this,this.ProductCatalogNo,this.ProductVendorName):Scrazzl.DataService.GetProductListByArticle(this.RenderCiteObjects,this,this.ArticleId))},Scrazzl.Config={DataServiceBaseUrl:"http://ec2-54-80-71-144.compute-1.amazonaws.com/",WidgetType:"Product"},{Scrazzl:Scrazzl}}),function(){e({urlArgs:"b="+(new Date).getTime(),paths:{citeproc:"vendor/citeproc/citeproc",domready:"vendor/domready/domready"}},["domready","citation-widget"],function(t,e){t(function(){var t=new e.Scrazzl.Widget;t.Render()})})}.call(this),s("main",function(){}),e(["main"])}();